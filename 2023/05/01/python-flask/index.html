<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Python-Flask | betty bear</title><meta name="keywords" content="框架"><meta name="author" content="betty bear,3025346417@qq.com"><meta name="copyright" content="betty bear"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Web框架协助开发者快速开发 Web 应用程序的一套功能代码开发者只需要按照框架约定要求，在指定位置写上自己的业务逻辑代码web框架稳定性和可扩展性强，可以降低开发难度，提高开发效率。 FlaskFlask是一个轻量级的可定制框架，使用Python语言编写，较其他同类型框架更为灵活、轻便、安全且容易上手。它可以很好地结合MVC模式进行开发，开发人员分工合作，小型团队在短时间内就可以完成功能丰富的中">
<meta property="og:type" content="article">
<meta property="og:title" content="Python-Flask">
<meta property="og:url" content="http://xczf.shop/2023/05/01/python-flask/index.html">
<meta property="og:site_name" content="betty bear">
<meta property="og:description" content="Web框架协助开发者快速开发 Web 应用程序的一套功能代码开发者只需要按照框架约定要求，在指定位置写上自己的业务逻辑代码web框架稳定性和可扩展性强，可以降低开发难度，提高开发效率。 FlaskFlask是一个轻量级的可定制框架，使用Python语言编写，较其他同类型框架更为灵活、轻便、安全且容易上手。它可以很好地结合MVC模式进行开发，开发人员分工合作，小型团队在短时间内就可以完成功能丰富的中">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xczf.shop/image/35.jpg">
<meta property="article:published_time" content="2023-05-01T11:00:41.000Z">
<meta property="article:modified_time" content="2024-01-31T15:11:57.819Z">
<meta property="article:author" content="betty bear">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xczf.shop/image/35.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xczf.shop/2023/05/01/python-flask/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":500,"languages":{"author":"作者: betty bear","link":"链接: ","source":"来源: betty bear","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python-Flask',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-31 23:11:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="betty bear" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/35.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">betty bear</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Python-Flask</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-01T11:00:41.000Z" title="发表于 2023-05-01 19:00:41">2023-05-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-31T15:11:57.819Z" title="更新于 2024-01-31 23:11:57">2024-01-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/cate%EF%BC%9Agories/python/">python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Python-Flask"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Web框架"><a href="#Web框架" class="headerlink" title="Web框架"></a>Web框架</h2><p>协助开发者快速开发 Web 应用程序的一套功能代码<br>开发者只需要按照框架约定要求，在指定位置写上自己的业务逻辑代码<br>web框架稳定性和可扩展性强，可以降低开发难度，提高开发效率。</p>
<h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h2><p>Flask是一个轻量级的可定制框架，使用Python语言编写，较其他同类型框架更为灵活、轻便、安全且容易上手。它可以很好地结合MVC模式进行开发，开发人员分工合作，小型团队在短时间内就可以完成功能丰富的中小型网站或Web服务的实现。另外，Flask还有很强的定制性，用户可以根据自己的需求来添加相应的功能，在保持核心功能简单的同时实现功能的丰富与扩展，其强大的插件库可以让用户实现个性化的网站定制，开发出功能强大的网站。<br><strong>Flask是一个使用 Python 编写的轻量级 Web 应用框架。其 WSGI 工具箱采用 Werkzeug ，模板引擎则使用 Jinja2 。Flask使用 BSD 授权。</strong><br>官网：<a target="_blank" rel="noopener" href="http://flask.pocoo.org/">http://flask.pocoo.org/</a><br>中文用户指南：<a target="_blank" rel="noopener" href="https://dormousehole.readthedocs.io/en/latest/">https://dormousehole.readthedocs.io/en/latest/</a></p>
<h3 id="安装flask即虚拟环境"><a href="#安装flask即虚拟环境" class="headerlink" title="安装flask即虚拟环境"></a>安装flask即虚拟环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">pip install virtualenvwrapper-win</span><br><span class="line"><span class="comment"># 创建虚拟环境</span></span><br><span class="line">mkvirtualenv flask_py3 -p python3</span><br><span class="line">workon <span class="comment"># 查看</span></span><br><span class="line">workon flask_py3 <span class="comment"># 使用</span></span><br><span class="line">pip install flask==1.0.2 <span class="comment"># 安装指定版本</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>pycharm使用虚拟环境<br><img src="/image/PyQT/5.jpg" alt="pycharm使用虚拟环境"><br><strong>然后进入setting里安装flask</strong></p>
<h4 id="第一个页面"><a href="#第一个页面" class="headerlink" title="第一个页面"></a>第一个页面</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask <span class="comment"># 导入flask</span></span><br><span class="line"><span class="comment"># 创建flask对象</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 用应用对象.route(&quot;/index.html&quot;)对函数进行装饰</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;第一个flask页面&quot;</span></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><h4 id="1-指定路由地址"><a href="#1-指定路由地址" class="headerlink" title="1.指定路由地址"></a>1.指定路由地址</h4><p><strong>如果需要让浏览器可以访问一个新的url，那么需要添加一个路由,路由的地址确定，那么就确定了浏览器访问时的url,函数的名字可以任意，只要不重复就行</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&quot;/test&quot;</span>)  <span class="comment"># 这里的路由决定了浏览器访问时的url</span></span><br><span class="line">def <span class="built_in">test</span>():  <span class="comment"># 定义函数</span></span><br><span class="line">    <span class="built_in">return</span> <span class="string">&quot;这是test页面&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&quot;/profile&quot;</span>)</span><br><span class="line">def profile():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;使其返回html写成的网页&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># return &quot;&lt;h1&gt;我是个人主页&lt;/h1&gt;&quot;</span></span><br><span class="line">    with open(<span class="string">&quot;profile.html&quot;</span>) as f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="built_in">return</span> content</span><br></pre></td></tr></table></figure>
<h4 id="2-路由传参"><a href="#2-路由传参" class="headerlink" title="2.路由传参"></a>2.路由传参</h4><p>用同一个视图函数来显示不同用户的个人信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&quot;/profile_v2/&lt;user_id&gt;&quot;</span>)  <span class="comment"># &lt;user_id&gt;表示匹配url时，这里的数据提取出来</span></span><br><span class="line">def profile_v2(user_id):  <span class="comment"># 将提取出来的数据传递给&lt;user_id&gt;中&lt;&gt;内的名字，而且函数的形参也是这个名字</span></span><br><span class="line">    <span class="built_in">return</span> <span class="string">&quot;&lt;h1&gt;这是%s的个人主页&lt;/h1&gt;&quot;</span> % user_id</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile_v3/&lt;user_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile_v3</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># return &quot;&lt;h1&gt;这是%s的个人主页&lt;/h1&gt;&quot; % user_id</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;profile.html&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">        <span class="comment"># 在HTML文件中对应位置进行替换</span></span><br><span class="line">        <span class="comment"># 将刚刚标记的那个特殊字符串，进行替换；即将xxxx替换为user_id</span></span><br><span class="line">        content = content.replace(<span class="string">&quot;xxxx&quot;</span>, user_id)</span><br><span class="line">    <span class="keyword">return</span> content</span><br></pre></td></tr></table></figure>
<h3 id="Jinja2模板引擎"><a href="#Jinja2模板引擎" class="headerlink" title="Jinja2模板引擎"></a>Jinja2模板引擎</h3><p>模板其实是一个包含响应文本的文件，其中用占位符(变量)表示动态部分，<br>告诉模板引擎其具体的值需要从数据中获取<br>使用真实值替换变量，再返回最终得到的字符串，这个过程称为“渲染”<br>Flask是使用 Jinja2 这个模板引擎来渲染模板</p>
</li>
<li><p>使用模板的好处<br>视图函数只负责业务逻辑和数据处理(业务逻辑方面)<br>数据结果进行展示(视图展示方面)<br>代码结构清晰，耦合度低</p>
</li>
<li><p>使用<br>Flask提供的<strong>render_template 函数</strong>封装了该模板引擎 render_template 函数的第一个参数是模板的文件名，后面的参数都是键值对，表示模板中变量对应的真实值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; user_id &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目下创建template文件夹，并存放profile.html文件</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile_v4/&lt;user_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile_v4</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;profile.html&quot;</span>,xxxx=user_id)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 修改profile.html</span></span><br><span class="line">&lt;h1 <span class="keyword">class</span>=<span class="string">&quot;name&quot;</span>&gt;&#123;&#123;xxxx&#125;&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>
<h3 id="flask使用数据库"><a href="#flask使用数据库" class="headerlink" title="flask使用数据库"></a>flask使用数据库</h3><h4 id="数据库准备"><a href="#数据库准备" class="headerlink" title="数据库准备"></a>数据库准备</h4></li>
<li><p>新建一个数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database flask_1 charset=utf8;</span><br></pre></td></tr></table></figure></li>
<li><p>建立新表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `user` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `user_id` varchar(50) NOT NULL,</span><br><span class="line">  `user_name` varchar(50) NOT NULL,</span><br><span class="line">  `head_img` varchar(200) DEFAULT NULL,</span><br><span class="line">  `short_description` varchar(300) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insert into `flask_1`.`user` (</span><br><span class="line">  `head_img`, `user_id`, `short_description`, `user_name`</span><br><span class="line">) </span><br><span class="line">values (</span><br><span class="line">&#x27;191919.jpeg&#x27;, &#x27;191919&#x27;, &#x27;l love yous&#x27;, &#x27;cjb&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="数据库的操作"><a href="#数据库的操作" class="headerlink" title="数据库的操作"></a>数据库的操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/profile_v5/&lt;user_id&gt;&quot;</span>)</span><br><span class="line">def profile_v5(user_id):</span><br><span class="line">    conn = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, port=3306, database=<span class="string">&#x27;flask_1&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;123456&#x27;</span>, charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 获得Cursor对象</span></span><br><span class="line">    cs1 = conn.cursor()</span><br><span class="line">    <span class="comment"># 构造参数列表</span></span><br><span class="line">    params = [user_id]</span><br><span class="line">    <span class="comment"># 执行select语句，并返回受影响的行数：查询所有数据</span></span><br><span class="line">    cs1.execute(<span class="string">&#x27;select * from user where user_id=%s&#x27;</span>, params)</span><br><span class="line">    result = cs1.fetchone()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="comment"># 模板渲染</span></span><br><span class="line">    <span class="built_in">return</span> render_template(<span class="string">&quot;profile.html&quot;</span>, username=result[2],head_img=result[3])</span><br></pre></td></tr></table></figure></li>
<li><p>修改profile.html模板文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123;user_name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;profile-image&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/&#123;&#123;head_img&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用SQLAlchemy进行升级"><a href="#使用SQLAlchemy进行升级" class="headerlink" title="使用SQLAlchemy进行升级"></a>使用SQLAlchemy进行升级</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, String, Integer</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接是需要指定要用到的MySQL数据库</span></span><br><span class="line">engine = create_engine(<span class="string">&#x27;mysql+pymysql://root:123456@localhost:3306/flask_1?charset=utf8&#x27;</span>)</span><br><span class="line">Base = declarative_base()  <span class="comment"># 生成SQLORM基类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="comment"># 对应MySQL中数据表的名字</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line">    <span class="comment"># 创建字段</span></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = Column(String(<span class="number">50</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    user_name = Column(String(<span class="number">50</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    head_img = Column(String(<span class="number">200</span>))</span><br><span class="line">    short_description = Column(String(<span class="number">300</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile_v8/&lt;user_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile_v8</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># 创建session对象</span></span><br><span class="line">    DBSession = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话</span></span><br><span class="line">    session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">    <span class="comment"># 获取返回数据的第一行</span></span><br><span class="line">    obj = session.query(User).<span class="built_in">filter</span>(User.user_id == user_id).one()</span><br><span class="line">    <span class="comment"># 关闭session</span></span><br><span class="line">    session.close()</span><br><span class="line">    <span class="comment"># 模板渲染</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;profile.html&quot;</span>, user_name=obj.user_name, head_img=obj.head_img, short_description=obj.short_description)</span><br></pre></td></tr></table></figure>
<h4 id="新建立一个python包"><a href="#新建立一个python包" class="headerlink" title="新建立一个python包"></a>新建立一个python包</h4><p><img src="/image/PyQT/6.jpg" alt="建立python包"></p>
</li>
<li><p>建立models.py文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line">from sqlalchemy import Column, String, Integer</span><br><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接是需要指定要用到的MySQL数据库</span></span><br><span class="line">engine = create_engine(<span class="string">&#x27;mysql+pymysql://root:123456@localhost:3306/flask_1?charset=utf8&#x27;</span>)</span><br><span class="line">Base = declarative_base()  <span class="comment"># 生成SQLORM基类</span></span><br><span class="line"></span><br><span class="line">class User(Base):</span><br><span class="line">    <span class="comment"># 对应MySQL中数据表的名字</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line">    <span class="comment"># 创建字段</span></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=True)</span><br><span class="line">    user_id = Column(String(50), nullable=False)</span><br><span class="line">    user_name = Column(String(50), nullable=False)</span><br><span class="line">    head_img = Column(String(200))</span><br><span class="line">    short_description = Column(String(300))</span><br></pre></td></tr></table></figure>
<p><strong>修改main.py</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from models.models import User,engine</span><br></pre></td></tr></table></figure>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图函数就是用来处理某个url的逻辑的</p>
<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><p><strong>重定向到自己写的视图函数,直接填写自己 url 路径,也可以使用 url_for 生成指定视图函数所对应的 url</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重定向到 baidu 官网</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重定向到带有参数的视图函数</span></span><br><span class="line"><span class="comment"># 路由传递参数</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;int:user_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_test</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello %d&#x27;</span> % user_id</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>():</span><br><span class="line">    <span class="comment"># 使用 url_for 生成指定视图函数所对应的 url</span></span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user_test&#x27;</span>, user_id=<span class="number">100</span>))</span><br></pre></td></tr></table></figure>
<h4 id="自定义状态码"><a href="#自定义状态码" class="headerlink" title="自定义状态码"></a>自定义状态码</h4><p>在 Flask 中，可以很方便的返回自定义状态码，以实现不符合 http 协议的状态码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;状态码为 666&#x27;</span>, <span class="number">666</span></span><br></pre></td></tr></table></figure>
<h2 id="Flask高级部分"><a href="#Flask高级部分" class="headerlink" title="Flask高级部分"></a>Flask高级部分</h2><h3 id="蓝图"><a href="#蓝图" class="headerlink" title="蓝图"></a>蓝图</h3><h4 id="1-前台后台"><a href="#1-前台后台" class="headerlink" title="1.前台后台"></a>1.前台后台</h4><p>前台：就是普通用户访问一个网站时，能够看到的页面<br>后台：提供给系统管理者能够看到的页面，而普通用户看不到的页面<br>前端：对于程序员而言，在进行编程的时候，那些用来呈现效果的代码<br>后端：对于程序员而言，进行编程的时候，那些用来不是给用户看，而是处理业务的那些代码</p>
<h4 id="2-后台模板显示"><a href="#2-后台模板显示" class="headerlink" title="2.后台模板显示"></a>2.后台模板显示</h4></li>
<li><p>修改文件URL<br><img src="/image/PyQT/7.jpg" alt=" "></p>
</li>
<li><p>修改main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	app.run()</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改index.html,文件路径为static<br><img src="/image/PyQT/8.jpg" alt=" "><br><img src="/image/PyQT/9.jpg" alt=" "></p>
<h4 id="3-后台基本功能–统计数据"><a href="#3-后台基本功能–统计数据" class="headerlink" title="3.后台基本功能–统计数据"></a>3.后台基本功能–统计数据</h4></li>
<li><p>将之前的models模型copy到models文件夹下</p>
</li>
<li><p>完善main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> models.models <span class="keyword">import</span> User, engine</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/user_info&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>():</span><br><span class="line">    <span class="comment"># 创建session对象</span></span><br><span class="line">    DBSession = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">    session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">    <span class="comment"># 查询user表中所有的用户数据</span></span><br><span class="line">    all_user_info = session.query(User).<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(all_user_info)</span><br><span class="line">    <span class="comment"># 关闭session</span></span><br><span class="line">    session.close()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,user_info=all_user_info) <span class="comment"># 添加关键词参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></li>
<li><p>模板中，使用循环<br><img src="/image/PyQT/10.jpg" alt=" "></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for user_info in user_infos %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_info.user_id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_info.user_name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_info.head_img&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_info.short_description &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-模板-控制代码块"><a href="#4-模板-控制代码块" class="headerlink" title="4.模板-控制代码块"></a>4.模板-控制代码块</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loop.index	当前循环迭代的次数（从 1 开始）</span><br><span class="line">loop.index0	当前循环迭代的次数（从 0 开始）</span><br><span class="line">loop.revindex	倒序，当前循环迭代的次数（从 1 开始）</span><br><span class="line">loop.revindex0	倒序，当前循环迭代的次数（从 0 开始）</span><br><span class="line">loop.first	如果是第一次迭代，为 True</span><br><span class="line">loop.last	如果是最后一次迭代，为 True</span><br><span class="line">loop.length	序列中的项目数</span><br></pre></td></tr></table></figure>
<h5 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if user.is_logged_flag %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;/logout&#x27;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  <span class="comment">&lt;!-- 如果登录了，就应该显示 可以点击&quot;退出&quot; --&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;/login&#x27;</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<h5 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for post in posts %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; post.title &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; post.text | safe &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-蓝图"><a href="#5-蓝图" class="headerlink" title="5.蓝图"></a>5.蓝图</h4><p>在实际情况中，普通用户可以访问自己的个人页面,管理员用户可以访问后台统计的页面<br>如果开启一个flask工程，而关闭另外一个，不管是开关哪个，总会有一个处于关闭中，这显然是不行的为了解决这个问题，flask给出了解决方案蓝图</p>
</li>
<li><p>将前台、后台融合到一个flask工程<br><img src="/image/PyQT/11.jpg" alt=" "></p>
</li>
<li><p>修改admin代码<br>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>views&#x2F;admin&#x2F;views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> models.models <span class="keyword">import</span> User, engine</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/user_info&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>():</span><br><span class="line">    <span class="comment"># 创建session对象</span></span><br><span class="line">    DBSession = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">    session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">    <span class="comment"># 查询user表中所有的用户数据</span></span><br><span class="line">    all_user_info = session.query(User).<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(all_user_info)</span><br><span class="line">    <span class="comment"># 关闭session</span></span><br><span class="line">    session.close()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, user_infos=all_user_info)</span><br></pre></td></tr></table></figure></li>
<li><p>问题<strong>views&#x2F;admin&#x2F;views.py中没有app这个对象</strong><br>步骤1：在views&#x2F;admin&#x2F;<strong>init</strong>.py文件中定义个蓝图<br>步骤2：用这个蓝图替代views&#x2F;admin&#x2F;views.py中的app，从而不会因为没有app而失败<br>步骤3：在main.py中注册步骤1的那个蓝图，这样app就与蓝图进行了关联，而蓝图又与视图函数进行了关联<br><img src="/image/PyQT/12.jpg" alt=" "><br>views&#x2F;admin&#x2F;<strong>init</strong>.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"><span class="comment"># 创建一个蓝图，用来管理多个函数视图</span></span><br><span class="line">admin_blu = Blueprint(<span class="string">&quot;admin&quot;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br></pre></td></tr></table></figure>
<p>views&#x2F;admin&#x2F;views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> models.models <span class="keyword">import</span> User, engine</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> admin_blu <span class="comment"># 新增</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@admin_blu.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@admin_blu.route(<span class="params"><span class="string">&quot;/user_info&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>():</span><br><span class="line">    <span class="comment"># 创建session对象</span></span><br><span class="line">    DBSession = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">    session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">    <span class="comment"># 查询user表中所有的用户数据</span></span><br><span class="line">    all_user_info = session.query(User).<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(all_user_info)</span><br><span class="line">    <span class="comment"># 关闭session</span></span><br><span class="line">    session.close()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, user_infos=all_user_info)</span><br></pre></td></tr></table></figure>
<p>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> views.admin <span class="keyword">import</span> admin_blu</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 注册蓝图</span></span><br><span class="line">app.register_blueprint(admin_blu)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></li>
<li><p>修改index代码<br>views&#x2F;index&#x2F;<strong>init</strong>.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个蓝图，用来管理多个函数视图</span></span><br><span class="line">index_blu = Blueprint(<span class="string">&quot;index&quot;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br></pre></td></tr></table></figure>
<p>views&#x2F;index&#x2F;views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> models.models <span class="keyword">import</span> User, engine</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> index_blu</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/profile_v8/&lt;user_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile_v8</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># 1. 查询数据库</span></span><br><span class="line">    <span class="comment"># 创建session对象</span></span><br><span class="line">    DBSession = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">    session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取返回数据的第一行</span></span><br><span class="line">    obj = session.query(User).<span class="built_in">filter</span>(User.user_id == user_id).one()</span><br><span class="line">    <span class="comment"># 关闭session</span></span><br><span class="line">    session.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 模板渲染</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;profile.html&quot;</span>, user_name=obj.user_name, head_img=obj.head_img, short_description=obj.short_description)</span><br></pre></td></tr></table></figure>
<p>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> views.admin <span class="keyword">import</span> admin_blu</span><br><span class="line"><span class="keyword">from</span> views.index <span class="keyword">import</span> index_blu</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册蓝图</span></span><br><span class="line">app.register_blueprint(admin_blu,url_prefix=<span class="string">&quot;/admin&quot;</span>)</span><br><span class="line">app.register_blueprint(index_blu)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></li>
<li><p>修改template中代码<br><img src="/image/PyQT/13.jpg" alt=" "></p>
</li>
<li><p>修改static下的资源路径<br><img src="/image/PyQT/14.jpg" alt=" "></p>
<h3 id="cookie和session"><a href="#cookie和session" class="headerlink" title="cookie和session"></a>cookie和session</h3><h4 id="1-显示登录界面"><a href="#1-显示登录界面" class="headerlink" title="1.显示登录界面"></a>1.显示登录界面</h4><p><img src="/image/PyQT/15.jpg" alt=" "><br><img src="/image/PyQT/16.jpg" alt="为了能够和功能对应上，将其改名为login.html"><br><img src="/image/PyQT/17.jpg" alt="修改login.html"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加视图函数</span></span><br><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&quot;index/login.html&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-实现登录"><a href="#2-实现登录" class="headerlink" title="2.实现登录"></a>2.实现登录</h4><p><img src="/image/PyQT/18.jpg" alt="修改login.html"><br>此时登录没有反应但是能看URL中有了输入的用户和数字</p>
<h5 id="提取url参数"><a href="#提取url参数" class="headerlink" title="提取url参数"></a>提取url参数</h5><p>修改 views&#x2F;index&#x2F;views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line">...</span><br><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">	<span class="comment"># requests.args表示的是一个字典，可以通过迭代的方式提取所有，或者通过get方法提取某个指定的参数</span></span><br><span class="line">    ret = request.args <span class="comment"># 通过request.args就可以得到flask已经处理好之后的 url参数</span></span><br><span class="line">   <span class="keyword">if</span> ret: <span class="comment"># 将url中提取的参数返回直接让浏览器显示</span></span><br><span class="line">        user_name = ret.get(<span class="string">&quot;Username&quot;</span>)</span><br><span class="line">        passwd = ret.get(<span class="string">&quot;Password&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户名:%s ，密码:%s&quot;</span> % (user_name, passwd)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># url没有参数，表示用户访问login是为了看到登录的页面</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index/login.html&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h5><p><img src="/image/PyQT/19.jpg" alt=" "><br><img src="/image/PyQT/20.jpg" alt=" "><br>修改 views&#x2F;index&#x2F;views.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@index_blu.route(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">def login():</span><br><span class="line">    ret = request.args</span><br><span class="line">    <span class="keyword">if</span> ret:</span><br><span class="line">        user_name = ret.get(<span class="string">&quot;Username&quot;</span>)</span><br><span class="line">        passwd = ret.get(<span class="string">&quot;Password&quot;</span>)</span><br><span class="line">        <span class="comment"># 创建session对象</span></span><br><span class="line">        DBSession = sessionmaker(<span class="built_in">bind</span>=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">        session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">        <span class="comment"># 获取返回数据的第一行</span></span><br><span class="line">        try:</span><br><span class="line">            obj = session.query(User).filter(and_(User.user_id == user_name, User.passwd == passwd)).one()</span><br><span class="line">        except:</span><br><span class="line">            msg = <span class="string">&quot;登录失败...&lt;br&gt;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg = <span class="string">&quot;用户名、密码匹配，登录成功...&lt;br&gt;&quot;</span></span><br><span class="line">        <span class="comment"># 关闭session</span></span><br><span class="line">        session.close()</span><br><span class="line">        <span class="built_in">return</span> msg + <span class="string">&quot;用户名:%s ，密码:%s&quot;</span> % (user_name, passwd)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> render_template(<span class="string">&quot;index/login.html&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="登录验证最初方式"><a href="#登录验证最初方式" class="headerlink" title="登录验证最初方式"></a>登录验证最初方式</h5><p>没有起到限制没有权限的用户登录功能，是因为：登录成功与否并没有给出一个标记，标记这个浏览器有没有权限访问profile页面<br><img src="/image/PyQT/21.jpg" alt=" "></p>
<h4 id="3-request"><a href="#3-request" class="headerlink" title="3.request"></a>3.request</h4><p>request是flask中代表当前请求对象<br><img src="/image/PyQT/24.jpg" alt="常用属性对象"></p>
<h4 id="4-cookie解决认证的问题"><a href="#4-cookie解决认证的问题" class="headerlink" title="4.cookie解决认证的问题"></a>4.cookie解决认证的问题</h4><p>只要flask程序运行起来，无论用多少个浏览器访问web服务器，web服务器都是同一个web程序程序，如果一个用户修改了这个全局变量，那么再用这个flask为其他的未登录的用户提供页面的时候，都当做登录之后的来处理了，每一个用户都应该用自己独有的标记才可以，而不是所有用户共用这个同一个全局变量<br><img src="/image/PyQT/22.jpg" alt="没有任何标记"><br><strong>修改视图函数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    ret = request.args</span><br><span class="line">    <span class="keyword">if</span> ret:</span><br><span class="line">        user_name = ret.get(<span class="string">&quot;Username&quot;</span>)</span><br><span class="line">        passwd = ret.get(<span class="string">&quot;Password&quot;</span>)</span><br><span class="line">        response = make_response(<span class="string">&quot;用户名:%s ，密码:%s&quot;</span> % (user_name, passwd))</span><br><span class="line">        <span class="comment"># 创建session对象</span></span><br><span class="line">        DBSession = sessionmaker(bind=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">        session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">        <span class="comment"># 获取返回数据的第一行</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            obj = session.query(User).<span class="built_in">filter</span>(and_(User.user_id == user_name, User.passwd == passwd)).one()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="comment"># max_age=xxx,设置过期时间,单位为s</span></span><br><span class="line">            response.set_cookie(<span class="string">&quot;login_flag&quot;</span>, <span class="string">&quot;fail&quot;</span>) <span class="comment"># set_cookie</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response.set_cookie(<span class="string">&quot;login_flag&quot;</span>, <span class="string">&quot;success&quot;</span>) <span class="comment"># set_cookie</span></span><br><span class="line">        <span class="comment"># 关闭session</span></span><br><span class="line">        session.close()</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index/login.html&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/image/PyQT/23.jpg" alt=" "></p>
<h4 id="5-退出登录-cookie方式"><a href="#5-退出登录-cookie方式" class="headerlink" title="5.退出登录-cookie方式"></a>5.退出登录-cookie方式</h4><p><strong>退出时，将这个cookie给清理掉即可，但是cookie不是在服务器上存储的，所以需要通过http的响应头的方式告诉浏览器将对应的cookie删除</strong></p>
</li>
<li><p>代码实现<br>修改profile.html文件，增加返回按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container text-right&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;&#123;</span> <span class="attr">url_for</span>(&quot;<span class="attr">.logout</span>&quot;) &#125;&#125;&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>修改视图函数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    response = make_response(redirect(url_for(<span class="string">&quot;.index&quot;</span>)))</span><br><span class="line">    response.delete_cookie(<span class="string">&quot;login_flag&quot;</span>)</span><br><span class="line">    response.delete_cookie(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h4 id="6-Session"><a href="#6-Session" class="headerlink" title="6.Session"></a>6.Session</h4><p>cookie是采用key:value的方式，将很多服务器对用户的数据存储到了浏览器中，将很多重要的标记信息存储在用户的浏览器中是很危险的<br>hash可以在设置cookie的时候将user_id等信息进行加密，此时浏览器再进行伪造时，就比较麻烦了，但是试想下：如果cookie中存储了多个信息，那么每个信息都加密，那么当web服务器接收到之后肯定需要解密，服务器的cpu就会被占用。<br><img src="/image/PyQT/25.jpg" alt="常用解决方案 "></p>
<h5 id="将cookie升级为session"><a href="#将cookie升级为session" class="headerlink" title="将cookie升级为session"></a>将cookie升级为session</h5><p>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&quot;1&quot;</span>  <span class="comment"># 使用session时需要的秘钥</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>views&#x2F;index&#x2F;views.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">from flask import session</span><br><span class="line"></span><br><span class="line">@index_blu.route(<span class="string">&quot;/profile_v8&quot;</span>)</span><br><span class="line">def profile_v8():</span><br><span class="line"></span><br><span class="line">    login_flag = session.get(<span class="string">&#x27;login_flag&#x27;</span>)</span><br><span class="line">    user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> login_flag == <span class="string">&quot;success&quot;</span> and user_id:</span><br><span class="line">        DBSession = sessionmaker(<span class="built_in">bind</span>=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">        db_session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">        obj = db_session.query(User).filter(User.user_id == user_id).one()</span><br><span class="line">        db_session.close()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> render_template(<span class="string">&quot;index/profile.html&quot;</span>, user_name=obj.user_name, head_img=obj.head_img, short_description=obj.short_description)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> redirect(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"></span><br><span class="line">@index_blu.route(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">def login():</span><br><span class="line">    ret = request.args</span><br><span class="line">    <span class="keyword">if</span> ret:</span><br><span class="line">        user_name = ret.get(<span class="string">&quot;Username&quot;</span>)</span><br><span class="line">        passwd = ret.get(<span class="string">&quot;Password&quot;</span>)</span><br><span class="line"></span><br><span class="line">        redirect_to_url = redirect(<span class="string">&quot;/profile_v8&quot;</span>)</span><br><span class="line">        response = make_response(redirect_to_url)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建session对象</span></span><br><span class="line">        DBSession = sessionmaker(<span class="built_in">bind</span>=engine)  <span class="comment"># 创建与数据库的会话，返回的是一个类</span></span><br><span class="line">        db_session = DBSession()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">        <span class="comment"># 获取返回数据的第一行</span></span><br><span class="line">        try:</span><br><span class="line">            obj = db_session.query(User).filter(and_(User.user_id == user_name, User.passwd == passwd)).one()</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">&#x27;login_flag&#x27;</span>] = <span class="string">&quot;success&quot;</span></span><br><span class="line">            session[<span class="string">&#x27;user_id&#x27;</span>] = user_name</span><br><span class="line">        <span class="comment"># 关闭session</span></span><br><span class="line">        db_session.close()</span><br><span class="line">        <span class="built_in">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> render_template(<span class="string">&quot;index/login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">@index_blu.route(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">def index():</span><br><span class="line">    <span class="built_in">return</span> redirect(<span class="string">&quot;/profile_v8&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h5><p>views&#x2F;index&#x2F;views.py中添加视图函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.clear()  <span class="comment"># 清除所有的session</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="POST、Ajax、JSON"><a href="#POST、Ajax、JSON" class="headerlink" title="POST、Ajax、JSON"></a>POST、Ajax、JSON</h3><h4 id="1-显示注册界面"><a href="#1-显示注册界面" class="headerlink" title="1.显示注册界面"></a>1.显示注册界面</h4><p><img src="/image/PyQT/26.jpg" alt="注册界面"><br>修改views&#x2F;index&#x2F;views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/register&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index/register.html&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/image/PyQT/27.jpg" alt="修改模板中引用的静态文件的路径"></p>
<h4 id="2-ajax"><a href="#2-ajax" class="headerlink" title="2.ajax"></a>2.ajax</h4><p>AJAX 不是新的编程语言，而是一种使用现有标准的新方法。<br>AJAX 是与服务器交换数据并更新部分网页的艺术，在不重新加载整个页面的情况下<br>最大的特点，不像在浏览器输入网址的那个位置，只要输入一个网址，回车之后整个页面刷新；ajax可以做到部分刷新</p>
<h4 id="3-实现"><a href="#3-实现" class="headerlink" title="3.实现"></a>3.实现</h4></li>
<li><p>添加数据库字段<br><img src="/image/PyQT/28.jpg" alt=" "></p>
</li>
<li><p>实现前端向后端提交数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;.login-btn&quot;).click(function()&#123;</span><br><span class="line">    // 获取数据</span><br><span class="line">    var email = $(&quot;#email&quot;).val();</span><br><span class="line">    var username = $(&quot;#user&quot;).val();</span><br><span class="line">    var password = $(&quot;#password&quot;).val();</span><br><span class="line">    var verify = $(&quot;#verify&quot;).val();</span><br><span class="line"></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: &quot;&#123;&#123; url_for(&#x27;.register&#x27;) &#125;&#125;&quot;,</span><br><span class="line">        type: &#x27;post&#x27;,</span><br><span class="line">        &#123;#jsonp: &#x27;jsonpcallback&#x27;,#&#125;</span><br><span class="line">        &#123;#jsonpCallback: &quot;flightHandler&quot;,#&#125;</span><br><span class="line">        &#123;#async: false,#&#125;</span><br><span class="line">        data: &#123;</span><br><span class="line">            &#x27;email&#x27;:email,</span><br><span class="line">            &#x27;username&#x27;:username,</span><br><span class="line">            &#x27;password&#x27;:password,</span><br><span class="line">            &#x27;verify&#x27;:verify</span><br><span class="line">        &#125;,</span><br><span class="line">        success: function(data)&#123;</span><br><span class="line">            status = data.status;</span><br><span class="line">            errmsg = data.errmsg;</span><br><span class="line">            layer.msg(errmsg);</span><br><span class="line">            if(status==0)&#123;</span><br><span class="line">                setTimeout(function()&#123;</span><br><span class="line">                    window.location.href = &quot;&#123;&#123; url_for(&#x27;.index&#x27;) &#125;&#125;&quot;;</span><br><span class="line">                &#125;, &quot;2000&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>修改后端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;get&quot;</span>, <span class="string">&quot;post&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.form)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index/register.html&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>后端发送json数据<br>修改数据模型<br><img src="/image/PyQT/29.jpg" alt=" "><br>修改视图函数register</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># print(request.form)</span></span><br><span class="line">        <span class="comment"># 提取 数据</span></span><br><span class="line">        email = request.form.get(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">        user_name = request.form.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        verify = request.form.get(<span class="string">&quot;verify&quot;</span>)  <span class="comment"># 后面再使用</span></span><br><span class="line">        <span class="comment"># 只要有1个需要的数据，没有，那么就返回数据有误</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (email <span class="keyword">and</span> user_name <span class="keyword">and</span> password):</span><br><span class="line">            <span class="comment"># 返回对应的数据</span></span><br><span class="line">            ret = &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;errmsg&quot;</span>: <span class="string">&quot;输入数据有误，请重新输入&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(ret)</span><br><span class="line">        <span class="comment"># 业务处理：注册用户</span></span><br><span class="line">        <span class="comment"># 判断是否注册过</span></span><br><span class="line">        <span class="comment"># 1. 业务处理</span></span><br><span class="line">        db_session = sessionmaker(bind=engine)()  <span class="comment"># 生成链接数据库的实例</span></span><br><span class="line">        user_ret = db_session.query(User).<span class="built_in">filter</span>(or_(User.email == email, User.user_name == user_name)).first()</span><br><span class="line">        <span class="keyword">if</span> user_ret:</span><br><span class="line">            <span class="comment"># 2. 如果邮箱或者用户名已经存在，则不允许使用</span></span><br><span class="line">            <span class="comment"># 3. 返回对应的数据</span></span><br><span class="line">            ret = &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;errmsg&quot;</span>: <span class="string">&quot;邮箱或用户名已存在，请修改&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 3. 未注册，那么则进行注册</span></span><br><span class="line">            user_id = email[:email.find(<span class="string">&quot;@&quot;</span>)]</span><br><span class="line">            new_user = User(email=email, user_id=user_id, password=password, user_name=user_name)</span><br><span class="line">            db_session.add(new_user)</span><br><span class="line">            db_session.commit()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 3. 返回对应的数据</span></span><br><span class="line">            ret = &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">&quot;errmsg&quot;</span>: <span class="string">&quot;注册成功&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        db_session.close()</span><br><span class="line">        <span class="keyword">return</span> jsonify(ret)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index/register.html&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>完善登录、注册的超链接<br><img src="/image/PyQT/30.jpg" alt=" "><br><img src="/image/PyQT/31.jpg" alt=" "></p>
<h3 id="图片验证码"><a href="#图片验证码" class="headerlink" title="图片验证码"></a>图片验证码</h3><h4 id="1-生成图片验证码"><a href="#1-生成图片验证码" class="headerlink" title="1.生成图片验证码"></a>1.生成图片验证码</h4><p>PIL 是python的一个第三方图片处理模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pillow <span class="comment"># 终端中输入安装命令</span></span><br></pre></td></tr></table></figure>
<p>字体库：<a target="_blank" rel="noopener" href="http://font.chinaz.com/yingwenziti.html">http://font.chinaz.com/yingwenziti.html</a></p>
</li>
<li><p>PIL使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line"><span class="comment"># 实例一个图片对象240 x 60:</span></span><br><span class="line">width = <span class="number">60</span> * <span class="number">4</span></span><br><span class="line">height = <span class="number">60</span></span><br><span class="line"><span class="comment"># 图片颜色</span></span><br><span class="line">clo = (<span class="number">43</span>, <span class="number">34</span>, <span class="number">88</span>)  <span class="comment"># 我觉得是紫蓝色</span></span><br><span class="line">image = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height), clo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Font对象:</span></span><br><span class="line"><span class="comment"># 字体文件可以使用操作系统的，也可以网上下载</span></span><br><span class="line">font = ImageFont.truetype(<span class="string">&#x27;./font/CorporateS-RegularItalic.otf&#x27;</span>, <span class="number">36</span>)</span><br><span class="line"><span class="comment"># 创建Draw对象:</span></span><br><span class="line">draw = ImageDraw.Draw(image)</span><br><span class="line"><span class="comment"># 输出文字:</span></span><br><span class="line">str1 = <span class="string">&quot;ren ren Python&quot;</span></span><br><span class="line">w = <span class="number">4</span>  <span class="comment"># 距离图片左边距离</span></span><br><span class="line">h = <span class="number">10</span>  <span class="comment"># 距离图片上边距离</span></span><br><span class="line">draw.text((w, h), str1, font=font)</span><br><span class="line"><span class="comment"># 模糊:</span></span><br><span class="line">image.<span class="built_in">filter</span>(ImageFilter.BLUR)</span><br><span class="line">code_name = <span class="string">&#x27;test_code_img.jpg&#x27;</span></span><br><span class="line">save_dir = <span class="string">&#x27;./&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(code_name)</span><br><span class="line">image.save(save_dir, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;已保存图片: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(save_dir))</span><br></pre></td></tr></table></figure>
<h4 id="2-网页中显示验证码"><a href="#2-网页中显示验证码" class="headerlink" title="2.网页中显示验证码"></a>2.网页中显示验证码</h4></li>
<li><p>添加verification_code.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid1</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rnd_char</span>():</span><br><span class="line">    <span class="comment"># 随机一个字母或者数字</span></span><br><span class="line">    i = random.randint(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 随机个数字的十进制ASCII码</span></span><br><span class="line">        an = random.randint(<span class="number">97</span>, <span class="number">122</span>)</span><br><span class="line">    <span class="keyword">elif</span> i == <span class="number">2</span>:</span><br><span class="line">        <span class="comment"># 随机个小写字母的十进制ASCII码</span></span><br><span class="line">        an = random.randint(<span class="number">65</span>, <span class="number">90</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 随机个大写字母的十进制ASCII码</span></span><br><span class="line">        an = random.randint(<span class="number">48</span>, <span class="number">57</span>)</span><br><span class="line">    <span class="comment"># 根据Ascii码转成字符，return回去</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(an)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 干扰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rnd_dis</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    随机一个干扰字</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    d = [<span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;~&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;.&#x27;</span>]</span><br><span class="line">    i = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(d) - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> d[i]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个随机颜色都规定不同的区域，防止干扰字符和验证码字符颜色一样</span></span><br><span class="line"><span class="comment"># 随机颜色1:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rnd_color</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    随机颜色，规定一定范围</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机颜色2:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rnd_color2</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      随机颜色，规定一定范围</span></span><br><span class="line"><span class="string">      :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_code</span>():</span><br><span class="line">    <span class="comment"># 240 x 60:</span></span><br><span class="line">    width = <span class="number">60</span> * <span class="number">4</span></span><br><span class="line">    height = <span class="number">60</span></span><br><span class="line">    image = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height), (<span class="number">192</span>, <span class="number">192</span>, <span class="number">192</span>))</span><br><span class="line">    <span class="comment"># 创建Font对象:</span></span><br><span class="line">    font = ImageFont.truetype(<span class="string">&#x27;./font/CorporateS-RegularItalic.otf&#x27;</span>, <span class="number">36</span>)</span><br><span class="line">    <span class="comment"># 创建Draw对象:</span></span><br><span class="line">    draw = ImageDraw.Draw(image)</span><br><span class="line">    <span class="comment"># 填充每个像素:</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width, <span class="number">20</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, height, <span class="number">10</span>):</span><br><span class="line">            draw.point((x, y), fill=rnd_color())</span><br><span class="line">    <span class="comment"># 填充字符</span></span><br><span class="line">    _<span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 填入4个随机的数字或字母作为验证码</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        c = rnd_char()</span><br><span class="line">        _<span class="built_in">str</span> = <span class="string">&quot;&#123;&#125;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(_<span class="built_in">str</span>, c)</span><br><span class="line">        <span class="comment"># 随机距离图片上边高度，但至少距离30像素</span></span><br><span class="line">        h = random.randint(<span class="number">1</span>, height - <span class="number">30</span>)</span><br><span class="line">        <span class="comment"># 宽度的化，每个字符占图片宽度1／4,在加上10个像素空隙</span></span><br><span class="line">        w = width / <span class="number">4</span> * t + <span class="number">10</span></span><br><span class="line">        draw.text((w, h), c, font=font, fill=rnd_color2())</span><br><span class="line">    <span class="comment"># 实际项目中，会将验证码 保存在数据库，并加上时间字段</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;保存验证码 &#123;&#125; 到数据库&quot;</span>.<span class="built_in">format</span>(_<span class="built_in">str</span>))</span><br><span class="line">    <span class="comment"># 给图片加上字符干扰，密集度由 w, h控制</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width, <span class="number">30</span>):</span><br><span class="line">        dis = rnd_dis()</span><br><span class="line">        w = t * <span class="number">15</span> + j</span><br><span class="line">        <span class="comment"># 随机距离图片上边高度，但至少距离30像素</span></span><br><span class="line">        h = random.randint(<span class="number">1</span>, height - <span class="number">30</span>)</span><br><span class="line">        draw.text((w, h), dis, font=font, fill=rnd_color())</span><br><span class="line">    <span class="comment"># 模糊:</span></span><br><span class="line">    image.<span class="built_in">filter</span>(ImageFilter.BLUR)</span><br><span class="line">    <span class="comment"># uuid1 生成唯一的字符串作为验证码图片名称</span></span><br><span class="line">    code_name = <span class="string">&#x27;&#123;&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(uuid1())</span><br><span class="line">    save_dir = <span class="string">&#x27;./&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(code_name)</span><br><span class="line">    image.save(save_dir, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;已保存图片: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(save_dir))</span><br><span class="line">    <span class="comment"># --------------下面return语句是新添加的----------------</span></span><br><span class="line">    <span class="keyword">return</span> _<span class="built_in">str</span>, save_dir</span><br></pre></td></tr></table></figure></li>
<li><p>修改main.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from flask import make_response</span><br><span class="line">from flask import session</span><br><span class="line">from verification_code import create_code</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&quot;/verification_code&quot;</span>)</span><br><span class="line">def verification_code():</span><br><span class="line">    <span class="comment"># 调用函数，生成图片验证码</span></span><br><span class="line">    code_str, img_path = create_code()</span><br><span class="line">    <span class="comment"># 读取图片的数据</span></span><br><span class="line">    with open(img_path, <span class="string">&quot;rb&quot;</span>) as f:</span><br><span class="line">        img_data = f.read()</span><br><span class="line">    <span class="comment"># 创建response对象</span></span><br><span class="line">    ret = make_response(img_data)</span><br><span class="line">    ret.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/jpg&#x27;</span></span><br><span class="line">    session[<span class="string">&#x27;img&#x27;</span>] = code_str.upper()</span><br><span class="line">    <span class="built_in">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>
<h4 id="3-网页中显示验证码升级版"><a href="#3-网页中显示验证码升级版" class="headerlink" title="3.网页中显示验证码升级版"></a>3.网页中显示验证码升级版</h4><p>web中使用验证码，不可能每次都先生成验证码图片，先保存到磁盘，再返回给前端 web<br>这样会增加磁盘的开销<br>另外频繁产生的验证码也会占用大量的磁盘空间<br>可以使用 BytesIO 模块，使验证码图片的读写直接在内存中进行，并直接返回给前端<br>同时将正确验证码字符串存在session中，当用户提交表单时，就可以和session中的正确字符串作比较了</p>
</li>
<li><p>修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> _<span class="built_in">str</span>, save_dir --&gt; <span class="keyword">return</span> _<span class="built_in">str</span>, image</span><br></pre></td></tr></table></figure></li>
<li><p>修改main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> make_response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> verification_code <span class="keyword">import</span> create_code</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/verification_code&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verification_code</span>():</span><br><span class="line">    <span class="comment"># 调用函数，生成图片验证码</span></span><br><span class="line">    code_str, code_img = create_code()</span><br><span class="line"></span><br><span class="line">    buf = BytesIO()</span><br><span class="line">    code_img.save(buf, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line">    image_data = buf.getvalue()</span><br><span class="line">    response = make_response(image_data)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/jpg&#x27;</span></span><br><span class="line">    session[<span class="string">&#x27;img&#x27;</span>] = code_str.upper()</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, port=<span class="number">7890</span>)</span><br></pre></td></tr></table></figure>
<h4 id="4-个人简历登录时添加图片验证码"><a href="#4-个人简历登录时添加图片验证码" class="headerlink" title="4.个人简历登录时添加图片验证码"></a>4.个人简历登录时添加图片验证码</h4><p><img src="/image/PyQT/32.jpg" alt=" "></p>
</li>
<li><p>将第三方验证码加入<br><img src="/image/PyQT/33.jpg" alt=" "></p>
</li>
<li><p>修改views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/captcha&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">captcha</span>():</span><br><span class="line">    <span class="keyword">from</span> utils.captcha.captcha <span class="keyword">import</span> captcha</span><br><span class="line">    <span class="comment"># 1. 获取到当前的图片编号id</span></span><br><span class="line">    captcah_id = request.args.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(captcah_id), captcah_id)</span><br><span class="line">    <span class="comment"># 2. 生成验证码</span></span><br><span class="line">    <span class="comment"># hash值  验证码值  图片内容</span></span><br><span class="line">    name, text, image = captcha.generate_captcha()</span><br><span class="line">    <span class="comment"># 3. 将生成的图片验证码值作为value，存储到session中</span></span><br><span class="line">    session[<span class="string">&quot;captcha&quot;</span>] = text</span><br><span class="line">    <span class="comment"># 返回响应内容</span></span><br><span class="line">    resp = make_response(image)</span><br><span class="line">    <span class="comment"># 设置内容类型</span></span><br><span class="line">    resp.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/jpg&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure></li>
<li><p>修改login.html<br><img src="/image/PyQT/34.jpg" alt=" "><br><img src="/image/PyQT/35.jpg" alt=" "></p>
<h4 id="5-个人简历注册时添加图片验证码"><a href="#5-个人简历注册时添加图片验证码" class="headerlink" title="5.个人简历注册时添加图片验证码"></a>5.个人简历注册时添加图片验证码</h4></li>
<li><p>修改register.html<br><img src="/image/PyQT/36.jpg" alt=" "></p>
</li>
<li><p>修改views.py<br><img src="/image/PyQT/37.jpg" alt=" "></p>
<h3 id="升级项目结构"><a href="#升级项目结构" class="headerlink" title="升级项目结构"></a>升级项目结构</h3><h4 id="1-flask-SQLAlchemy"><a href="#1-flask-SQLAlchemy" class="headerlink" title="1.flask-SQLAlchemy"></a>1.flask-SQLAlchemy</h4><p>每次使用SQLAlchemy都需要使用sessionmaker创建session，然后才可以使用，这样麻烦，使用flask-SQLAlchemy则可以更简单的使用SQLAlchemy</p>
<h5 id="修改代码"><a href="#修改代码" class="headerlink" title="修改代码"></a>修改代码</h5></li>
<li><p>安装<br><img src="/image/PyQT/38.jpg" alt=" "></p>
</li>
<li><p>创建flask-sqlalchemy扩展的SQLAlchemy对象<br><img src="/image/PyQT/39.jpg" alt=" "></p>
</li>
<li><p>对flask对象进行配置<br>此时SQLAlchemy需要flask应用对象中的配置，链接哪个数据库，用户名以及密码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加到main.py</span></span><br><span class="line"><span class="comment"># 设置数据库的链接地址</span></span><br><span class="line">app.config[<span class="string">&quot;SQLALCHEMY_DATABASE_URI&quot;</span>] = <span class="string">&#x27;mysql+pymysql://root:python@localhost:3306/flask_1?charset=utf8&#x27;</span></span><br><span class="line"><span class="comment"># 关闭追踪数据库的修改</span></span><br><span class="line">app.config[<span class="string">&quot;SQLALCHEMY_TRACK_MODIFICATIONS&quot;</span>] = <span class="literal">False</span></span><br></pre></td></tr></table></figure></li>
<li><p>升级项目结构<br><img src="/image/PyQT/40.jpg" alt=" "><br><img src="/image/PyQT/41.jpg" alt=" "></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改main.py</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = create_app()</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改views/admin/views.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.models.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> admin_blu</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@admin_blu.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@admin_blu.route(<span class="params"><span class="string">&quot;/index&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># 查询数据库</span></span><br><span class="line">    users_info = db.session.query(User).<span class="built_in">all</span>()</span><br><span class="line">    <span class="built_in">print</span>(users_info)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;admin/index2.html&quot;</span>, users=users_info)</span><br></pre></td></tr></table></figure>
<p>修改views&#x2F;index&#x2F;views.py<br><img src="/image/PyQT/42.jpg" alt=" "></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改app/models/models.py</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model):</span><br><span class="line">    <span class="comment"># 对应MySQL中数据表的名字</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建字段</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = db.Column(db.String(<span class="number">50</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    user_name = db.Column(db.String(<span class="number">50</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    email = db.Column(db.String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    head_img = db.Column(db.String(<span class="number">200</span>))</span><br><span class="line">    short_description = db.Column(db.String(<span class="number">300</span>))</span><br></pre></td></tr></table></figure>
<h4 id="2-添加配置文件"><a href="#2-添加配置文件" class="headerlink" title="2.添加配置文件"></a>2.添加配置文件</h4><p>项目的进行，后面需要对flask应用对象的配置会，越来越多，如果每次修改flask对象，总体感觉麻烦</p>
</li>
<li><p>配置值<br><img src="/image/PyQT/44.jpg" alt=" "></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建config.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;项目的配置类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    SECRET_KEY = <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="comment"># 数据库相关配置</span></span><br><span class="line">    <span class="comment"># SQLALCHEMY_DATABASE_URI = &#x27;mysql+pymysql://root:python@localhost:3306/flask_1?charset=utf8&#x27;</span></span><br><span class="line">    <span class="comment"># 关闭追踪数据库的修改</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DevelopmentConfig</span>(<span class="title class_ inherited__">Config</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;开发环境中的配置类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 开启调试模式</span></span><br><span class="line">    DEBUG = <span class="literal">True</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://root:python@localhost:3306/flask_1?charset=utf8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProductionConfig</span>(<span class="title class_ inherited__">Config</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生产环境(线上)中配置类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 配置生产环境中使用的配置类</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://user:xxxxxx@localhost:3306/flask_1?charset=utf8&#x27;</span></span><br><span class="line"></span><br><span class="line">APPCONFIG = &#123;</span><br><span class="line">    <span class="string">&#x27;development&#x27;</span>: DevelopmentConfig,</span><br><span class="line">    <span class="string">&#x27;production&#x27;</span>: ProductionConfig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改main.py</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = create_app(<span class="string">&#x27;development&#x27;</span>)</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>修改app&#x2F;<strong>init</strong>.py<br><img src="/image/PyQT/43.jpg" alt=" "></p>
<h4 id="3-异常捕获"><a href="#3-异常捕获" class="headerlink" title="3.异常捕获"></a>3.异常捕获</h4></li>
<li><p>abort 方法<br>抛出一个给定状态代码的 HTTPException 或者 指定响应，例如想要用一个页面未找到异常来终止请求，可以调用 abort(404) <strong>抛出状态码的话，只能抛出 HTTP 协议的错误状态码</strong></p>
</li>
<li><p>errorhandler 装饰器<br>捕获错误状态码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;服务器remove&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="给项目添加404界面"><a href="#给项目添加404界面" class="headerlink" title="给项目添加404界面"></a>给项目添加404界面</h5></li>
<li><p>修改app&#x2F;<strong>init</strong>.py<br><img src="/image/PyQT/45.jpg" alt=" "></p>
<h4 id="4-登录验证"><a href="#4-登录验证" class="headerlink" title="4.登录验证"></a>4.登录验证</h4></li>
<li><p>在utils下建立common包，common包下建立common.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session, g</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.models.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_user_data</span>(<span class="params">view_func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 尝试从session中获取user_id</span></span><br><span class="line">        user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>)  <span class="comment"># 获取不到，返回None</span></span><br><span class="line"></span><br><span class="line">        user = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> user_id:</span><br><span class="line">            <span class="comment"># 用户已登录</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                user = db.session.query(User).<span class="built_in">filter</span>(User.user_id == user_id).first()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;提取从User模型类查询，产生异常...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用g变量临时保存user信息</span></span><br><span class="line">        <span class="comment"># g变量中保存的数据可以在请求开始到请求结束过程中的使用</span></span><br><span class="line">        g.user = user</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view_func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure></li>
<li><p>编辑app&#x2F;views&#x2F;index&#x2F;views.py<br><img src="/image/PyQT/46.jpg" alt=" "><br><img src="/image/PyQT/48.jpg" alt=" "></p>
</li>
<li><p>修改common.py<br><img src="/image/PyQT/47.jpg" alt=" "></p>
<h4 id="5-请求勾子"><a href="#5-请求勾子" class="headerlink" title="5.请求勾子"></a>5.请求勾子</h4><p>钩子函数是指在执行函数和目标函数之间挂载的函数, 框架开发者给调用方提供一个point -挂载点, 至于挂载什么函数由我们调用方决定, 这样大大提高了灵活性</p>
</li>
<li><p>四种钩子<br>before_first_request<br>在处理第一个请求前执行<br>before_request<br>在每次请求前执行<br>如果在某修饰的函数中返回了一个响应，视图函数将不再被调用<br>after_request<br>如果没有抛出错误，在每次请求后执行<br>接受一个参数：视图函数作出的响应<br>在此函数中可以对响应值在返回之前做最后一步修改处理<br>需要将参数中的响应在此参数中进行返回<br>teardown_request：<br>在每次请求后执行<br>接受一个参数：错误信息，如果有相关错误抛出<br><strong>在debug模式下，teardown_request装饰的函数不会执行；<br>after_request请求钩子会自动传入response对象作为参数，同时必须返回一个response对象；<br>before_request装饰的函数不需要返回数据，如果返回了数据，那么视图函数不会再执行，而是直接返回结果。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在第一次请求之前调用，可以在此方法内部做一些初始化操作</span></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_first_request</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;before_first_request&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在每一次请求之前调用，这时候已经有请求了，可能在这个方法里面做请求的校验</span></span><br><span class="line"><span class="comment"># 如果请求的校验不成功，可以直接在此方法中进行响应，直接return之后那么就不会执行视图函数</span></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_request</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;before_request&quot;</span>)</span><br><span class="line">    <span class="comment"># if 请求不符合条件:</span></span><br><span class="line">    <span class="comment">#     return &quot;laowang&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在执行完视图函数之后会调用，并且会把视图函数所生成的响应传入,可以在此方法中对响应做最后一步统一的处理</span></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">after_request</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;after_request&quot;</span>)</span><br><span class="line">    response.headers[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请每一次请求之后都会调用，会接受一个参数，参数是服务器出现的错误信息</span></span><br><span class="line"><span class="meta">@app.teardown_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">teardown_request</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;teardown_request&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h4 id="6-上下文"><a href="#6-上下文" class="headerlink" title="6.上下文"></a>6.上下文</h4></li>
<li><p>请求上下文(request context) 保存了客户端和服务器交互的数据<br>request 封装了HTTP请求的内容，针对的是http请求。<br>举例：user &#x3D; request.args.get(‘user’)获取的是get请求的参数<br>session 用来记录请求会话中的信息，针对的是用户信息。<br>举例：session[‘name’] &#x3D; user.id可以记录用户信息。还可以通过session.get(‘name’)获取用户信息</p>
</li>
<li><p>应用上下文(application context) flask 应用程序运行过程中，保存的一些配置信息<br>current_app<br>应用程序上下文，用于存储应用程序中的变量，可以通过current_app.name打印当前app的名称，也可以在current_app中存储一些变量。<br>g变量<br>g 作为 flask 程序全局的一个临时变量,充当者中间媒介的作用,我们可以通过它传递一些数据，g 保存的是当前请求的全局变量，不同的请求会有不同的全局变量，通过不同的thread id区别</p>
<h3 id="分页、邮件、文件"><a href="#分页、邮件、文件" class="headerlink" title="分页、邮件、文件"></a>分页、邮件、文件</h3><h4 id="1-分页"><a href="#1-分页" class="headerlink" title="1.分页"></a>1.分页</h4><p>数据量很大时，如果每次都是将全部数据查询出来，不是一种好的思路，我们应该是只取出一部分来，这其实就是分页</p>
</li>
<li><p>offset()+limit()<br>用offset()设置索引偏移量,limit()限制取出量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">page_size = <span class="number">10</span>  <span class="comment"># 每页10个</span></span><br><span class="line">page_index = <span class="number">2</span>  <span class="comment"># 查询的是第几页开始(从1开始计算)</span></span><br><span class="line">email = <span class="string">&quot;xxxxxxxx@qq.com&quot;</span></span><br><span class="line">db.session.query(User).<span class="built_in">filter</span>(User.email.like(<span class="string">&#x27;%&#x27;</span>+email+<span class="string">&#x27;%&#x27;</span>)).limit(page_size).offset((page_index-<span class="number">1</span>)*page_size)</span><br><span class="line"><span class="comment"># filter语句后面可以跟order_by语句</span></span><br></pre></td></tr></table></figure></li>
<li><p>slice()<br>用slice(偏移量，取出量)函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">page_size = <span class="number">10</span>  <span class="comment"># 每页10个</span></span><br><span class="line">page_index = <span class="number">2</span>  <span class="comment"># 查询的是第几页开始(从1开始计算)</span></span><br><span class="line">email = <span class="string">&quot;xxxxxxxxx@qq.com&quot;</span></span><br><span class="line">db.session.query(User.name).<span class="built_in">filter</span>(User.email.like(<span class="string">&#x27;%&#x27;</span>+email+<span class="string">&#x27;%&#x27;</span>)).<span class="built_in">slice</span>((page_index - <span class="number">1</span>) * page_size, page_index * page_size)</span><br><span class="line"><span class="comment"># filter语句后面可以跟order_by语句</span></span><br></pre></td></tr></table></figure></li>
<li><p>paginate()<br>用paginate(偏移量，取出量)函数,用于BaseQuery</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># paginate的属性、方法</span></span><br><span class="line">has_next：判断是否有下一页</span><br><span class="line">has_prev：判断是否有上一页</span><br><span class="line">next_num：返回下一页页码</span><br><span class="line">prev_num：返回上一页页码</span><br><span class="line">page ：当前页码</span><br><span class="line">pages：总页数</span><br><span class="line">per_page：每一页的数据量</span><br><span class="line">prev():返回Pagination上一页的对象</span><br><span class="line"><span class="built_in">next</span>():返回Pagination下一页的对象</span><br><span class="line">items:返回当前页面项目，可遍历</span><br><span class="line">iter_pages(left_edge = <span class="number">2</span>，left_current = <span class="number">2</span>，right_current = <span class="number">5</span>，right_edge = <span class="number">2</span>):迭代分页中的页码</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">page_size = <span class="number">10</span>  <span class="comment"># 每页10个</span></span><br><span class="line">page_index = <span class="number">2</span>  <span class="comment"># 查询的是第几页开始(从1开始计算)</span></span><br><span class="line">email = <span class="string">&quot;xxxxxxxx@qq.com&quot;</span></span><br><span class="line">paginate=User.query.<span class="built_in">filter</span>(User.email.like(<span class="string">&#x27;%&#x27;</span>+email+<span class="string">&#x27;%&#x27;</span>)).paginate(<span class="built_in">int</span>(page_index), <span class="built_in">int</span>(page_size),<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 遍历时要加上items </span></span><br><span class="line">object_list =paginate.items</span><br></pre></td></tr></table></figure>
<h4 id="2-邮箱"><a href="#2-邮箱" class="headerlink" title="2.邮箱"></a>2.邮箱</h4></li>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask-mail</span><br></pre></td></tr></table></figure></li>
<li><p>test</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail, Message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 下面是SMTP服务器配置</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_SERVER&#x27;</span>] = <span class="string">&#x27;smtp.163.com&#x27;</span>  <span class="comment"># 电子邮件服务器的主机名或IP地址</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PORT&#x27;</span>] = <span class="number">25</span>  <span class="comment"># 电子邮件服务器的端口</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USE_TLS&#x27;</span>] = <span class="literal">True</span>  <span class="comment"># 启用传输层安全</span></span><br><span class="line"><span class="comment"># 注意这里启用的是TLS协议(transport layer security)，而不是SSL协议所以用的是25号端口</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_USERNAME&#x27;</span>] = <span class="string">&#x27;dong4716138_10@163.com&#x27;</span>  <span class="comment"># 你的邮件账户用户名</span></span><br><span class="line">app.config[<span class="string">&#x27;MAIL_PASSWORD&#x27;</span>] = <span class="string">&#x27;python123&#x27;</span>  <span class="comment"># 邮件账户的密码,这个密码是指的授权码!授权码!授权码!</span></span><br><span class="line"></span><br><span class="line">mail = Mail(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    msg = Message(<span class="string">&#x27;你好&#x27;</span>, sender=<span class="string">&#x27;dong4716138_10@163.com&#x27;</span>, recipients=[<span class="string">&#x27;@qq.com&#x27;</span>])</span><br><span class="line">    <span class="comment"># 这里的sender是发信人，写上你发信人的名字，比如张三。</span></span><br><span class="line">    <span class="comment"># recipients是收信人，用一个列表去表示。</span></span><br><span class="line">    msg.body = <span class="string">&#x27;你好&#x27;</span></span><br><span class="line">    msg.html = <span class="string">&#x27;&lt;b&gt;你好&lt;/b&gt; stranger&#x27;</span></span><br><span class="line">    mail.send(msg)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;邮件发送成功&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h4 id="3-文件上传"><a href="#3-文件上传" class="headerlink" title="3.文件上传"></a>3.文件上传</h4></li>
<li><p>修改profile2.html<br><img src="/image/PyQT/49.jpg" alt=" "></p>
</li>
<li><p>修改app&#x2F;views&#x2F;index&#x2F;views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/edit&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_user_data</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>():</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> g.user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;.login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index/edit.html&quot;</span>, user=g.user)</span><br></pre></td></tr></table></figure></li>
<li><p>新建app&#x2F;templates&#x2F;index&#x2F;edit.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>个人信息编辑页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.info</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;.edit&#x27;) &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&#x27;info&#x27;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;color:burlywood&quot;</span>&gt;</span>个人信息编辑<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;.index&#x27;) &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&quot;color:burlywood&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;edit_info_m&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span>&gt;</span></span><br><span class="line">&#123;#                <span class="tag">&lt;<span class="name">tr</span>&gt;</span>#&#125;</span><br><span class="line">&#123;#                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;140px&quot;</span>&gt;</span>用户id：<span class="tag">&lt;/<span class="name">td</span>&gt;</span>#&#125;</span><br><span class="line">&#123;#                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;userid&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; user.user_id &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;info_input info_input_170&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>#&#125;</span><br><span class="line">&#123;#                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>#&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;140px&quot;</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; user.user_name &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;info_input info_input_170&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;140px&quot;</span>&gt;</span>密<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>码：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; user.password &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;info_input info_input_170&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-family:Arial;&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">span</span>&gt;</span>：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; user.email &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;info_input info_input_170&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; user.head_img &#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>上传头像<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>自我描述<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;30&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;10&quot;</span>&gt;</span>&#123;&#123; user.short_description &#125;&#125;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&#x27;btn&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;保存编辑&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!--edit_info_m end--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改app&#x2F;views&#x2F;index&#x2F;views.py中的edit视图函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@index_blu.route(<span class="params"><span class="string">&quot;/edit&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_user_data</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>():</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> g.user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;.login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index/edit.html&quot;</span>, user=g.user)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># 1.提取数据</span></span><br><span class="line">        <span class="comment"># user_id = request.form.get(&quot;user_id&quot;)</span></span><br><span class="line">        username = request.form.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        email = request.form.get(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">        <span class="comment"># image = request.form.get(&quot;image&quot;)</span></span><br><span class="line">        content = request.form.get(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        current_user = g.user</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(current_app.root_path)  <span class="comment"># /Users/wangmingdong/Desktop/个人简历7/app</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取头像</span></span><br><span class="line">        <span class="built_in">print</span>(request.files)</span><br><span class="line">        f = request.files.get(<span class="string">&#x27;image&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> f:</span><br><span class="line">            <span class="comment"># basepath = os.path.dirname(__file__)  # 当前文件所在路径</span></span><br><span class="line">            <span class="comment"># # 注意：没有的文件夹一定要先创建，不然会提示没有该路径</span></span><br><span class="line">            image_type = f.filename[f.filename.rfind(<span class="string">&quot;.&quot;</span>):]</span><br><span class="line">            name_hash = hashlib.md5()</span><br><span class="line">            name_hash.update(f.filename.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">            image_file_name = name_hash.hexdigest()</span><br><span class="line">            image_file = image_file_name + image_type</span><br><span class="line">            image_path = os.path.join(<span class="string">&#x27;/static/upload/images&#x27;</span>, image_file)</span><br><span class="line">            upload_path = os.path.join(current_app.root_path, <span class="string">&#x27;static/upload/images&#x27;</span>, image_file)</span><br><span class="line">            <span class="built_in">print</span>(upload_path)</span><br><span class="line">            f.save(upload_path)</span><br><span class="line">            current_user.head_img = image_path</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 修改用户信息</span></span><br><span class="line">        <span class="comment"># current_user.user_id = user_id</span></span><br><span class="line">        current_user.user_name = username</span><br><span class="line">        current_user.password = password</span><br><span class="line">        current_user.email = email</span><br><span class="line">        current_user.short_description = content</span><br><span class="line">        <span class="comment"># 提交数据</span></span><br><span class="line">        db.session.commit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;.edit&quot;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>多个模板具有完全相同的顶部和底部内容，多个模板中具有相同的模板代码内容，但是内容中部分值不一样，多个模板中具有完全相同的 html 代码块内容，可以使用 JinJa2 模板中的 宏、继承、包含来进行实现</p>
<h4 id="1-宏-macro"><a href="#1-宏-macro" class="headerlink" title="1.宏 macro"></a>1.宏 macro</h4><p>看作 Jinja2 中的一个函数，它会返回一个模板或者 HTML 字符串<br>避免反复地编写同样的模板代码，出现代码冗余，可以把他们写成函数以进行重用<br>需要在多处重复使用的模板代码片段可以写入单独的文件，再包含在所有模板中，以避免重复</p>
<h5 id="使用宏升级后台"><a href="#使用宏升级后台" class="headerlink" title="使用宏升级后台"></a>使用宏升级后台</h5></li>
<li><p>在app&#x2F;templates&#x2F;admin下建立macro.html文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% macro function(loop, user) %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; loop.index &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    &#123;% if user.user_id | length &gt; 5 %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user.user_id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user.user_id | length &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user.user_name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user.head_img &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user.short_description &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endmacro %&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>修改app&#x2F;templates&#x2F;admin&#x2F;index2.html<br><img src="/image/PyQT/50.jpg" alt=" "></p>
<h4 id="2-模板继承"><a href="#2-模板继承" class="headerlink" title="2.模板继承"></a>2.模板继承</h4><p>模板继承是为了重用模板中的公共内容</p>
</li>
</ul>
<p>一般Web开发中，继承主要使用在网站的顶部菜单、底部。这些内容可以定义在父模板中，子模板直接继承，而不需要重复书写。</p>
<p>标签定义的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block top %&#125; &#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>相当于在父模板中挖个坑，当子模板继承父模板时，可以进行填充<br>子模板使用extends指令声明这个模板继承自哪个模板<br>父模板中定义的块在子模板中被重新定义，在子模板中调用父模板的内容可以使用super()</p>
<p><strong>不支持多继承</strong><br>为了便于阅读，在子模板中使用extends时，尽量写在模板的第一行<br>不能在一个模板文件中定义多个相同名字的block标签<br>当在页面中使用多个block标签时，建议给结束标签起个名字，当多个block嵌套时，阅读性更好</p>
<h4 id="3-包含"><a href="#3-包含" class="headerlink" title="3.包含"></a>3.包含</h4><p>将另一个模板整个加载到当前模板中，并直接渲染</p>
<ul>
<li>include的使用<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include <span class="string">&#x27;hello.html&#x27;</span> %&#125;</span><br></pre></td></tr></table></figure>
在使用时，如果包含的模板文件不存在时，程序会抛出TemplateNotFound异常，可以加上 ignore missing 关键字。如果包含的模板文件不存在，会忽略这条include语句。<br>include 的使用加上关键字ignore missing<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include <span class="string">&#x27;hello.html&#x27;</span> ignore missing %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h3>CSRF全拼为Cross Site Request Forgery，译为跨站请求伪造<br><img src="/image/PyQT/51.jpg" alt=" "><h4 id="防止CSRF攻击"><a href="#防止CSRF攻击" class="headerlink" title="防止CSRF攻击"></a>防止CSRF攻击</h4>1.在浏览器向服务器请求时，服务器通过session的方式将得到的随机值(可以用hash)存储在服务器<br>2.且在页面中添加一个隐藏（隐藏的目的是不让用户看见，看见也没有任何用处）的的值，这个值与上一步的值一样<br>3.在用户点击提交的时候，将隐藏的那个值一起传递给后端服务器<br>4.服务器接下来从session提取第1步生成的数据，与第3步隐藏的那个数据进行判断是否想相等<br>5.如果比较之后两值一样，那么代表是正常的请求<br>6.如果没取到或者比较不一样，代表不是正常的请求，不执行下一步操作<h4 id="升级个人简历编辑功能"><a href="#升级个人简历编辑功能" class="headerlink" title="升级个人简历编辑功能"></a>升级个人简历编辑功能</h4></li>
<li>修改app&#x2F;views&#x2F;index&#x2F;views.py中的edit视图函数<br><img src="/image/PyQT/52.jpg" alt=" "></li>
<li>修改app&#x2F;templates&#x2F;index&#x2F;edit.html<br><img src="/image/PyQT/53.jpg" alt=" "></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://xczf.shop">betty bear</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xczf.shop/2023/05/01/python-flask/">http://xczf.shop/2023/05/01/python-flask/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xczf.shop" target="_blank">betty bear</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post_share"><div class="social-share" data-image="/image/35.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/15/OpenStack/"><img class="prev-cover" src="/image/25.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Openstack</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/01/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/"><img class="next-cover" src="/image/26.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">分布式存储</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/07/15/python-Django/" title="Python--Django（施工）"><img class="cover" src="/image/37.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-15</div><div class="title">Python--Django（施工）</div></div></a></div><div><a href="/2023/08/01/python-PyQt/" title="Python-PyQt"><img class="cover" src="/image/33.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-01</div><div class="title">Python-PyQt</div></div></a></div><div><a href="/2022/08/01/python-%E9%AB%98%E7%BA%A7/" title="Python-进阶"><img class="cover" src="/image/24.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-01</div><div class="title">Python-进阶</div></div></a></div><div><a href="/2021/07/15/python-%E7%88%AC%E8%99%AB/" title="python 爬虫"><img class="cover" src="/image/22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-15</div><div class="title">python 爬虫</div></div></a></div><div><a href="/2020/07/15/pythonGUI-%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98/" title="Python--pygame 坦克大战"><img class="cover" src="/image/15.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-15</div><div class="title">Python--pygame 坦克大战</div></div></a></div><div><a href="/2022/06/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构(Python)"><img class="cover" src="/image/14.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-16</div><div class="title">数据结构(Python)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">betty bear</div><div class="author-info__description">最在意的，或许得不到了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ccmmdd"><i class="fab fa-github"></i><span>不要点我呀！</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ccmmdd" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3025346417@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">你也不想这件事被发现吧！~~~///(^v^)\\\~~~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">Web框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask"><span class="toc-number">2.</span> <span class="toc-text">Flask</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85flask%E5%8D%B3%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">安装flask即虚拟环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2"><span class="toc-number">2.1.1.</span> <span class="toc-text">第一个页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">2.2.</span> <span class="toc-text">路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8C%87%E5%AE%9A%E8%B7%AF%E7%94%B1%E5%9C%B0%E5%9D%80"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.指定路由地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.路由传参</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.3.</span> <span class="toc-text">Jinja2模板引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flask%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.4.</span> <span class="toc-text">flask使用数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87"><span class="toc-number">2.4.1.</span> <span class="toc-text">数据库准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.4.2.</span> <span class="toc-text">数据库的操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SQLAlchemy%E8%BF%9B%E8%A1%8C%E5%8D%87%E7%BA%A7"><span class="toc-number">2.4.3.</span> <span class="toc-text">使用SQLAlchemy进行升级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AApython%E5%8C%85"><span class="toc-number">2.4.4.</span> <span class="toc-text">新建立一个python包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">2.5.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.5.1.</span> <span class="toc-text">重定向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">2.5.2.</span> <span class="toc-text">自定义状态码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86"><span class="toc-number">3.</span> <span class="toc-text">Flask高级部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%93%9D%E5%9B%BE"><span class="toc-number">3.1.</span> <span class="toc-text">蓝图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%89%8D%E5%8F%B0%E5%90%8E%E5%8F%B0"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.前台后台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%90%8E%E5%8F%B0%E6%A8%A1%E6%9D%BF%E6%98%BE%E7%A4%BA"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.后台模板显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%90%8E%E5%8F%B0%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD%E2%80%93%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.后台基本功能–统计数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%A8%A1%E6%9D%BF-%E6%8E%A7%E5%88%B6%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="toc-number">3.1.4.</span> <span class="toc-text">4.模板-控制代码块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#if%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">if语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">循环</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%93%9D%E5%9B%BE"><span class="toc-number">3.1.5.</span> <span class="toc-text">5.蓝图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie%E5%92%8Csession"><span class="toc-number">3.2.</span> <span class="toc-text">cookie和session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%98%BE%E7%A4%BA%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.显示登录界面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.实现登录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%90%E5%8F%96url%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">提取url参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">修改数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81%E6%9C%80%E5%88%9D%E6%96%B9%E5%BC%8F"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">登录验证最初方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-request"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-cookie%E8%A7%A3%E5%86%B3%E8%AE%A4%E8%AF%81%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.4.</span> <span class="toc-text">4.cookie解决认证的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95-cookie%E6%96%B9%E5%BC%8F"><span class="toc-number">3.2.5.</span> <span class="toc-text">5.退出登录-cookie方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-Session"><span class="toc-number">3.2.6.</span> <span class="toc-text">6.Session</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%86cookie%E5%8D%87%E7%BA%A7%E4%B8%BAsession"><span class="toc-number">3.2.6.1.</span> <span class="toc-text">将cookie升级为session</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">3.2.6.2.</span> <span class="toc-text">退出登录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E3%80%81Ajax%E3%80%81JSON"><span class="toc-number">3.3.</span> <span class="toc-text">POST、Ajax、JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%98%BE%E7%A4%BA%E6%B3%A8%E5%86%8C%E7%95%8C%E9%9D%A2"><span class="toc-number">3.3.1.</span> <span class="toc-text">1.显示注册界面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-ajax"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.ajax</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">图片验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">3.4.1.</span> <span class="toc-text">1.生成图片验证码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BD%91%E9%A1%B5%E4%B8%AD%E6%98%BE%E7%A4%BA%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">3.4.2.</span> <span class="toc-text">2.网页中显示验证码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BD%91%E9%A1%B5%E4%B8%AD%E6%98%BE%E7%A4%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8D%87%E7%BA%A7%E7%89%88"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.网页中显示验证码升级版</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86%E7%99%BB%E5%BD%95%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">3.4.4.</span> <span class="toc-text">4.个人简历登录时添加图片验证码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86%E6%B3%A8%E5%86%8C%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">3.4.5.</span> <span class="toc-text">5.个人简历注册时添加图片验证码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.5.</span> <span class="toc-text">升级项目结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-flask-SQLAlchemy"><span class="toc-number">3.5.1.</span> <span class="toc-text">1.flask-SQLAlchemy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81"><span class="toc-number">3.5.1.1.</span> <span class="toc-text">修改代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.2.</span> <span class="toc-text">2.添加配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.异常捕获</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%99%E9%A1%B9%E7%9B%AE%E6%B7%BB%E5%8A%A0404%E7%95%8C%E9%9D%A2"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">给项目添加404界面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="toc-number">3.5.4.</span> <span class="toc-text">4.登录验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%AF%B7%E6%B1%82%E5%8B%BE%E5%AD%90"><span class="toc-number">3.5.5.</span> <span class="toc-text">5.请求勾子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">3.5.6.</span> <span class="toc-text">6.上下文</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E3%80%81%E9%82%AE%E4%BB%B6%E3%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">分页、邮件、文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%86%E9%A1%B5"><span class="toc-number">3.6.1.</span> <span class="toc-text">1.分页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%82%AE%E7%AE%B1"><span class="toc-number">3.6.2.</span> <span class="toc-text">2.邮箱</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">3.6.3.</span> <span class="toc-text">3.文件上传</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.7.</span> <span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%8F-macro"><span class="toc-number">3.7.1.</span> <span class="toc-text">1.宏 macro</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%8F%E5%8D%87%E7%BA%A7%E5%90%8E%E5%8F%B0"><span class="toc-number">3.7.1.1.</span> <span class="toc-text">使用宏升级后台</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="toc-number">3.7.2.</span> <span class="toc-text">2.模板继承</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%8C%85%E5%90%AB"><span class="toc-number">3.7.3.</span> <span class="toc-text">3.包含</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF"><span class="toc-number">3.8.</span> <span class="toc-text">CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E6%AD%A2CSRF%E6%94%BB%E5%87%BB"><span class="toc-number">3.8.1.</span> <span class="toc-text">防止CSRF攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">3.8.2.</span> <span class="toc-text">升级个人简历编辑功能</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/10/01/DevOps/" title="devops"><img src="/image/16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="devops"/></a><div class="content"><a class="title" href="/2023/10/01/DevOps/" title="devops">devops</a><time datetime="2023-10-01T11:00:41.000Z" title="发表于 2023-10-01 19:00:41">2023-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/01/memcache/" title="memcache"><img src="/image/27.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="memcache"/></a><div class="content"><a class="title" href="/2023/09/01/memcache/" title="memcache">memcache</a><time datetime="2023-09-01T11:00:41.000Z" title="发表于 2023-09-01 19:00:41">2023-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/01/python-PyQt/" title="Python-PyQt"><img src="/image/33.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-PyQt"/></a><div class="content"><a class="title" href="/2023/08/01/python-PyQt/" title="Python-PyQt">Python-PyQt</a><time datetime="2023-08-01T11:00:41.000Z" title="发表于 2023-08-01 19:00:41">2023-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/15/OpenStack/" title="Openstack"><img src="/image/25.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Openstack"/></a><div class="content"><a class="title" href="/2023/07/15/OpenStack/" title="Openstack">Openstack</a><time datetime="2023-07-15T11:00:41.000Z" title="发表于 2023-07-15 19:00:41">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/01/python-flask/" title="Python-Flask"><img src="/image/35.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-Flask"/></a><div class="content"><a class="title" href="/2023/05/01/python-flask/" title="Python-Flask">Python-Flask</a><time datetime="2023-05-01T11:00:41.000Z" title="发表于 2023-05-01 19:00:41">2023-05-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/35.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By betty bear</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">啊，对对对!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://xczf.shop/2023/05/01/python-flask/'
    this.page.identifier = '2023/05/01/python-flask/'
    this.page.title = 'Python-Flask'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer src="/live2d-widget/autoload.js"></script><div class="aplayer no-destroy" data-id="8828254214" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>