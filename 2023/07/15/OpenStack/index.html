<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Openstack | betty bear</title><meta name="keywords" content="Linux"><meta name="author" content="betty bear,3025346417@qq.com"><meta name="copyright" content="betty bear"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="OpenStack文档 http:&#x2F;&#x2F;docs.openstack.or社区 www.openstack.org,wiki.openstack.org 一.OpenStack简介云计算是一种按使用量付费的模式，这种模式提供可用的、便捷的、按需的网络访问， 进入可配置的计算资源共享池（资源包括网络，服务器，存储，应用软件，服务）OpenStack：是由 Rackspace 和 NASA 共同开发的云">
<meta property="og:type" content="article">
<meta property="og:title" content="Openstack">
<meta property="og:url" content="http://xczf.shop/2023/07/15/OpenStack/index.html">
<meta property="og:site_name" content="betty bear">
<meta property="og:description" content="OpenStack文档 http:&#x2F;&#x2F;docs.openstack.or社区 www.openstack.org,wiki.openstack.org 一.OpenStack简介云计算是一种按使用量付费的模式，这种模式提供可用的、便捷的、按需的网络访问， 进入可配置的计算资源共享池（资源包括网络，服务器，存储，应用软件，服务）OpenStack：是由 Rackspace 和 NASA 共同开发的云">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xczf.shop/image/25.jpg">
<meta property="article:published_time" content="2023-07-15T11:00:41.000Z">
<meta property="article:modified_time" content="2023-12-25T03:44:58.742Z">
<meta property="article:author" content="betty bear">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xczf.shop/image/25.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xczf.shop/2023/07/15/OpenStack/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":500,"languages":{"author":"作者: betty bear","link":"链接: ","source":"来源: betty bear","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Openstack',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-25 11:44:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="betty bear" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/25.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">betty bear</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Openstack</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-15T11:00:41.000Z" title="发表于 2023-07-15 19:00:41">2023-07-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-25T03:44:58.742Z" title="更新于 2023-12-25 11:44:58">2023-12-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/cate%EF%BC%9Agories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Openstack"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="OpenStack"><a href="#OpenStack" class="headerlink" title="OpenStack"></a>OpenStack</h1><p>文档 <a target="_blank" rel="noopener" href="http://docs.openstack.or/">http://docs.openstack.or</a><br>社区 <a target="_blank" rel="noopener" href="http://www.openstack.org,wiki.openstack.org/">www.openstack.org,wiki.openstack.org</a></p>
<h2 id="一-OpenStack简介"><a href="#一-OpenStack简介" class="headerlink" title="一.OpenStack简介"></a>一.OpenStack简介</h2><p>云计算是一种按使用量付费的模式，这种模式提供可用的、便捷的、按需的网络访问， 进入可配置的计算资源共享池（资源包括网络，服务器，存储，应用软件，服务）OpenStack：是由 Rackspace 和 NASA 共同开发的云计算平台， 是一个开源的 IaaS（基础设施及服务）云计算平台，让任何人都可以自行建立和提供云端运算服务<br><strong>云计算所包含的几个层次服务</strong><br>•SaaS（ Software as a Service）： 把在线软件作为一种服务。<br>•Paas（ Platform as a Service）： 把平台作为一种服务。<br>•Iaas（ Infrastructure as a Service）：把硬件设备作为一种服务。</p>
<h3 id="构成组件"><a href="#构成组件" class="headerlink" title="构成组件"></a>构成组件</h3><p><img src="/image/openstack/1.jpg" alt="1"></p>
<hr>
<ul>
<li>OpenStack 共享服务组件<br>数据库服务（ Database Service ）：MairaDB 及 MongoDB<br>消息传输（Message Queues）：RabbitMQ<br>缓存（cache）： Memcached<br>时间（time sync）：NTP<br>存储（storge provider）：ceph、GFS、LVM、ISICI 等<br>高可用及负载均衡：pacemaker、HAproxy、keepalive、lvs </li>
<li>OpenStack 核心组件<br>身份服务（ Identity Service ）：Keystone<br>计算（ Compute ）： Nova<br>镜像服务（ Image Service ）： Glance<br>网络 &amp; 地址管理（ Network ）： Neutron<br>对象存储（ Object Storage ）： Swift<br>块存储 (Block Storage) ： Cinder<br>UI 界面 (Dashboard) ： Horizon<br>测量 (Metering) ： Ceilometer<br>部署编排 (Orchestration) ： Heat<h3 id="ntp-网络时间协议"><a href="#ntp-网络时间协议" class="headerlink" title="ntp 网络时间协议"></a>ntp 网络时间协议</h3>NTP（Network Time Protocol）是TCP&#x2F;IP协议族里面的一个应用层协议，用来使客户端和服务器之间进行时钟同步，提供高精准度的时间校正。NTP服务器从权威时钟源（例如原子钟、GPS）接收精确的协调世界时UTC，客户端再从服务器请求和接收时间。<br>NTP基于UDP报文进行传输，使用的<strong>UDP端口号为123</strong><br><strong>内网环境安装NTP服务，一般有2种方式：<br>1、如果没有现成的时间同步服务器。一台主机A做为NTP服务器，其它主机B只安装ntpdate服务，B主机们通过ntpdate命令同步主机A的时间。</strong><br>2、有现成的时间同步服务器。所有主机直接通过ntpdate命令，同步时间服务器的时间。</li>
<li>yum安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ntp</span><br></pre></td></tr></table></figure></li>
<li>服务端配置 &#x2F;etc&#x2F;ntp.conf<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 然后添加这两行 ，意思是 允许IPV4 IPV6 查询 拒绝修改</span></span><br><span class="line">restrict -4 default kod notrap nomodify   </span><br><span class="line">restrict -6 default kod notrap nomodify </span><br><span class="line"><span class="comment">#  --------------- 其它配置方式 start ----------------- #</span></span><br><span class="line"><span class="comment"># 1.允许任何IP的客户机都可以进行时间同步</span></span><br><span class="line">restrict default nomodify</span><br><span class="line"><span class="comment"># 只允许192.168.11.*网段的客户机进行时间同步 </span></span><br><span class="line"><span class="comment"># 在restrict default nomodify notrap noquery（表示默认拒绝所有IP的时间同步）之后增加一行：</span></span><br><span class="line">restrict 192.168.11.0 mask 255.255.255.0 nomodify</span><br><span class="line"><span class="comment"># 只允许192.168.11.70机器修改本机时间</span></span><br><span class="line">restrict 192.168.11.70 nomodify notrap noquery</span><br><span class="line"><span class="comment"># 允许上层机器10.173.24.27 进行修改本机时间</span></span><br><span class="line">restrict 10.173.24.27 nomodify notrap noquery</span><br></pre></td></tr></table></figure></li>
<li>客户端配置 &#x2F;etc&#x2F;ntp.conf<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server 10.173.24.27  </span><br><span class="line">fudge 10.173.24.27 stratum 8 </span><br></pre></td></tr></table></figure></li>
<li>常用命令<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动,停止, 重启, 查询ntp服务状态</span></span><br><span class="line">service ntpd status    </span><br><span class="line">service ntpd start      </span><br><span class="line">service ntpd stop      </span><br><span class="line">service ntpd restart</span><br><span class="line"><span class="comment">#查看ntp服务器与上层ntp的状态</span></span><br><span class="line">ntpq -p     </span><br><span class="line"><span class="comment"># 命令查看时间同步状态</span></span><br><span class="line">ntpstat  </span><br></pre></td></tr></table></figure>
<h3 id="部署服务安装"><a href="#部署服务安装" class="headerlink" title="部署服务安装"></a>部署服务安装</h3><h4 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h4>控制节点：1个处理器，4 GB内存和5 GB存储<br>计算节点：1个处理器，2 GB内存和10 GB存储<br>在虚拟机中安装请调整内存、处理器和磁盘大小，以满足硬件最低要求，并勾选虚拟化<br>操作系统：CentOS 8.3<br><img src="/image/openstack/3.jpg" alt="设置"><h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4></li>
<li>修改主机名<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 控制节点</span></span><br><span class="line">hostnamectl set-hostname controller</span><br><span class="line"><span class="built_in">exec</span> bash</span><br><span class="line"><span class="comment"># 计算节点</span></span><br><span class="line">hostnamectl set-hostname compute</span><br><span class="line"><span class="built_in">exec</span> bash</span><br></pre></td></tr></table></figure></li>
<li>更换网路服务<br><strong>安装部署OpenStack时，OpenStack的网络服务会与NetworkManager服务产生冲突</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Network服务</span></span><br><span class="line">dnf install network-scripts -y</span><br><span class="line"><span class="comment"># 停用NetworkManager并禁止开机自启</span></span><br><span class="line">systemctl stop NetworkManager &amp;&amp; systemctl <span class="built_in">disable</span> NetworkManager</span><br><span class="line"><span class="comment"># 启用 Network并设置开机自启</span></span><br><span class="line">systemctl start network &amp;&amp; systemctl <span class="built_in">enable</span> network</span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure></li>
<li>配置host解析<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;192.168.xxx.xxx\tcontroller\n192.168.xxx.xxx\tcompute&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">cat</span> /etc/hosts</span><br></pre></td></tr></table></figure></li>
<li>时间同步<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y chrony vim</span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line"><span class="comment"># 注意：在计算节点仅修改第一条，修改为server controller iburst，直接与控制节点同步</span></span><br><span class="line"><span class="comment"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line">server ntp6.aliyun.com iburst</span><br><span class="line"><span class="comment"># Allow NTP client access from local network.</span></span><br><span class="line">allow 192.168.xxx.0/24</span><br><span class="line">systemctl restart chronyd &amp;&amp; systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure></li>
<li>安装openstack<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dnf config-manager --<span class="built_in">enable</span> powertools</span><br><span class="line">dnf install centos-release-openstack-victoria -y</span><br><span class="line">dnf upgrade -y</span><br><span class="line">dnf install python3-openstackclient openstack-selinux -y</span><br></pre></td></tr></table></figure>
<h4 id="SQL数据库"><a href="#SQL数据库" class="headerlink" title="SQL数据库"></a>SQL数据库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dnf install mariadb mariadb-server python3-PyMySQL -y</span><br><span class="line"><span class="comment"># 创建一个 [mysqld] 部分，并将 bind-address 密钥设置为控制器节点的管理IP地址，以允许其他节点通过管理网络进行访问</span></span><br><span class="line">vim /etc/my.cnf.d/openstack.cnf</span><br><span class="line">*****************************</span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = 192.168.xxx.xxx</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line">*****************************</span><br><span class="line">systemctl start mariadb &amp;&amp; systemctl <span class="built_in">enable</span> mariadb</span><br></pre></td></tr></table></figure>
<h2 id="二-Rabbitmq消息队列"><a href="#二-Rabbitmq消息队列" class="headerlink" title="二.Rabbitmq消息队列"></a>二.Rabbitmq消息队列</h2><h3 id="消息队列（-MQ-）"><a href="#消息队列（-MQ-）" class="headerlink" title="消息队列（ MQ ）"></a>消息队列（ MQ ）</h3>是一种应用程序对应用程序的通信方法。<strong>应用程序通过读写出入队列的消息来通信</strong>，而无需专用连接来链接它们。<br>消息传递指的是程序之间通过在消息中发送数据进行通信，而不是<strong>通过直接调用彼此来通信</strong>。排队指的是应用程序通过队列来通信。队列的使用除去了接收和发送应用程序同时执行的要求。<br>AMQP (Advanced Message Queuing Protocol)：高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计。消息中间件主要用于组件之间的解耦，消息的发送者无需知道消息使用者的存在，反之亦然。<h3 id="耦合、解耦"><a href="#耦合、解耦" class="headerlink" title="耦合、解耦"></a>耦合、解耦</h3>耦合就是一个系统的各个部分之间彼此关联、互相影响的程度。当系统内部的各个部分之间耦合度较高时，它们的行为会更加<strong>紧密地相互关联，但也更加复杂、难以控制</strong>。相反，当各个部分之间的耦合度较低时，它们的行为会更加独立，但也会导致系统的整体性能较差。<br>解耦就是是<strong>减少耦合的过程，使得模块或组件之间的依赖尽可能小</strong>。这样可以使得代码更加模块化、灵活、易于维护和扩展。<h3 id="Rabbitmq-概念"><a href="#Rabbitmq-概念" class="headerlink" title="Rabbitmq 概念"></a>Rabbitmq 概念</h3>特点：使用 Erlang 编写，支持持久化，支持 HA，提供 C# , erlang，java，perl，python，ruby 等的 client 开<br>Broker：简单来说就是消息队列服务器实体。<br>Exchange：消息交换机，它指定消息按什么规则，路由到哪个队列。<br>Queue：消息队列载体，每个消息都会被投入到一个或多个队列。<br>Binding：绑定，它的作用就是把 exchange 和 queue 按照路由规则绑定起来。<br>Routing Key：路由关键字， exchange 根据这个关键字进行消息投<br>vhost：虚拟主机，一个 broker 里可以开设多个 vhost，用作不同用户的权限分离。<br>producer：消息生产者，就是投递消息的程序。<br>consumer：消息消费者，就是接受消息的程序。<br>channel：消息通道，在客户端的每个连接里，可建立多个 channel，每个channel 代表一个会话任务。<h3 id="RabbitMQ-工作过程"><a href="#RabbitMQ-工作过程" class="headerlink" title="RabbitMQ 工作过程"></a>RabbitMQ 工作过程</h3></li>
</ul>
<ol>
<li>客户端连接到消息队列服务器，打开一个 channel。</li>
<li>客户端声明一个 exchange，并设置相关属性。</li>
<li>客户端声明一个 queue，并设置相关属性。</li>
<li>客户端使用 routing key，在 exchange 和 queue 之间建立好绑定关系。</li>
<li>客户端投递消息到 exchange。</li>
<li>exchange 接收到消息后，就根据消息的 key 和已经设置的 binding，进行消息路由，将消息投递到一个或多个队列里<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3></li>
</ol>
<ul>
<li>准备：3 台 linux 系统，epel源，无密钥登入<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br></pre></td></tr></table></figure></li>
<li>安装rabbtimq和erlang软件包（所有node）port:5672<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y erlang</span><br><span class="line">yum install rabbitmq-server.noarch -y</span><br><span class="line">systemctl <span class="built_in">enable</span> rabbitmq-server.service &amp;&amp; systemctl start rabbitmq-server.service</span><br></pre></td></tr></table></figure></li>
<li>编辑 rabbittmq 变量文件：node1<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RABBITMQ_NODE_PORT=5672</span><br><span class="line"><span class="built_in">ulimit</span> -S -n 4096</span><br><span class="line">RABBITMQ_SERVER_ERL_ARGS=<span class="string">&quot;+K true +A30 +P 1048576 -kernel inet_default_connect_options</span></span><br><span class="line"><span class="string">[&#123;nodelay,true&#125;,&#123;raw,6,18,&lt;&lt;5000:64/native&gt;&gt;&#125;] -kernel inet_default_listen_options</span></span><br><span class="line"><span class="string">[&#123;raw,6,18,&lt;&lt;5000:64/native&gt;&gt;&#125;]&quot;</span> RABBITMQ_NODE_IP_ADDRESS=192.168.189.130</span><br></pre></td></tr></table></figure></li>
<li>将 rabbittmq 变量文件拷贝到其他两节点，之后并修改相应节点的ip<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/rabbitmq/rabbitmq-env.conf con2:/etc/rabbitmq/</span><br><span class="line">scp /etc/rabbitmq/rabbitmq-env.conf con3:/etc/rabbitmq</span><br></pre></td></tr></table></figure>
查看 rabbitmq 插件 :&#x2F;usr&#x2F;lib&#x2F;rabbitmq&#x2F;bin&#x2F;rabbitmq-plugins list</li>
<li>开启web管理界面<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line">systemctl restart rabbitmq-server.service</span><br><span class="line"><span class="comment"># 修改密码为admin</span></span><br><span class="line">rabbitmqctl change_password guest admin</span><br><span class="line"><span class="comment"># 添加一个openstack用户，并设置为admin，权限为管理员</span></span><br><span class="line">rabbitmqctl add_user openstack admin</span><br><span class="line">rabbitmqctl set_permissions openstack <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br><span class="line">rabbitmqctl set_user_tags openstack administor</span><br></pre></td></tr></table></figure></li>
<li>发送 erlang.cookie 到其他节点配置集 node1 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl status</span><br><span class="line">scp /var/lib/rabbitmq/.erlang.cookie con2:/var/lib/rabbitmq/.erlang.cookie</span><br><span class="line">scp /var/lib/rabbitmq/.erlang.cookie con3:/var/lib/rabbitmq/.erlang.cookie</span><br><span class="line"><span class="comment"># node2 和 node3 停止应用，并以 ram 的方式加入 node1 节点，之后重启</span></span><br><span class="line">systemctl restart rabbitmq-server.service</span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl join_cluster --ram rabbit@con1</span><br><span class="line">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>
<strong>其他</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更改节点类型（内存型或磁盘型）</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl change_cluster_node_type disc 或 rabbitmqctl change_cluster_node_type ram</span><br><span class="line">rabbitmqctl start_app</span><br><span class="line"><span class="comment"># 从集群移除节点（或者重置节点）</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl reset</span><br><span class="line">rabbitmqctl start_app</span><br><span class="line">rabbitmqctl cluster_status</span><br><span class="line"><span class="comment"># 从某个节点移除集群中其他节点</span></span><br><span class="line">rabbitmqctl forget_cluster_node rabbit@node3</span><br><span class="line">rabbitmqctl reset</span><br><span class="line">rabbitmqctl start_app</span><br><span class="line">rabbitmqctl cluster_status</span><br></pre></td></tr></table></figure>
<h2 id="三-keystone身份认证服务"><a href="#三-keystone身份认证服务" class="headerlink" title="三.keystone身份认证服务"></a>三.keystone身份认证服务</h2>keystone是openstack的组件之一，用于为openstack家族中的其他组件成员提供统一的认证服务，包括身份验证、令牌的发放和校验、服务列表、用户权限的定义等等。云环境中所有的服务之间的授权和认证都需要经过keystone。<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3></li>
<li>user<br>使用服务的用户，可以是人、服务或者系统，只要是使用了openstack服务的对象都可以称为用户。当user对openstack进行访问时，keystone会对其身份进行验证。</li>
<li>project<br>租户，可以理解为一个人、项目或者组织拥有的资源的合集。在一个租户中可以拥有很多个用户，这些用户可以根据权限的划分使用租户中的资源。</li>
<li>role<br>角色，用于分配操作的权限，角色可以被指定给用户，使得该用户获得角色对应的操作权限。</li>
<li>service<br>openstack service，即openstack中运行的组件服务，如nova、glance等都是服务。服务决定每个role能做什么事情，服务通过各自的policy.json文件对role进行访问控制</li>
<li>endpoint<br>一个可以通过网络来访问和定位某个openstack service的地址，通常是一个URL，user通过endpoint访问资源和执行操作<br>三类endpoint<br>Admin URL：给admin用户使用，被从常规的访问中分离<br>Internal URL：openstack内部服务使用来跟别的服务通信，只能被局域网访问<br>public URL：其他用户可以访问的地址，可以被全局访问</li>
<li>credentials<br>用于确认用户身份的凭证<h3 id="认证原理"><a href="#认证原理" class="headerlink" title="认证原理"></a>认证原理</h3><img src="/image/openstack/4.jpg" alt="keystone"></li>
<li>Token认证原理<br>当用户拿着有效的用户名和密码去keystone认证后，keystone就会返回给他一个token，这个token就是一个uuid。以后用户进行其他操作时，都必须出示这个token，但是在大业务量的情况下，keystone将会成为性能瓶颈。</li>
<li>PKI认证原理<br>在keystone初始化时，keystone生成了CA的公钥CA.pem和私钥CA.key。同时，产生了自己的公钥keystone.pub和私钥keystone.key, 然后将keystone.pub进行了CA的签名，生成了keystone.pem。当用户拿着有效的用户名和密码去keystone认证后，keystone就将用户的基本信息通过keystone.key进行了加密，将这一密文作为token返回给用户。<h3 id="部署keystone-控制节点"><a href="#部署keystone-控制节点" class="headerlink" title="部署keystone (控制节点)"></a>部署keystone (控制节点)</h3><h4 id="创库授权"><a href="#创库授权" class="headerlink" title="创库授权"></a>创库授权</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE keystone;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;KEYSTONE_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;KEYSTONE_DBPASS&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>
<h4 id="安装KeyStone"><a href="#安装KeyStone" class="headerlink" title="安装KeyStone"></a>安装KeyStone</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-keystone httpd python3-mod_wsgi -y</span><br><span class="line"><span class="comment"># 备份该文件，然后去掉注释信息</span></span><br><span class="line"><span class="built_in">cp</span> /etc/keystone/keystone.conf /etc/keystone/keystone.conf.bak</span><br><span class="line">grep -Ev <span class="string">&#x27;^$|^#&#x27;</span> /etc/keystone/keystone.conf.bak &gt;/etc/keystone/keystone.conf</span><br><span class="line">vim /etc/keystone/keystone.conf</span><br><span class="line">*******************************</span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</span><br><span class="line">[token]</span><br><span class="line">provider = fernet</span><br><span class="line">********************</span><br></pre></td></tr></table></figure></li>
<li>配置工具:通过命令修改文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dnf install crudini -y</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf database connection</span><br><span class="line">mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf token provider fernet</span><br></pre></td></tr></table></figure></li>
<li>初始化<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c <span class="string">&quot;keystone-manage db_sync&quot;</span> keystone</span><br><span class="line">mysql -uroot -p123456 -e <span class="string">&quot;use keystone;show tables;&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>初始化Fernet<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure></li>
<li>引导身份认证服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password ADMIN_PASS \</span><br><span class="line">--bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure>
<h4 id="配置Apache-HTTP服务"><a href="#配置Apache-HTTP服务" class="headerlink" title="配置Apache HTTP服务"></a>配置Apache HTTP服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">***********************</span><br><span class="line">ServerName controller</span><br><span class="line">***********************</span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br><span class="line">systemctl start httpd &amp;&amp; systemctl <span class="built_in">enable</span> httpd</span><br><span class="line"><span class="comment"># 创建环境变量脚本来配置管理员账号</span></span><br><span class="line">vim /admin-openrc.sh</span><br><span class="line">***********************</span><br><span class="line"><span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=ADMIN_PASS</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_NAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br><span class="line">***********************</span><br></pre></td></tr></table></figure>
<h4 id="创建域，项目，用户和角色"><a href="#创建域，项目，用户和角色" class="headerlink" title="创建域，项目，用户和角色"></a>创建域，项目，用户和角色</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建域，程序中已存在默认域，此命令只是一个创建域的例子，可以不执行</span></span><br><span class="line">openstack domain create --description <span class="string">&quot;An Example Domain&quot;</span> example</span><br><span class="line"><span class="comment"># 创建 service 项目，也叫做租户</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;Service Project&quot;</span> service</span><br><span class="line"><span class="comment"># 创建 myproject 测试项目</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;Demo Project&quot;</span> myproject</span><br><span class="line"><span class="comment"># 创建 myuser 用户</span></span><br><span class="line"><span class="comment"># 执行命令后需要设置用户密码，输入两次相同的密码</span></span><br><span class="line">openstack user create --domain default --password-prompt myuser</span><br><span class="line"><span class="comment"># 创建 myrole 角色</span></span><br><span class="line">openstack role create myrole</span><br><span class="line"><span class="comment"># 将 myrole 角色添加到 myproject 项目和 myuser 用户</span></span><br><span class="line">openstack role add --project myproject --user myuser myrole</span><br><span class="line"><span class="comment"># 编辑环境变量脚本 vim /admin-openrc.sh ，修改脚本，把创建的项目用户信息添加到环境变量值</span></span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_NAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=ADMIN_PASS</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br><span class="line"><span class="built_in">export</span> OS_IMAGE_API_VERSION=2</span><br><span class="line"><span class="comment"># 初始化脚本，建议添加开机自启</span></span><br><span class="line"><span class="comment"># echo &#x27;source /admin-openrc.sh&#x27; &gt; .bashrc</span></span><br><span class="line"><span class="built_in">source</span> /admin-openrc.sh</span><br><span class="line"><span class="comment"># 验证KeyStone服务是否正常</span></span><br><span class="line">openstack token issue</span><br></pre></td></tr></table></figure>
<h2 id="四-Glance镜像服务"><a href="#四-Glance镜像服务" class="headerlink" title="四.Glance镜像服务"></a>四.Glance镜像服务</h2>Image Service的项目代号是Glance，它是Openstack的镜像服务组件。<br><strong>glance是openstack镜像服务，用来注册、登陆、和检索虚拟机镜像</strong><br>Glance服务提供了一个REST API，使你能够查询虚拟机镜像元数据和检索的实际镜像<br>通过镜像服务提供的虚拟机镜像可以存储在不同的位置<br>提供了对虚拟机部署的时候所能提供的镜像的管理，包括镜像的导入，格式以及制作相应的模板<br><img src="/image/openstack/5.jpg" alt="工作流程"><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3></li>
<li>alnce-api<br>接收镜像api的调用，注入镜像发现、恢复和存储</li>
<li>glance-registry<br>存储、处理和恢复镜像的元数据，元数据包括注入大小和类型。通过响应从 glance-api 发送过来的Image Metadata REST Request ，然后与MySQL进行交互，实现 Image Metadate 的存储、处理、获取</li>
<li>数据库<br>存放镜像元数据，用户是可以根据个人喜好选择数据库的，多数的部署使用MySQL</li>
<li>镜像文件的存储仓库<br>支持多种类型的仓库，他们有普通的文件系统、对象存储、RADOS块设备等。其中一些仓库仅支持只读</li>
<li>元数据定义服务<br>通用的API，是用于为厂商，管理员，服务，以及用户自定义元数据。这种元数据可用于不同的资源，例如镜像，工件，卷，配额以及集合。一个定义包括了新属性的建，描述，约束以及可以与之关联的资源的类型<h3 id="部署-控制节点"><a href="#部署-控制节点" class="headerlink" title="部署 (控制节点)"></a>部署 (控制节点)</h3></li>
<li>创库授权<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE glance; <span class="comment"># 创建数据库</span></span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;GLANCE_DBPASS&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;GLANCE_DBPASS&#x27;</span>;</span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure></li>
<li>创建glance用户并关联角色 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得 admin 凭证来获取只有管理员能执行的命令的访问权限</span></span><br><span class="line"><span class="built_in">source</span> admin-openrc</span><br><span class="line"><span class="comment"># 建glance用户并设置密码为GLANCE_PASS，此处与上面创建用户的不同之处是未使用交互式的方式，直接将密码放入了命令中</span></span><br><span class="line">openstack user create --domain default --password GLANCE_PASS glance</span><br><span class="line"><span class="comment"># 添加 admin 角色到 glance 用户和 service 项目上,在service的项目上给glance用户关联admin角色</span></span><br><span class="line">openstack role add --project service --user glance admin</span><br></pre></td></tr></table></figure></li>
<li>创建glance服务的API端点<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name glance --description <span class="string">&quot;OpenStack Image&quot;</span> image</span><br><span class="line">openstack endpoint create --region RegionOne image public</span><br><span class="line">http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne image internal</span><br><span class="line">http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne image admin</span><br><span class="line">http://controller:9292</span><br></pre></td></tr></table></figure></li>
<li>安装并配置glance<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-glance -y</span><br><span class="line"><span class="comment"># 消除注释后编辑修改</span></span><br><span class="line">vim /etc/glance/glance-api.conf</span><br><span class="line">*******************************</span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = GLANCE_PASS</span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor = keystone</span><br><span class="line">[glance_store]</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = /var/lib/glance/images/</span><br><span class="line"><span class="comment"># 同步数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;glance-manage db_sync&quot;</span> glance</span><br><span class="line"><span class="comment"># 启动glance服务并设置开机自启</span></span><br><span class="line">systemctl start openstack-glance-api &amp;&amp; systemctl <span class="built_in">enable</span> openstack-glance-api</span><br></pre></td></tr></table></figure></li>
<li>TEST<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.cirros-cloud.net/0.5.1/cirros-0.5.1-x86_64-disk.img</span><br><span class="line"><span class="comment"># 将当前目录下的cirros-0.5.1-x86_64-disk.img镜像命名为“cirros”，镜像格式是qcow2，容器格式是bare，设为公有镜像</span></span><br><span class="line">openstack image create <span class="string">&quot;cirros&quot;</span> --file cirros-0.5.1-x86_64-disk.img --disk-</span><br><span class="line">format qcow2 --container-format bare --public</span><br><span class="line">openstack image list <span class="comment"># 查看是否有镜像</span></span><br></pre></td></tr></table></figure>
<h2 id="五-Nova计算资源服务"><a href="#五-Nova计算资源服务" class="headerlink" title="五.Nova计算资源服务"></a>五.Nova计算资源服务</h2>负责虚拟机生命周期管理，其他计算资源生命周期管理<br>Glance为vm提供image<br>Cinder和Swift分别为VM提供块存储和对象存储<br>Neutron为VM提供网络连接<h3 id="Nova组件"><a href="#Nova组件" class="headerlink" title="Nova组件"></a>Nova组件</h3><h4 id="nova-api"><a href="#nova-api" class="headerlink" title="nova-api"></a>nova-api</h4>对外提供rest接口，接收和处理请求<br>对传入参数进行合法性校验和约束限制<br>对请求的资源进行配额的校验和预留<br>资源的创建，更新，删除查询等<h4 id="nova-conductor"><a href="#nova-conductor" class="headerlink" title="nova-conductor"></a>nova-conductor</h4>数据库操作，解耦其他组件对数据库的访问<br>nova复杂流程控制，如创建，冷迁移，热迁移，虚拟机规格调整，虚拟机重建<br>其他组件的依赖，如nova-compute需要nova-conducter启动成功后才能启动<br>其他组件的心跳定时写入<h4 id="nova-scheduler"><a href="#nova-scheduler" class="headerlink" title="nova-scheduler"></a>nova-scheduler</h4>筛选和确定将虚拟机实例分配到哪一台物理机<br>分配过程主要分为两部，过滤和权重<br>通过过滤器选择满足条件的计算结点<br>通过权重选择最优的结点<h4 id="nova-compute"><a href="#nova-compute" class="headerlink" title="nova-compute"></a>nova-compute</h4>虚拟机各生命周期操作的真正执行者<br>底层对接不同虚拟化的平台（KVM&#x2F;VMware&#x2F;XEN等）<br>内置周期性任务，完成资源刷新，虚拟机状态同步等功能<br>资源管理模块配置插件机制，完成资源的统计<h4 id="database"><a href="#database" class="headerlink" title="database"></a>database</h4>nova会有一些数据需要存放到数据库中，一般通常使用的是MySQL数据库安装在控制结点上<br>nova使用命名为nova的数据库<h4 id="Message-Queue"><a href="#Message-Queue" class="headerlink" title="Message Queue"></a>Message Queue</h4>nova包含众多的子服务，这些子服务之间需要相互协调相互通信<br>为解耦各个子服务之间，nova通过Message Queue作为子服务的消息中转站，他们都通过消息队列进行联系<br>通常使用rabbitmq消息队列<h4 id="组件协同工作"><a href="#组件协同工作" class="headerlink" title="组件协同工作"></a>组件协同工作</h4><img src="/image/openstack/6.jpg" alt="子服务协同工作"></li>
</ul>
<ol>
<li>客户向API发送请求（创建VM）</li>
<li>API对请求做一些必要处理后，想消息队列发送消息</li>
<li>scheduler从消息队列中获取到消息，然后执行调度算法，从若干个计算节点中选出节点A</li>
<li>计算节点A的compute从消息队列中获取到scheduler发送给他的消息，然后在本节点上的hypervisor上启动虚拟机</li>
<li>在虚拟机的创建过程中，compute如果需要查询或者更新数据库信息，会通过消息队列向conductor发送消息，conductor负责数据库访问<h3 id="部署Placement服务（控制节点）"><a href="#部署Placement服务（控制节点）" class="headerlink" title="部署Placement服务（控制节点）"></a>部署Placement服务（控制节点）</h3>Placement服务的作用是跟踪资源（如计算节点，存储资源池，网络资源池等）的使用情况，提供自定义资源的能力，为分配资源提供服务。<strong>Placement在openstack的Stein版本之前是属于Nova组件的一部分</strong></li>
</ol>
<ul>
<li>创库授权<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE placement;</span><br><span class="line"><span class="comment"># 授予Plancement数据库权限</span></span><br><span class="line">GRANT ALL PRIVILEGES ON placement.* TO <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;PLACEMENT_DBPASS&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON placement.* TO <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;PLACEMENT_DBPASS&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure></li>
<li>配置用户和Endpoint<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /admin-openrc.sh</span><br><span class="line"><span class="comment"># 创建一个plancement用户并设置密码为PLACEMENT_PASS</span></span><br><span class="line">openstack user create --domain default --password PLACEMENT_PASS placement</span><br><span class="line"><span class="comment"># admin角色将Placement用户添加到服务项目中</span></span><br><span class="line">openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure></li>
<li>创建Placement服务并注册API<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name placement --description <span class="string">&quot;Placement API&quot;</span> placement</span><br><span class="line">openstack endpoint create --region RegionOne placement public</span><br><span class="line">http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement internal</span><br><span class="line">http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement admin</span><br><span class="line">http://controller:8778</span><br></pre></td></tr></table></figure></li>
<li>安装并配置Plancement<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-placement-api -y</span><br><span class="line"><span class="comment"># 修改文件内容 /etc/placement/placement.conf</span></span><br><span class="line">[placement_database]</span><br><span class="line">connection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller/placement</span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = placement</span><br><span class="line">password = PLACEMENT_PASS</span><br><span class="line"><span class="comment"># 同步数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;placement-manage db sync&quot;</span> placement</span><br><span class="line"><span class="comment"># 检查Placement服务状态</span></span><br><span class="line">systemctl restart httpd &amp;&amp; placement-status upgrade check</span><br></pre></td></tr></table></figure>
<h3 id="Nova安装-控制节点和计算节点"><a href="#Nova安装-控制节点和计算节点" class="headerlink" title="Nova安装 控制节点和计算节点"></a>Nova安装 控制节点和计算节点</h3><h4 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h4></li>
<li>创库授权<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">CREATE DATABASE nova_cell0;</span><br><span class="line"><span class="comment"># 授权nova_api数据库</span></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;NOVA_DBPASS&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;NOVA_DBPASS&#x27;</span>;</span><br><span class="line"><span class="comment"># 授权nova数据库</span></span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;NOVA_DBPASS&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;NOVA_DBPASS&#x27;</span>;</span><br><span class="line"><span class="comment"># 授权nova_cell0数据库</span></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;NOVA_DBPASS&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;NOVA_DBPASS&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure></li>
<li>配置用户和Endpoint<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /admin-openrc.sh</span><br><span class="line"><span class="comment"># 创建nova用户并设置密码为NOVA_PASS</span></span><br><span class="line">openstack user create --domain default --password NOVA_PASS nova</span><br><span class="line"><span class="comment"># 使用admin角色将nova用户添加到服务项目中</span></span><br><span class="line">openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure></li>
<li>创建Nova服务并注册API<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name nova --description <span class="string">&quot;OpenStack Compute&quot;</span> compute</span><br><span class="line">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><br></pre></td></tr></table></figure></li>
<li>安装并配置Nova<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-nova-api openstack-nova-conductor openstack-nova-novncproxy openstack-nova-scheduler -y</span><br><span class="line"><span class="comment"># 编辑 vim /etc/nova/nova.conf 文件</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller:5672/</span><br><span class="line">my_ip = 192.168.175.201</span><br><span class="line">[api_database]</span><br><span class="line">connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api</span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova</span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000/</span><br><span class="line">auth_url = http://controller:5000/</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">server_listen = <span class="variable">$my_ip</span></span><br><span class="line">server_proxyclient_address = <span class="variable">$my_ip</span></span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line">[placement]</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = PLACEMENT_PASS</span><br></pre></td></tr></table></figure></li>
<li>同步数据库<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同步nova_api数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage api_db sync&quot;</span> nova</span><br><span class="line"><span class="comment"># 同步nova_cell0数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 map_cell0&quot;</span> nova</span><br><span class="line"><span class="comment"># 创建cell1</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span> nova</span><br><span class="line"><span class="comment"># 同步nova数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage db sync&quot;</span> nova</span><br></pre></td></tr></table></figure></li>
<li>开机自启<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start openstack-nova-api openstack-nova-scheduler openstack-nova-</span><br><span class="line">conductor openstack-nova-novncproxy &amp;&amp; systemctl <span class="built_in">enable</span> openstack-nova-api openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br></pre></td></tr></table></figure>
<h4 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h4></li>
<li>安装并配置Nova<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-nova-compute -y</span><br><span class="line"><span class="comment"># 编辑 vim /etc/nova/nova.conf 文件</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br><span class="line">my_ip = 192.166.66.11</span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000/</span><br><span class="line">auth_url = http://controller:5000/</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">server_listen = 0.0.0.0</span><br><span class="line">novncproxy_base_url = http://controller:6080/vnc_auto.html</span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line">[placement]</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = PLACEMENT_PASS</span><br></pre></td></tr></table></figure></li>
<li>确认计算节点是否支持硬件加速，如果是0，说明不支持，需要开启CPU虚拟化支持<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -c <span class="string">&#x27;(vmx|svm)&#x27;</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure></li>
<li>开机自启<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start libvirtd openstack-nova-compute &amp;&amp; systemctl <span class="built_in">enable</span> libvirtd openstack-nova-compute</span><br></pre></td></tr></table></figure>
<h4 id="计算节点安装配置完成后再回到控制节点操作"><a href="#计算节点安装配置完成后再回到控制节点操作" class="headerlink" title="计算节点安装配置完成后再回到控制节点操作"></a>计算节点安装配置完成后再回到控制节点操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载环境变量脚本 </span></span><br><span class="line"><span class="built_in">source</span> /admin-openrc.sh</span><br><span class="line">openstack compute service list --service nova-compute</span><br><span class="line"><span class="comment"># 同步计算节点</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span> nova</span><br><span class="line"><span class="comment"># 设置发现间隔时间，编辑 vim /etc/nova/nova.conf 文件</span></span><br><span class="line">[scheduler]</span><br><span class="line">discover_hosts_in_cells_interval = 300</span><br><span class="line"><span class="comment"># 命令修改方式</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf scheduler discover_hosts_in_cells_interval 300</span><br></pre></td></tr></table></figure>
<h2 id="六-Neutron-虚拟网络服务"><a href="#六-Neutron-虚拟网络服务" class="headerlink" title="六.Neutron 虚拟网络服务"></a>六.Neutron 虚拟网络服务</h2>Neutron是OpenStack云计算平台的核心组件之一，负责虚拟网络设备的创建和管理。这些虚拟的网络设备包括网桥、网络、端口。<h3 id="控制节点-1"><a href="#控制节点-1" class="headerlink" title="控制节点"></a>控制节点</h3></li>
<li>创库授权<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE neutron;</span><br><span class="line"><span class="comment"># 授予数据库权限，然后退出</span></span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY</span><br><span class="line"><span class="string">&#x27;NEUTRON_DBPASS&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;NEUTRON_DBPASS&#x27;</span>;</span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure></li>
<li>配置用户和Endpoint<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /admin-openrc.sh</span><br><span class="line">openstack user create --domain default --password NEUTRON_PASS neutron</span><br><span class="line"><span class="comment"># 在service的项目上给neutron用户关联admin角色</span></span><br><span class="line">openstack role add --project service --user neutron admin</span><br></pre></td></tr></table></figure></li>
<li>创建Neutron服务并注册API<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openstack service create --name neutron --description <span class="string">&quot;OpenStack Networking&quot;</span> network</span><br><span class="line"><span class="comment"># 创建Neutron服务API端口</span></span><br><span class="line">openstack endpoint create --region RegionOne network public http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne network internal http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne network admin http://controller:9696</span><br></pre></td></tr></table></figure></li>
<li>安装并配置Neutron<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y</span><br></pre></td></tr></table></figure>
<strong>公有网络和私有网络配置根据自身网络情况任意选择一种</strong></li>
<li>控制节点公有网络<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 vim /etc/neutron/neutron.conf</span></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins =</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = <span class="literal">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="literal">true</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line">[nova]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan</span><br><span class="line">tenant_network_types =</span><br><span class="line">mechanism_drivers = linuxbridge</span><br><span class="line">extension_drivers = port_security</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens33</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver =</span><br><span class="line">neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">***************************************</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl net.bridge.bridge-nf-call-iptables</span><br><span class="line">sysctl net.bridge.bridge-nf-call-ip6tables</span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/dhcp_agent.ini</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/metadata_agent.ini 文件</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">nova_metadata_host = controller</span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br><span class="line"><span class="comment"># 编辑 vim /etc/nova/nova.conf</span></span><br><span class="line">[neutron]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line">service_metadata_proxy = <span class="literal">true</span></span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure></li>
<li>控制节点私有网络<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 vim /etc/neutron/neutron.conf</span></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins = router</span><br><span class="line">allow_overlapping_ips = <span class="literal">true</span></span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = <span class="literal">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="literal">true</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line">[nova]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = NOVA_PASS</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan,vxlan</span><br><span class="line">tenant_network_types = vxlan</span><br><span class="line">mechanism_drivers = linuxbridge,l2population</span><br><span class="line">extension_drivers = port_security</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[ml2_type_vxlan]</span><br><span class="line">vni_ranges = 1:1000</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens33</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">true</span></span><br><span class="line">local_ip = 192.168.175.201</span><br><span class="line">l2_population = <span class="literal">true</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver =</span><br><span class="line">neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">******************************************</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl net.bridge.bridge-nf-call-iptables</span><br><span class="line">sysctl net.bridge.bridge-nf-call-ip6tables</span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/l3_agent.ini</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/dhcp_agent.ini</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/metadata_agent.ini</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">nova_metadata_host = controller</span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br><span class="line">memcache_servers = controller:11211</span><br><span class="line"><span class="comment"># 编辑 vim /etc/nova/nova.conf</span></span><br><span class="line">[neutron]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line">service_metadata_proxy = <span class="literal">true</span></span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure></li>
<li>控制节点安装确认<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 vim /etc/neutron/neutron.conf</span></span><br><span class="line">[privsep]</span><br><span class="line">user = neutron</span><br><span class="line">helper_command = sudo privsep-helper</span><br><span class="line"><span class="comment"># 修改 vim /etc/sudoers.d/neutron</span></span><br><span class="line">neutron ALL = (root) NOPASSWD: ALL</span><br><span class="line">**********************************</span><br><span class="line"><span class="built_in">ln</span> -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf -</span></span><br><span class="line"><span class="string">-config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron</span><br><span class="line">systemctl restart openstack-nova-api</span><br><span class="line">systemctl restart neutron-server neutron-linuxbridge-agent neutron-dhcp-agent</span><br><span class="line">neutron-metadata-agent &amp;&amp;</span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-server neutron-linuxbridge-agent neutron-dhcp-agent</span><br><span class="line">neutron-metadata-agent</span><br><span class="line"><span class="comment"># 对于私有网络，还应该启动L3服务并设为开机自启</span></span><br><span class="line">systemctl restart neutron-l3-agent &amp;&amp; systemctl <span class="built_in">enable</span> neutron-l3-agent</span><br></pre></td></tr></table></figure></li>
<li>计算节点<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-neutron-linuxbridge ebtables ipset -y</span><br><span class="line"><span class="comment"># 编辑 vim /etc/neutron/neutron.conf</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:RABBIT_PASS@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure></li>
<li>计算节点公有网络<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens33</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver =</span><br><span class="line">neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">******************************************</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl net.bridge.bridge-nf-call-iptables</span><br><span class="line">sysctl net.bridge.bridge-nf-call-ip6tables</span><br></pre></td></tr></table></figure></li>
<li>计算节点私有网络<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens33</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">true</span></span><br><span class="line">local_ip = 192.168.175.202</span><br><span class="line">l2_population = <span class="literal">true</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver =</span><br><span class="line">neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">******************************************</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl net.bridge.bridge-nf-call-iptables</span><br><span class="line">sysctl net.bridge.bridge-nf-call-ip6tables</span><br></pre></td></tr></table></figure></li>
<li>为Nova配置网络服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 vim /etc/nova/nova.conf</span></span><br><span class="line">[neutron]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = NEUTRON_PASS</span><br></pre></td></tr></table></figure></li>
<li>计算节点安装确认<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 vim /etc/neutron/neutron.conf</span></span><br><span class="line">[privsep]</span><br><span class="line">user = neutron</span><br><span class="line">helper_command = sudo privsep-helper</span><br><span class="line"><span class="comment"># 修改 vim /etc/sudoers.d/neutron</span></span><br><span class="line">neutron ALL = (root) NOPASSWD: ALL</span><br><span class="line">setenforce 0</span><br><span class="line">systemctl restart openstack-nova-compute</span><br><span class="line">systemctl start neutron-linuxbridge-agent &amp;&amp; systemctl <span class="built_in">enable</span> neutron-linuxbridge-agent</span><br></pre></td></tr></table></figure>
<h2 id="七-Horizon"><a href="#七-Horizon" class="headerlink" title="七.Horizon"></a>七.Horizon</h2>Horizon使用的是Django应用程序为用户和管理员提供一个管理OpenStack服务的接口。</li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install openstack-dashboard -y</span><br></pre></td></tr></table></figure></li>
<li>配置Horizon文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 vim /etc/openstack-dashboard/local_settings</span></span><br><span class="line"><span class="comment"># 配置仪表盘在controller节点上使用openstack服务</span></span><br><span class="line">OPENSTACK_HOST = <span class="string">&quot;controller&quot;</span></span><br><span class="line"><span class="comment"># 配置运行访问仪表盘的主机，星号表示运行所有主机访问</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]</span><br><span class="line"><span class="comment"># 配置memcached会话存储服务</span></span><br><span class="line">SESSION_ENGINE = 		<span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;controller:11211&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 启用身份API版本3</span></span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">&quot;http://%s:5000/v3&quot;</span> % OPENSTACK_HOST</span><br><span class="line">TIME_ZONE = <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="comment"># 上面几项修改即可，以下为新增信息</span></span><br><span class="line"><span class="comment"># 启用对域的支持</span></span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line"><span class="comment"># 配置API版本</span></span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">&quot;identity&quot;</span>: 3,</span><br><span class="line">    <span class="string">&quot;image&quot;</span>: 2,</span><br><span class="line">    <span class="string">&quot;volume&quot;</span>: 3,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 配置默认域</span></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">&quot;Default&quot;</span></span><br><span class="line"><span class="comment"># 配置默认角色</span></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">&quot;user&quot;</span></span><br><span class="line"><span class="comment"># 启用对第3层网络服务的支持，若是公有网络则需要禁用对第3层网络服务的支持，将True改为FalseOPENSTACK_NEUTRON_NETWORK = &#123;</span></span><br><span class="line">    <span class="string">&#x27;enable_router&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_quotas&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_distributed_router&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_ha_router&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_lb&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_firewall&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_vpn&#x27;</span>: True,</span><br><span class="line">    <span class="string">&#x27;enable_fip_topology_check&#x27;</span>: True,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>编辑 vim &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;openstack-dashboard.conf 文件，添加以下内容<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br></pre></td></tr></table></figure></li>
<li>重建apache的dashboard配置文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/openstack-dashboard</span><br><span class="line">python3 manage.py make_web_conf --apache &gt; /etc/httpd/conf.d/openstack-</span><br><span class="line">dashboard.conf</span><br></pre></td></tr></table></figure></li>
<li>建立策略文件（policy.json）的软链接<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /etc/openstack-dashboard /usr/share/openstack-</span><br><span class="line">dashboard/openstack_dashboard/conf</span><br><span class="line">systemctl restart httpd &amp;&amp; systemctl <span class="built_in">enable</span> httpd</span><br><span class="line">systemctl restart memcached</span><br></pre></td></tr></table></figure></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://xczf.shop">betty bear</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xczf.shop/2023/07/15/OpenStack/">http://xczf.shop/2023/07/15/OpenStack/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xczf.shop" target="_blank">betty bear</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/image/25.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/01/memcache/"><img class="prev-cover" src="/image/27.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">memcache</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/01/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/"><img class="next-cover" src="/image/26.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">分布式存储</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/04/01/Docker/" title="Docker"><img class="cover" src="/image/13.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-01</div><div class="title">Docker</div></div></a></div><div><a href="/2023/10/01/DevOps/" title="devops"><img class="cover" src="/image/16.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-01</div><div class="title">devops</div></div></a></div><div><a href="/2021/02/05/LNMP/" title="LNMP"><img class="cover" src="/image/11.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-05</div><div class="title">LNMP</div></div></a></div><div><a href="/2020/04/15/PXE/" title="PXE无人值守安装系统"><img class="cover" src="/image/28.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-15</div><div class="title">PXE无人值守安装系统</div></div></a></div><div><a href="/2021/06/01/Shell/" title="Shell"><img class="cover" src="/image/23.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-01</div><div class="title">Shell</div></div></a></div><div><a href="/2022/10/01/V2ray/" title="nginx搭建v2ray服务"><img class="cover" src="/image/21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-01</div><div class="title">nginx搭建v2ray服务</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">betty bear</div><div class="author-info__description">最在意的，或许得不到了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ccmmdd"><i class="fab fa-github"></i><span>不要点我呀！</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ccmmdd" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3025346417@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">你也不想这件事被发现吧！~~~///(^v^)\\\~~~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenStack"><span class="toc-number">1.</span> <span class="toc-text">OpenStack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-OpenStack%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一.OpenStack简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E6%88%90%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text">构成组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntp-%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.2.</span> <span class="toc-text">ntp 网络时间协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.3.</span> <span class="toc-text">部署服务安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">安装环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">基本配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">SQL数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-Rabbitmq%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">1.2.</span> <span class="toc-text">二.Rabbitmq消息队列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%88-MQ-%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">消息队列（ MQ ）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%A6%E5%90%88%E3%80%81%E8%A7%A3%E8%80%A6"><span class="toc-number">1.2.2.</span> <span class="toc-text">耦合、解耦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rabbitmq-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.3.</span> <span class="toc-text">Rabbitmq 概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.4.</span> <span class="toc-text">RabbitMQ 工作过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">1.2.5.</span> <span class="toc-text">部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-keystone%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">三.keystone身份认证服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">认证原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2keystone-%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">1.3.3.</span> <span class="toc-text">部署keystone (控制节点)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BA%93%E6%8E%88%E6%9D%83"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">创库授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85KeyStone"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">安装KeyStone</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEApache-HTTP%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">配置Apache HTTP服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9F%9F%EF%BC%8C%E9%A1%B9%E7%9B%AE%EF%BC%8C%E7%94%A8%E6%88%B7%E5%92%8C%E8%A7%92%E8%89%B2"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">创建域，项目，用户和角色</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-Glance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.</span> <span class="toc-text">四.Glance镜像服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text">部署 (控制节点)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-Nova%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.5.</span> <span class="toc-text">五.Nova计算资源服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nova%E7%BB%84%E4%BB%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">Nova组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nova-api"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">nova-api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nova-conductor"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">nova-conductor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nova-scheduler"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">nova-scheduler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nova-compute"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">nova-compute</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#database"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">database</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Message-Queue"><span class="toc-number">1.5.1.6.</span> <span class="toc-text">Message Queue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.5.1.7.</span> <span class="toc-text">组件协同工作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Placement%E6%9C%8D%E5%8A%A1%EF%BC%88%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">部署Placement服务（控制节点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nova%E5%AE%89%E8%A3%85-%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E5%92%8C%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="toc-number">1.5.3.</span> <span class="toc-text">Nova安装 控制节点和计算节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">控制节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">计算节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90%E5%90%8E%E5%86%8D%E5%9B%9E%E5%88%B0%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">计算节点安装配置完成后再回到控制节点操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-Neutron-%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.6.</span> <span class="toc-text">六.Neutron 虚拟网络服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-1"><span class="toc-number">1.6.1.</span> <span class="toc-text">控制节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-Horizon"><span class="toc-number">1.7.</span> <span class="toc-text">七.Horizon</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/10/01/DevOps/" title="devops"><img src="/image/16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="devops"/></a><div class="content"><a class="title" href="/2023/10/01/DevOps/" title="devops">devops</a><time datetime="2023-10-01T11:00:41.000Z" title="发表于 2023-10-01 19:00:41">2023-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/01/memcache/" title="memcache"><img src="/image/27.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="memcache"/></a><div class="content"><a class="title" href="/2023/09/01/memcache/" title="memcache">memcache</a><time datetime="2023-09-01T11:00:41.000Z" title="发表于 2023-09-01 19:00:41">2023-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/15/OpenStack/" title="Openstack"><img src="/image/25.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Openstack"/></a><div class="content"><a class="title" href="/2023/07/15/OpenStack/" title="Openstack">Openstack</a><time datetime="2023-07-15T11:00:41.000Z" title="发表于 2023-07-15 19:00:41">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/01/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" title="分布式存储"><img src="/image/26.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式存储"/></a><div class="content"><a class="title" href="/2022/11/01/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" title="分布式存储">分布式存储</a><time datetime="2022-11-01T11:00:41.000Z" title="发表于 2022-11-01 19:00:41">2022-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/01/V2ray/" title="nginx搭建v2ray服务"><img src="/image/21.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="nginx搭建v2ray服务"/></a><div class="content"><a class="title" href="/2022/10/01/V2ray/" title="nginx搭建v2ray服务">nginx搭建v2ray服务</a><time datetime="2022-10-01T11:00:41.000Z" title="发表于 2022-10-01 19:00:41">2022-10-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/25.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By betty bear</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">啊，对对对!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://xczf.shop/2023/07/15/OpenStack/'
    this.page.identifier = '2023/07/15/OpenStack/'
    this.page.title = 'Openstack'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer src="/live2d-widget/autoload.js"></script><div class="aplayer no-destroy" data-id="8828254214" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>