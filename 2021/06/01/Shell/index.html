<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Shell | betty bear</title><meta name="keywords" content="linux"><meta name="author" content="betty bear,3025346417@qq.com"><meta name="copyright" content="betty bear"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="正则表达式测试网站：https:&#x2F;&#x2F;tool.chinaz.com&#x2F;regex  字符匹配12345678910111213141516.：匹配任意单个字符[]：匹配指定范围内任意单个字符 [a-z] [0-9][^]：匹配指定范围外任意单个字符 [^a-z] [^0-9][:alnum:]：字母与数字字符[:alpha:]：字母[:ascii:]：ASCII字符[:blank:]：空格或制表符[">
<meta property="og:type" content="article">
<meta property="og:title" content="Shell">
<meta property="og:url" content="http://xczf.shop/2021/06/01/Shell/index.html">
<meta property="og:site_name" content="betty bear">
<meta property="og:description" content="正则表达式测试网站：https:&#x2F;&#x2F;tool.chinaz.com&#x2F;regex  字符匹配12345678910111213141516.：匹配任意单个字符[]：匹配指定范围内任意单个字符 [a-z] [0-9][^]：匹配指定范围外任意单个字符 [^a-z] [^0-9][:alnum:]：字母与数字字符[:alpha:]：字母[:ascii:]：ASCII字符[:blank:]：空格或制表符[">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xczf.shop/image/23.jpg">
<meta property="article:published_time" content="2021-06-01T11:00:41.000Z">
<meta property="article:modified_time" content="2023-12-25T03:54:33.112Z">
<meta property="article:author" content="betty bear">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xczf.shop/image/23.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xczf.shop/2021/06/01/Shell/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":500,"languages":{"author":"作者: betty bear","link":"链接: ","source":"来源: betty bear","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Shell',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-25 11:54:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="betty bear" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/23.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">betty bear</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Shell</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-01T11:00:41.000Z" title="发表于 2021-06-01 19:00:41">2021-06-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-25T03:54:33.112Z" title="更新于 2023-12-25 11:54:33">2023-12-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/cate%EF%BC%9Agories/linux/">linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Shell"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>测试网站：<a target="_blank" rel="noopener" href="https://tool.chinaz.com/regex">https://tool.chinaz.com/regex</a></p>
<ul>
<li>字符匹配<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.：匹配任意单个字符</span><br><span class="line">[]：匹配指定范围内任意单个字符 [a-z] [0-9]</span><br><span class="line">[^]：匹配指定范围外任意单个字符 [^a-z] [^0-9]</span><br><span class="line">[:alnum:]：字母与数字字符</span><br><span class="line">[:alpha:]：字母</span><br><span class="line">[:ascii:]：ASCII字符</span><br><span class="line">[:blank:]：空格或制表符</span><br><span class="line">[:cntrl:]：ASCII控制字符</span><br><span class="line">[:digit:]：数字</span><br><span class="line">[:graph:]：非控制、非空格字符</span><br><span class="line">[:lower:]：小写字母</span><br><span class="line">[:print:]：可打印字符</span><br><span class="line">[:punct:]：标点符号字符</span><br><span class="line">[:space:]：空白字符，包括垂直制表符</span><br><span class="line">[:upper:]：大写字母</span><br><span class="line">[:xdigit:]：十六进制数字</span><br></pre></td></tr></table></figure></li>
<li>匹配次数<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*：匹配前面的字符任意次数</span><br><span class="line">.*：匹配任意长度的字符</span><br><span class="line">\?：匹配其前面字符0或1次，即前面的可有可无 &#x27;a\?b&#x27;</span><br><span class="line">\+：匹配其前面的字符至少1次 &#x27;a\+b&#x27;</span><br><span class="line">\&#123;m\&#125;：匹配前面的字符m次</span><br><span class="line">\&#123;m,n\&#125;：匹配前面的字符至少m次，至多n次</span><br><span class="line">\&#123;0,n\&#125;：匹配前面的字符至多n次</span><br><span class="line">\&#123;m,\&#125;：匹配前面的字符至少m次</span><br></pre></td></tr></table></figure></li>
<li>位置锚定<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">^：行首锚定，用于模式的最左侧</span><br><span class="line">$：行末锚定，用于模式的最右侧</span><br><span class="line">^PATTERN$：用于模式匹配整行；</span><br><span class="line">^$：空行</span><br><span class="line">\&lt; 或 \b：词首锚定，用于单词模式的左侧</span><br><span class="line">\&gt; 或 \b：词尾锚定，用于单词模式的右侧</span><br><span class="line">\&lt;PATTERN\&gt;：匹配整个单词 &#x27;\&lt;hello\&gt;&#x27;</span><br></pre></td></tr></table></figure></li>
<li>分组<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\(\):将一个或多个字符捆绑在一起；当作一个字符</span><br><span class="line">\(xy\)*ab</span><br><span class="line">Note：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变量中，这些变量的命令</span><br></pre></td></tr></table></figure>
<h2 id="过滤文本–grep"><a href="#过滤文本–grep" class="headerlink" title="过滤文本–grep"></a>过滤文本–grep</h2><h3 id="命令选项"><a href="#命令选项" class="headerlink" title="命令选项"></a>命令选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-E :--extended--regexp <span class="comment"># 模式是扩展正则表达式（ERE）</span></span><br><span class="line">-i :--ignore--case <span class="comment"># 忽略大小写</span></span><br><span class="line">-n: --line--number <span class="comment"># 打印行号</span></span><br><span class="line">-o:--only--matching <span class="comment"># 只打印匹配的内容</span></span><br><span class="line">-c:--count <span class="comment"># 只打印每个文件匹配的行数</span></span><br><span class="line">-B:--before--context=NUM <span class="comment"># 打印匹配的前几行</span></span><br><span class="line">-A:--after--context=NUM <span class="comment"># 打印匹配的后几行</span></span><br><span class="line">-C:--context=NUM <span class="comment"># 打印匹配的前后几行</span></span><br><span class="line">--color[=WHEN] <span class="comment"># 匹配的字体颜色，别名已定义了</span></span><br><span class="line">-v:--invert--match <span class="comment"># 打印不匹配的行</span></span><br><span class="line">-e <span class="comment"># 多点操作eg：grep -e &quot;^s&quot; -e &quot;s$&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3></li>
<li>打印出所有的a无论大小写<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i <span class="string">&quot;a&quot;</span> test.txt</span><br></pre></td></tr></table></figure></li>
<li>打印出所有的a无论大小写，并且显示该字符串所在的行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -<span class="keyword">in</span> <span class="string">&quot;a&quot;</span> test.txt</span><br></pre></td></tr></table></figure></li>
<li>仅仅打印出所有匹配的字符串<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -io <span class="string">&quot;a&quot;</span> test.txt</span><br></pre></td></tr></table></figure></li>
<li>打印出匹配的字符串有多少行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -ic <span class="string">&quot;a&quot;</span> <span class="built_in">test</span></span><br></pre></td></tr></table></figure></li>
<li>打印出不包含大小s的所有行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -iv <span class="string">&quot;S&quot;</span> test.txt</span><br></pre></td></tr></table></figure></li>
<li><strong>查看配置文件时去除所有的注释和空行</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -Ev <span class="string">&quot;^#|^$&quot;</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件中包含root关键字</span></span><br><span class="line">grep <span class="string">&quot;root&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 文件中不包含root关键字</span></span><br><span class="line">grep -v <span class="string">&quot;root&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 文件中不论大小root关键字</span></span><br><span class="line">grep -i <span class="string">&quot;root&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤nologin或root单词</span></span><br><span class="line">egrep <span class="string">&quot;nologin|root&quot;</span> /etc/passwd</span><br><span class="line">grep -E <span class="string">&quot;nologin|root&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤oo的字节前面有g的</span></span><br><span class="line">grep -E <span class="string">&quot;[^g]oo&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤oo的字节前面是小写的</span></span><br><span class="line">grep -E <span class="string">&quot;[^a-z]oo&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤有数字的行</span></span><br><span class="line">grep -E <span class="string">&quot;[^0-9]&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤以root开头的</span></span><br><span class="line">grep -E <span class="string">&quot;^root&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤g后面有2-5个o，跟一个g的字串</span></span><br><span class="line">grep -E <span class="string">&quot;go&#123;2,5&#125;&quot;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 过滤g后面接俩个以上o的</span></span><br><span class="line">grep -E <span class="string">&quot;go&#123;2,&#125;&quot;</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<h2 id="处理文本–sed"><a href="#处理文本–sed" class="headerlink" title="处理文本–sed"></a>处理文本–sed</h2></li>
<li>常用选项<br>‐n ：只打印模式匹配的行<br>‐e ：直接在命令行模式上进行sed动作编辑，此为<strong>默认选项</strong><br>‐f ：将sed的动作写在一个文件内，用–f filename 执行filename内的sed动作<br>‐r ：支持扩展表达式<br>‐i ：直接修改文件内容</li>
<li>动作<br>a ：新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)<br>c ：取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！<br>d ：删除，因为是删除啊，所以 d 后面通常不接任何东西；<br>i ：插入， i的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；<br>p ：打印，亦即将某个选择的数据印出。通常 p 会与参数 sed -n 一起运行<br>s ：取代，可以直接进行取代的工作，通常这个 s 的动作可以搭配正规表示法</li>
<li>动作选项<br>常用选项：<br>p：打印匹配的行(‐n)<br>&#x3D;：显示文件行号<br>a\：指定行号后添加新文本<br>i\：指定行号前添加新文本<br>d：删除定位行<br>c\：用新文本替换定位文本<br>w filename：写文本到一个文件<br>r filename：从另一个文件读文本<br>s&#x2F;&#x2F;&#x2F;：替换</li>
<li>替换标记：<br>g：行内全局替换<br>p：显示替换成功的行<br>w：将替换成功的结果保存至指定文件<br>q：第一个模式匹配后立即退出<br>{}：在定位行执行的命令组，用逗号分隔<br>g：将模式2粘贴到&#x2F;pattern n&#x2F;<h3 id="以行为单位的新增-x2F-删除"><a href="#以行为单位的新增-x2F-删除" class="headerlink" title="以行为单位的新增&#x2F;删除"></a>以行为单位的新增&#x2F;删除</h3></li>
<li>将 &#x2F;etc&#x2F;passwd 的内容列出并且列印行号，同时，请将第 2~5 行删除<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2,5d&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>只删除第 2 行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2d&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>删除第 3 到最后一行 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;3,$d&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>在第二行后加上『shell』字样<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2a\shell&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>加在第二行前面<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2i\shell&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>增加多行文字<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2a\hello world\</span></span><br><span class="line"><span class="string">shell&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="以行为单位的替换与显示"><a href="#以行为单位的替换与显示" class="headerlink" title="以行为单位的替换与显示"></a>以行为单位的替换与显示</h3></li>
<li>将第2-5行的内容取代成为No 2-5 number<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;2,5c\No 2-5 number</span></span><br></pre></td></tr></table></figure></li>
<li>列出 &#x2F;etc&#x2F;passwd 文件内的第 5-7 行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed -n <span class="string">&#x27;5,7p&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据的搜寻并显示"><a href="#数据的搜寻并显示" class="headerlink" title="数据的搜寻并显示"></a>数据的搜寻并显示</h3></li>
<li>搜索 &#x2F;etc&#x2F;passwd有root关键字的行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed -n <span class="string">&#x27;/root/p&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据的搜寻并删除"><a href="#数据的搜寻并删除" class="headerlink" title="数据的搜寻并删除"></a>数据的搜寻并删除</h3></li>
<li>删除&#x2F;etc&#x2F;passwd所有包含root的行，其他行输出<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;/root/d&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据的搜寻并执行命令"><a href="#数据的搜寻并执行命令" class="headerlink" title="数据的搜寻并执行命令"></a>数据的搜寻并执行命令</h3></li>
<li>搜索&#x2F;etc&#x2F;passwd,找到root对应的行，执行后面花括号中的一组命令，每个命令之间用分号分隔，bash替换为blueshell<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed -n <span class="string">&#x27;/root/&#123;s/bash/blueshell/p;q&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据的搜寻并替换"><a href="#数据的搜寻并替换" class="headerlink" title="数据的搜寻并替换"></a>数据的搜寻并替换</h3></li>
<li>删除IP地址前面和后面的东西<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | sed -n <span class="string">&#x27;/netmask/p&#x27;</span> | sed <span class="string">&#x27;s/^.*inet //g&#x27;</span> | sed <span class="string">&#x27;s/ netmask.*$//g&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="多点编辑"><a href="#多点编辑" class="headerlink" title="多点编辑"></a>多点编辑</h3></li>
<li>删除&#x2F;etc&#x2F;passwd第三行到末尾的数据，并把bash替换为blueshell<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> /etc/passwd | sed -e <span class="string">&#x27;3,$d&#x27;</span> -e <span class="string">&#x27;s/bash/blueshell/&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示test.txt文件的3-9行</span></span><br><span class="line">sed -n <span class="string">&quot;3,9p&quot;</span> test.txt</span><br><span class="line"><span class="comment"># 在文件第一行添加haha,文件结尾一行替换为yesyes</span></span><br><span class="line">sed -e <span class="string">&#x27;la\haha&#x27;</span> -e <span class="string">&#x27;$c\yes&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 用hahaha替换oo，打印前20行</span></span><br><span class="line">sed <span class="string">&#x27;s/hah/oo/g&#x27;</span> | sed -n <span class="string">&#x27;1,20p&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 删除空行和以#开头的行</span></span><br><span class="line">sed <span class="string">&quot;/^#/d&quot;</span> | sed <span class="string">&quot;/^$/d&quot;</span> test.txt</span><br><span class="line"><span class="comment"># 在第2行下面插入hahaha第5行上面插入lalala</span></span><br><span class="line">sed -e <span class="string">&#x27;2a\hahaha&#x27;</span> -e <span class="string">&#x27;5i\lalala&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 删除1到5行的最后一个字符</span></span><br><span class="line">sed <span class="string">&#x27;1,5s/.$//&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 为文件中每个大写字母添加括号</span></span><br><span class="line">sed -r <span class="string">&#x27;s/&#123;([A-Z])/(\1)/g&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 文件中出现所有sbin都被替换成hahah</span></span><br><span class="line">sed <span class="string">&#x27;s/sbin/haha/g&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 解除文件注释，并删除4-6行</span></span><br><span class="line">sed -e <span class="string">&#x27;s/^#//g&#x27;</span> -e <span class="string">&#x27;4,6d&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 删除所有包含mail的行</span></span><br><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;/mail/d&#x27;</span></span><br><span class="line"><span class="comment"># 把20行以后所有行的末尾加上awr</span></span><br><span class="line"><span class="built_in">nl</span> /etc/passwd | sed <span class="string">&#x27;10,$s/.$/&amp;awr&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="数据查找–awk"><a href="#数据查找–awk" class="headerlink" title="数据查找–awk"></a>数据查找–awk</h2></li>
<li>方法<br> pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。花括号（{}）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组。 pattern就是要表示的正则表达式，用斜杠括起来。<br>awk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，awk抽取信息后，才能进行其他文本操作。完整的awk脚本通常用来格式化文本文件中的信息。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;pattern + action&#125;&#x27;</span> &#123;filenames&#125;</span><br></pre></td></tr></table></figure></li>
<li>原理</li>
</ul>
<hr>
<p><img src="/image/shell/1.jpg" alt="awk原理"></p>
<hr>
<h4 id="查看test-txt文件（100行）内第20到第30行的内容"><a href="#查看test-txt文件（100行）内第20到第30行的内容" class="headerlink" title="查看test.txt文件（100行）内第20到第30行的内容"></a>查看test.txt文件（100行）内第20到第30行的内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">seq</span> 100 &gt; test.txt</span><br><span class="line">awk <span class="string">&#x27;&#123;if(NR&gt;=20 &amp;&amp; NR&lt;=30) PRINT $1&#125;&#x27;</span> test.txt</span><br></pre></td></tr></table></figure>
<h4 id="过滤想得到内容"><a href="#过滤想得到内容" class="headerlink" title="过滤想得到内容"></a>过滤想得到内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I am aaron, my qq is 1234567&quot;</span> &gt; test.txt</span><br><span class="line">awk -F <span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;&#123;print $1&quot; &quot;$2&#125;&#x27;</span> test.txt | awk <span class="string">&#x27;&#123;print $3&quot; &quot;$7&#125;&#x27;</span></span><br><span class="line">awk -F <span class="string">&#x27;[ ,]+&#x27;</span> <span class="string">&#x27;&#123;print $3&quot; &quot;$8&#125;&#x27;</span> test.txt </span><br></pre></td></tr></table></figure>
<h3 id="BEGIN-和-END-模块"><a href="#BEGIN-和-END-模块" class="headerlink" title="BEGIN 和 END 模块"></a>BEGIN 和 END 模块</h3><h4 id="统计-x2F-etc-x2F-passwd的账户人数"><a href="#统计-x2F-etc-x2F-passwd的账户人数" class="headerlink" title="统计&#x2F;etc&#x2F;passwd的账户人数"></a>统计&#x2F;etc&#x2F;passwd的账户人数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN &#123;count=0;print &quot;[start] user count is &quot;,count&#125;&#123;count++;print $0&#125; END&#123;print &quot;[end] user count is &quot;,count&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<h4 id="统计某个文件夹下的文件占用的字节数"><a href="#统计某个文件夹下的文件占用的字节数" class="headerlink" title="统计某个文件夹下的文件占用的字节数"></a>统计某个文件夹下的文件占用的字节数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll | awk <span class="string">&#x27;BEGIN &#123;size=0&#125; &#123;size=size+$5&#125; END&#123;print &quot;size is &quot;,size&#125;&#x27;</span></span><br><span class="line">ll | awk <span class="string">&#x27;BEGIN &#123;size=0&#125; &#123;size=size+$5&#125; END&#123;print &quot;size is &quot;,size/1024/1024,&quot;M&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="awk运算符"><a href="#awk运算符" class="headerlink" title="awk运算符"></a>awk运算符</h3><hr>
<p><img src="/image/shell/2.jpg" alt="awk运算符"></p>
<hr>
<h3 id="awk-内置变量"><a href="#awk-内置变量" class="headerlink" title="awk 内置变量"></a>awk 内置变量</h3><hr>
<p><img src="/image/shell/3.jpg" alt="awk内置变量"></p>
<hr>
<h3 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出/etc/passwd文件中以nologin结尾的行</span></span><br><span class="line">awk <span class="string">&#x27;/nologin$/&#123;print $0&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 判断服务器上所有用户类型(超级管理员，系统用户，普通用户)</span></span><br><span class="line">awk -F:<span class="string">&#x27;&#123;if($3==0)print&quot;超级管理员&quot;$1&#125;&#123;if($3&lt;1000 &amp;&amp; $3&gt;0)print&quot;系统用户&quot;$1&#125;&#123;if($3&gt;=1000)print&quot;普通用户&quot;$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 显示出包含Lee和包含kevin的行</span></span><br><span class="line">awk <span class="string">&#x27;/Lee|Kevin/&#123;print $0&#125;&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># 统计/etc/fstab文件中每个文件系统类型出现的次数</span></span><br><span class="line">awk <span class="string">&#x27;!/^#|^$/&#123;fs[$3]++&#125; END &#123;for(i in fs)&#123;print &quot;文件系统:&quot;i*&quot;出现次数:&quot;fs[i]&#125;&#125;&#x27;</span> /etc/fstab</span><br></pre></td></tr></table></figure>
<h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><p><strong>shell是一种解释型语言（逐行解释）</strong><br>Shell 是一个用 C 语言编写的程序。Shell 既是一种命令语言，又是一<br>种程序设计语言。<br>Shell 是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问操作系统内核的服务。</p>
<ul>
<li>Shell 种类<br>Bourne Shell（&#x2F;usr&#x2F;bin&#x2F;sh或&#x2F;bin&#x2F;sh）<br>Bourne Again Shell（&#x2F;bin&#x2F;bash）<br>C Shell（&#x2F;usr&#x2F;bin&#x2F;csh）<br>K Shell（&#x2F;usr&#x2F;bin&#x2F;ksh）<br>Shell for Root（&#x2F;sbin&#x2F;sh）<h3 id="调试脚本"><a href="#调试脚本" class="headerlink" title="调试脚本"></a>调试脚本</h3>-x : 在执行时显示参数和命令；<br>+x：禁止调试<br>-v：当命令行进行读取时显示输入；<br>+v：禁止打印输入。</li>
</ul>
<ul>
<li>n：检测脚本中的语法错误<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3></li>
</ul>
<ul>
<li>全局配置<br>&#x2F;etc&#x2F;bashrc<br>&#x2F;etc&#x2F;profile<br>&#x2F;etc&#x2F;profile.d&#x2F; * .sh</li>
<li>个人配置<br>~&#x2F;.bash_profile<br>~&#x2F;.bashrc<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3></li>
<li>变量命名<br>命名只能使用<strong>英文字母，数字和下划线，首字母不能以数字开头</strong><br>中间不能够有<strong>特殊字符，可以使用 _ 下划线</strong><br>不能使用标点符号<br>不能使用bash中的关键字<h4 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义变量</span></span><br><span class="line">name=<span class="string">&quot;httpd&quot;</span></span><br><span class="line"><span class="comment"># 使用变量(最好使用括号)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;name&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>只读变量 readonly<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行脚本后，显示只读变量无法修改</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">myUrl=<span class="string">&quot;http://www.google.com&quot;</span></span><br><span class="line"><span class="built_in">readonly</span> myUrl</span><br><span class="line">myUrl=<span class="string">&quot;http://www.baidu.com&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>删除变量 unset<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">myUrl=<span class="string">&quot;http://www.runoob.com&quot;</span></span><br><span class="line"><span class="built_in">unset</span> myUrl</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$myUrl</span></span><br></pre></td></tr></table></figure>
<h4 id="变量种类"><a href="#变量种类" class="headerlink" title="变量种类"></a>变量种类</h4></li>
<li>本地变量：生效范围仅为当前shell进程；（其他shell，当前的子shell进程均无效）<br>变量赋值：name &#x3D; “value”</li>
<li>环境变量：生效范围为当前shell进程及子进程<br>变量声明：export name &#x3D; “value”<br>变量声明：declare -x name &#x3D; “value”<br>bash中有许多内建的变量环境：SHELL,PATH等等</li>
<li>局部变量：生效范围为当前shell进程中某代码片断（通常指函数）</li>
<li>位置变量： 2…来表示，让脚本在脚本代码中调用通过命令行传递给它的参数；</li>
<li>特殊变量<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">1,<span class="variable">$2</span>,…：对应调用第1，第2等参数</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">0：命令本身</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">*：传递给脚本的所有参数（把所有参数当作整体）</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">@：传递给脚本的所有参数</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="comment">#：传递给脚本的参数的个数</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">案例1：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &quot;命令本身是：$0&quot;</span><br><span class="line">echo &quot;第一个参数是：$1&quot;</span><br><span class="line">echo &quot;第二个参数是：$2&quot;</span><br><span class="line">echo &quot;一共有$#个参数&quot;</span><br><span class="line">echo &quot;所有参数是：$@&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">案例2：判断所给文件的行数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">linecount=&quot;$(wc -l $1|cut -d&#x27; &#x27; -f1)&quot;</span><br><span class="line">echo &quot;This file have $&#123;linecount&#125; lines&quot;</span><br></pre></td></tr></table></figure>
<h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3></li>
</ul>
<hr>
<p><img src="/image/shell/4.jpg" alt="文件描述符"></p>
<hr>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><ul>
<li>语法格式<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法格式：array_name=(value1 ... valuen)</span></span><br><span class="line">my_array=(A B C D)</span><br></pre></td></tr></table></figure></li>
<li>读取数组<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读取数组：<span class="variable">$&#123;array_name[index]&#125;</span></span></span><br><span class="line">my_array[0]=A</span><br><span class="line">my_array[1]=B</span><br><span class="line">my_array[2]=C</span><br><span class="line">my_array[3]=D</span><br><span class="line">echo &quot;数组的元素为: $&#123;my_array[*]&#125;&quot;</span><br><span class="line">echo &quot;数组的元素为: $&#123;my_array[@]&#125;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="算数运算"><a href="#算数运算" class="headerlink" title="算数运算"></a>算数运算</h3></li>
<li>运算符<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ ‐ * / % ** ...</span><br><span class="line">增强赋值：+=，‐=，*=，/=，%=</span><br><span class="line">乘法符号有些场景中需要转义 : *\</span><br><span class="line">bash有内建随机数生成器：$RANDOM</span><br></pre></td></tr></table></figure></li>
<li>算数运算 expr<br>expr本身是一个命令，可以直接进行运算(expr a + b注意要空格才可以进行运算)<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var=$(expr 1 + 2)</span><br></pre></td></tr></table></figure>
<h3 id="条件测试"><a href="#条件测试" class="headerlink" title="条件测试"></a>条件测试</h3><h4 id="数值测试"><a href="#数值测试" class="headerlink" title="数值测试"></a>数值测试</h4>‐gt：是否大于<br>‐ge：是否大于等于<br>‐eq：是否等于<br>‐ne：是否不等于<br>‐lt：是否小于<br>‐le：是否小于等于<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">比较两个数的大小</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">read -p &quot;请输入两个整数&quot; num1 num2</span><br><span class="line">if [ $num1 -gt $num2 ];then</span><br><span class="line">  echo &quot;$num1 &gt; $num2&quot;</span><br><span class="line">elif [ $num1 -lt $num2 ];then</span><br><span class="line">  echo &quot;$num1 &lt; $num2&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;$num1 = $num2&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h4 id="字符串测试"><a href="#字符串测试" class="headerlink" title="字符串测试"></a>字符串测试</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">==：是否等于</span><br><span class="line">&gt;：是否大于</span><br><span class="line">&lt;：是否小于</span><br><span class="line">！=：是否不等于</span><br><span class="line">=~：左侧字符串是否能够被右侧的PATTERN所匹配</span><br><span class="line">Note：此表达式一般用于[[ ]]中</span><br><span class="line">‐z “STRING”:测试字符串是否为空，空则为真，不空则为假</span><br><span class="line">‐n “STRING”:测试字符串是否不空，不空则为真，空则为假</span><br></pre></td></tr></table></figure>
<h4 id="文件测试"><a href="#文件测试" class="headerlink" title="文件测试"></a>文件测试</h4></li>
<li>简单的存在性测试：<br>‐a FILE ：文件存在性测试，存在为真，否则为假</li>
<li>存在性及类型测试：<br>‐b FLIE：是否存在且为块设备文件；<br>‐c FILE：是否存在且为字符设备文件；<br>‐d FILE：是否存在且为目录文件；<br>‐f FILE：是否存在且为普通文件；<br>‐h FILE 或 ‐L FILE : 存在且为符号链接文件；<br>‐p FIEL ：是否存在且为命名管道文件；<br>‐S FILE：是否存在且为套接文件；</li>
<li>文件权限测试：<br>‐r FILE：是否存在且可读<br>‐w FILE：是否存在且可写<br>‐x FILE：是否存在可执行</li>
<li>文件特殊权限测试：<br>‐u FILE：是否存在且拥有suid权限；<br>‐g FILE：是否存在且拥有sgid权限；<br>‐k FILE：是否存在且拥有sticky权限；</li>
<li>文件大小测试：<br>‐s FILE：是否存在且非空</li>
<li>文件是否打开：<br>‐fd：fd表示文件描述符是否已经打开且与某终端相关<br>‐N FILE：文件自动上一次读取之后是否被修改过；<br>‐O FILE：当前用户是否为文件的属主；<br>‐G FILE：当前有效用户是否为文件数组；</li>
<li>双目测试：<br>FILE1 ‐ef FILE2 ：FILE1与FILE2是否指向同一个设备上的相同inode<br>FILE1 ‐nt FILE2：FILE1是否新于FILE2<br>FILE1 ‐ot FILE2：FILE1是否旧于FILE2</li>
<li>组合测试条件<br>&amp;&amp;代表的意思是当前一个命令执行成功时会继续执行后续的命令，当前一个命令执行失败的时候不会执行后续的命令(-a)<br>||代表的意思是当前一个命令执行成功时不会继续执行后续的命令，当前一个命令执行失败的时候会执行后续的命令(-o)<h3 id="用户交互-read"><a href="#用户交互-read" class="headerlink" title="用户交互 read"></a>用户交互 read</h3>‐a：将内容读入到数组中<br>‐d ： 表示delimiter，即定界符<br>‐e ：只用于互相交互的脚本<br>‐n ： 用于限定最多可以有多少字符可以作为有效读入<br>‐p ：用于给出提示符<br>‐r ：特殊字符生效(&#x2F;n等)，也应采用‐r选项。<br>‐s ： 对于一些特殊的符号不打印的情况<br>‐t ：用于表示等待输入的时间(s),等待时间超过，将继续执行后面的脚本<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断用户是否存在，不存在就创建及增加密码 sh user.sh xw</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">echo &quot;arg not less than 1&quot;</span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line">id $1 &amp;&gt; /dev/null</span><br><span class="line">if [ $? -eq 0 ]</span><br><span class="line">then</span><br><span class="line">echo &quot;$1 exists!&quot;</span><br><span class="line">exit 2</span><br><span class="line">else</span><br><span class="line">useradd $1 &amp;&amp; echo &quot;$1&quot; | passed --stdin $1 &amp;&gt; /dev/null</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3></li>
<li>for循环<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for 变量名 in 列表;do</span><br><span class="line">循环体</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>while循环<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while 测试条件;do</span><br><span class="line">循环体</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>until循环<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">until 条件测试;do</span><br><span class="line">循环体</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function FUNNAME()&#123;</span><br><span class="line">函数体</span><br><span class="line">返回值</span><br><span class="line">&#125;</span><br><span class="line">FUNNME #调用函数</span><br></pre></td></tr></table></figure>
<h3 id="shell案例"><a href="#shell案例" class="headerlink" title="shell案例"></a>shell案例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win下可能存在行尾有^M的问题 # dos2unix x.sh</span></span><br><span class="line">yum install dos2unix -y</span><br></pre></td></tr></table></figure>
<h4 id="0-用户登陆成功时输出系统的相关信息"><a href="#0-用户登陆成功时输出系统的相关信息" class="headerlink" title="0.用户登陆成功时输出系统的相关信息"></a>0.用户登陆成功时输出系统的相关信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">yum install -y net-tools &amp;&gt; /dev/null</span><br><span class="line">System=$(hostnamectl | grep System | awk &#x27;&#123;print $3,$4,$5&#125;&#x27;)</span><br><span class="line">echo &quot;当前系统版本是：$&#123;System&#125;&quot;</span><br><span class="line"></span><br><span class="line">Kernel=$(hostnamectl | grep Kernel | awk -F: &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">echo &quot;当前系统内核是：$&#123;Kernel&#125;&quot;</span><br><span class="line"></span><br><span class="line">Virtualization=$(hostnamectl | grep Virtualization| awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">echo &quot;当前虚拟平台是：$&#123;Virtualization&#125;&quot;</span><br><span class="line"></span><br><span class="line">Statichostname=$(hostnamectl | grep Static|awk -F: &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">echo &quot;当前主机名是：$&#123;Statichostname&#125;&quot;</span><br><span class="line"></span><br><span class="line">wangka=(ip a | grep ens | head -1 | cut -d: -f2)</span><br><span class="line">Ens=$(ifconfig $&#123;wangka&#125; | awk &#x27;NR==2 &#123;print $2&#125;&#x27;)</span><br><span class="line">echo &quot;当前网卡$&#123;wangka&#125;的地址是：$&#123;Ens&#125;&quot;</span><br><span class="line"></span><br><span class="line">Lo=$(ifconfig lo0 | awk &#x27;NR==2 &#123;print $2&#125;&#x27;)</span><br><span class="line">echo &quot;当前lo0接口的地址是：$&#123;Lo&#125;&quot;</span><br><span class="line"></span><br><span class="line">NetworkIp=$(curl -s icanhazip.com)</span><br><span class="line">echo &quot;当前公网地址是：$&#123;NetworkIp&#125;&quot;</span><br></pre></td></tr></table></figure>
<h4 id="1-服务器系统的配置初始化"><a href="#1-服务器系统的配置初始化" class="headerlink" title="1.服务器系统的配置初始化"></a>1.服务器系统的配置初始化</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置时区并同步时间</span></span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">if ! crontab -l |grep ntpdate &amp;&gt;/dev/null ; then</span><br><span class="line">    (echo &quot;* 1 * * * ntpdate time.windows.com &gt;/dev/null 2&gt;&amp;1&quot;;crontab -l) |crontab</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用selinux</span></span><br><span class="line">sed -i &#x27;/SELINUX/&#123;s/permissive/disabled/&#125;&#x27; /etc/selinux/config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭防火墙</span></span><br><span class="line">if egrep &quot;7.[0-9]&quot; /etc/redhat-release &amp;&gt;/dev/null; then</span><br><span class="line">    systemctl stop firewalld</span><br><span class="line">    systemctl disable firewalld</span><br><span class="line">elif egrep &quot;6.[0-9]&quot; /etc/redhat-release &amp;&gt;/dev/null; then</span><br><span class="line">    service iptables stop</span><br><span class="line">    chkconfig iptables off</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">历史命令显示操作时间</span></span><br><span class="line">if ! grep HISTTIMEFORMAT /etc/bashrc; then</span><br><span class="line">	echo &#x27;export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;&#x27; &gt;&gt;/etc/bashrc</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SSH超时断开</span></span><br><span class="line">if ! grep &quot;TMOUT=600&quot; /etc/profile &amp;&gt;/dev/null; then</span><br><span class="line">    echo &quot;export TMOUT=600&quot; &gt;&gt; /etc/profile</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止root远程登录</span></span><br><span class="line">sed -i &#x27;s/#PermitRootLogin yes/PermitRootLogin no/&#x27; /etc/ssh/sshd_config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止定时任务发送邮件</span></span><br><span class="line">sed -i &#x27;s/^MAILTO=root/MAILTO=&quot;&quot;/&#x27; /etc/crontab</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置最大打开文件数</span></span><br><span class="line">if ! grep &quot;&#x27; soft nofile 65535&quot; /etc/security/limits.conf &amp;&gt;/dev/null; then</span><br><span class="line">    cat &gt;&gt; /etc/security/limits.conf &lt;&lt; EOF</span><br><span class="line">    * soft nofile 65535</span><br><span class="line">    * hard nofile 65535</span><br><span class="line">EOF</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内核优化</span></span><br><span class="line">cat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 20480</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 20480</span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line">net.ipv4.tcp_fin_timeout = 20</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SWAP使用减少</span></span><br><span class="line">echo &quot;0&quot; &gt; /proc/sys/vm/swappiness</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装阿里yum源</span></span><br><span class="line">yum -y install wget</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">yum repolist &amp;&amp; yum makecache fast</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装系统性能分析工具</span></span><br><span class="line">yum install -y gcc make autoconf vim sysstat net-tools iostat iftop iotp lrzsz</span><br></pre></td></tr></table></figure>
<h4 id="2-发送告警邮件"><a href="#2-发送告警邮件" class="headerlink" title="2.发送告警邮件"></a>2.发送告警邮件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line">yum install mailx -y</span><br><span class="line">cat &gt;&gt; /etc/mail.rc &lt;&lt; EOF</span><br><span class="line">set from=邮箱 smtp=smtp.qq.com</span><br><span class="line">set smtp-auth-user=邮箱 smtp-auth-password=授权码</span><br><span class="line">set smtp-auth=login</span><br><span class="line">EOF</span><br><span class="line">echo &quot;this is test mail.&quot; |mail -s &quot;monitor&quot; 发送邮箱</span><br></pre></td></tr></table></figure>
<h4 id="3-批量创建100用户并设置密码"><a href="#3-批量创建100用户并设置密码" class="headerlink" title="3.批量创建100用户并设置密码"></a>3.批量创建100用户并设置密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">！/bin/bash</span></span><br><span class="line">for USER in user&#123;1..100&#125;; do</span><br><span class="line">  if ! id $&#123;USER&#125; &amp;&gt; /dev/null; then</span><br><span class="line">    PASS=$(echo $RANDOM | md5sum | cut -c 1-8)</span><br><span class="line">    useradd $&#123;USER&#125;</span><br><span class="line">    echo $&#123;PASS&#125; | passwd --stdin $&#123;USER&#125;</span><br><span class="line">    echo &quot;$&#123;USER&#125; $&#123;PASS&#125;&quot; &gt;&gt; ./user.info</span><br><span class="line">    echo &quot;$&#123;USER&#125; User create successful&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$&#123;USER&#125; User already exists&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="4-查看服务器利用率"><a href="#4-查看服务器利用率" class="headerlink" title="4.查看服务器利用率"></a>4.查看服务器利用率</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CPU使用率</span></span><br><span class="line">function cpu() &#123;</span><br><span class="line">    util=$(vmstat | awk &#x27;&#123;if(NR==3)print $13+$14&#125;&#x27;)</span><br><span class="line">    iowait=$(vmstat |awk &#x27;&#123;if(NR==3)print $16&#125;&#x27;)</span><br><span class="line">    echo  &quot;CPU - 使用率: $&#123;util&#125;% , 等待磁盘IO响应使用率: $&#123;iowait&#125;%&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内存使用率</span></span><br><span class="line">function memory() &#123;</span><br><span class="line">    total=$(free -m | awk &#x27;&#123;if(NR==2)printf &quot;%1.f&quot;,$2/1024&#125;&#x27;)</span><br><span class="line">    used=$(free -m | awk &#x27;&#123;if(NR==2)printf &quot;%1.f&quot;,($2-$NF)/1024&#125;&#x27;)</span><br><span class="line">    available=$(free -m | awk &#x27;&#123;if(NR==2)printf &quot;%1.f&quot;,$NF/1024&#125;&#x27;)</span><br><span class="line">    echo &quot;内存 - 总大小: $&#123;total&#125;G , 已使用: $&#123;used&#125;G , 剩余: $&#123;available&#125;G&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件系统</span></span><br><span class="line">function disk() &#123;</span><br><span class="line">    fs=$(df -h | awk &#x27;/^\/dev/&#123;print $1&#125;&#x27;)</span><br><span class="line">    for p in $&#123;fs&#125;;do</span><br><span class="line">      mounted=$(df -h | awk -v p=$p &#x27;$1==p&#123;print $NF&#125;&#x27;)</span><br><span class="line">      size=$(df -h | awk -v p=$p &#x27;$1==p&#123;print $2&#125;&#x27;)</span><br><span class="line">      used=$(df -h | awk -v p=$p &#x27;$1==p&#123;print $3&#125;&#x27;)</span><br><span class="line">      used_percent=$(df -h | awk -v p=$p &#x27;$1==p&#123;print $5&#125;&#x27;)</span><br><span class="line">      echo &quot;硬盘 - 挂载点: $&#123;mounted&#125; , 总大小: $&#123;size&#125; , 已使用: $&#123;used&#125; , 使用率: $&#123;used_percent&#125;&quot;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TCP状态</span></span><br><span class="line">function tcp_status() &#123;</span><br><span class="line">    yum install net-tools -y</span><br><span class="line">    summary=$(netstat -antp | awk &#x27;&#123;a[$6]++&#125;END&#123;for(i in a)printf i&quot;:&quot;a[i]&quot; &quot;&#125;&#x27;)</span><br><span class="line">    echo &quot;TCP连接状态 - $&#123;summary&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">cpu</span><br><span class="line">memory</span><br><span class="line">disk</span><br><span class="line">tcp_status</span><br></pre></td></tr></table></figure>
<h4 id="5-找出占用CPU-x2F-内存过高的进程"><a href="#5-找出占用CPU-x2F-内存过高的进程" class="headerlink" title="5.找出占用CPU&#x2F;内存过高的进程"></a>5.找出占用CPU&#x2F;内存过高的进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line">echo &quot;-----------------cpu top 10----------------------&quot;</span><br><span class="line">ps -eo pid,pcpu,pmem,args --sort=-pcpu | head -n 10</span><br><span class="line">echo &quot;-----------------memory top 10----------------------&quot;</span><br><span class="line">ps -eo pid,pcpu,pmem,args --sort=-pmem | head -n 10</span><br></pre></td></tr></table></figure>
<h4 id="6-查看网卡实时流量"><a href="#6-查看网卡实时流量" class="headerlink" title="6.查看网卡实时流量"></a>6.查看网卡实时流量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">NIC=<span class="variable">$1</span> ens33</span></span><br><span class="line">NIC=$1</span><br><span class="line">echo -e &quot;In ------ Out&quot;</span><br><span class="line">while true; do</span><br><span class="line">    OLD_IN=$(awk &#x27;$0~&quot;&#x27;$&#123;NIC&#125;&#x27;&quot;&#123;print $2&#125;&#x27; /proc/net/dev)</span><br><span class="line">    OLD_OUT=$(awk &#x27;$0~&quot;&#x27;$&#123;NIC&#125;&#x27;&quot;&#123;print $10&#125;&#x27; /proc/net/dev)</span><br><span class="line">    sleep 1</span><br><span class="line">    NEW_IN=$(awk &#x27;$0~&quot;&#x27;$&#123;NIC&#125;&#x27;&quot;&#123;print $2&#125;&#x27; /proc/net/dev)</span><br><span class="line">    NEW_OUT=$(awk &#x27;$0~&quot;&#x27;$&#123;NIC&#125;&#x27;&quot;&#123;print $10&#125;&#x27; /proc/net/dev)</span><br><span class="line">    IN=$(printf &quot;%.1f%s&quot; &quot;$((($&#123;NEW_IN&#125;-$&#123;OLD_IN&#125;)/1024))&quot; &quot;KB/s&quot;)</span><br><span class="line">    OUT=$(printf &quot;%.1f%s&quot; &quot;$((($&#123;NEW_OUT&#125;-$&#123;OLD_OUT&#125;)/1024))&quot; &quot;KB/s&quot;)</span><br><span class="line">    echo &quot;$&#123;IN&#125; $&#123;OUT&#125;&quot;</span><br><span class="line">    sleep 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="7-远程查看服务器磁盘占用率"><a href="#7-远程查看服务器磁盘占用率" class="headerlink" title="7.远程查看服务器磁盘占用率"></a>7.远程查看服务器磁盘占用率</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IP存放的文件</span></span><br><span class="line">HOST_INFO=host.info</span><br><span class="line">for IP in $(awk &#x27;/^[^#]/&#123;print $1&#125;&#x27; $HOST_INFO); do</span><br><span class="line">    USER=$(awk -v ip=$&#123;IP&#125; &#x27;ip==$1&#123;print $2&#125;&#x27; $HOST_INFO)</span><br><span class="line">    PORT=$(awk -v ip=$&#123;IP&#125; &#x27;ip==$1&#123;print $3&#125;&#x27; $HOST_INFO)</span><br><span class="line">    TMP_FILE=/tmp/disk.tmp</span><br><span class="line">    ssh -p $PORT $USER@IP &#x27;df -h&#x27; &gt; $&#123;TMP_FILE&#125;</span><br><span class="line">    USER_RATE_LIST=$(awk &#x27;BEGIN&#123;OFS=&quot;=&quot;&#125;/^\/dev/&#123;print $NF,int($5)&#125;&#x27; $&#123;TMP_FILE&#125;)</span><br><span class="line">    for USER_RATE in USER_RATE_LIST; do</span><br><span class="line">        PART_NAME=$&#123;USER_RATE%=*&#125;</span><br><span class="line">        USE_RATE=$&#123;USER_RATE%=*&#125;</span><br><span class="line">        if [ $&#123;USE_RATE&#125; -ge 80]; then</span><br><span class="line">            echo &quot;Warning: $PART_NAME Partition usage $&#123;USE_PATE&#125;%!&quot;</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="8-网站是否异常"><a href="#8-网站是否异常" class="headerlink" title="8.网站是否异常"></a>8.网站是否异常</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line">URL_LIST=&quot;www.baidu.com www.sougou.com&quot;</span><br><span class="line">for URL in $&#123;URL_LIST&#125;; do</span><br><span class="line">    FAIL_COUNT=0</span><br><span class="line">    for ((i=1;i&lt;=3;i++)); do</span><br><span class="line">        HTTP_CODE=$(curl -o /dev/null --connect-timeout 3 -s -w &quot;%&#123;http_code&#125;&quot; $&#123;URL&#125;)</span><br><span class="line">        if [ $&#123;HTTP_CODE&#125; -eq 200 ]; then</span><br><span class="line">            echo &quot;$&#123;URL&#125; ok&quot;</span><br><span class="line">            break</span><br><span class="line">        else</span><br><span class="line">            echo &quot;$&#123;URL&#125; retry $&#123;FAIL_COUNT&#125;&quot;</span><br><span class="line">            let FAIL_COUNT++</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    if [ $&#123;FAIL_COUNT&#125; -eq 3 ]; then</span><br><span class="line">        echo &quot;Warning: $&#123;URL&#125; Access failure!&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="9-主机远程执行命令脚本"><a href="#9-主机远程执行命令脚本" class="headerlink" title="9.主机远程执行命令脚本"></a>9.主机远程执行命令脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">COMMAND=$*</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件里输入IP 用户 端口 密码</span></span><br><span class="line">HOST_INFO=host.info</span><br><span class="line">for IP in $(awk &#x27;/^[^#]/&#123;print $1&#125;&#x27; $HOST_INFO); do</span><br><span class="line">    USER=$(awk -v ip=$IP &#x27;ip==$1&#123;print $2&#125;&#x27; $HOST_INFO)</span><br><span class="line">    PORT=$(awk -v ip=$IP &#x27;ip==$1&#123;print $3&#125;&#x27; $HOST_INFO)</span><br><span class="line">    PASS=$(awk -v ip=$IP &#x27;ip==$1&#123;print $4&#125;&#x27; $HOST_INFO)</span><br><span class="line">    expect -c &quot;</span><br><span class="line">       spawn ssh -p $PORT $USER@$IP</span><br><span class="line">       expect &#123;</span><br><span class="line">          \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;; exp_continue&#125;</span><br><span class="line">          \&quot;password:\&quot; &#123;send \&quot;$PASS\r\&quot;; exp_continue&#125;</span><br><span class="line">          \&quot;$USER@*\&quot; &#123;send \&quot;$COMMAND\r exit\r\&quot;; exp_continue&#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &quot;</span><br><span class="line">    echo &quot;-------------------&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="10-一键部署LNMP"><a href="#10-一键部署LNMP" class="headerlink" title="10.一键部署LNMP"></a>10.一键部署LNMP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line">NGINX_V=nginx-1.18.0</span><br><span class="line">PHP_V=5.6.36</span><br><span class="line">TMP_DIR=/tmp</span><br><span class="line">INSTALL_DIR=/usr/local</span><br><span class="line"></span><br><span class="line">echo</span><br><span class="line">echo -e &quot;\tMenu\n&quot;</span><br><span class="line">echo -e &quot;1. Install Nginx&quot;</span><br><span class="line">echo -e &quot;2. Install PHP&quot;</span><br><span class="line">echo -e &quot;3. Install MySQL&quot;</span><br><span class="line">echo -e &quot;4. Deploy LNMP&quot;</span><br><span class="line">echo -e &quot;9. Quit&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断上一条命令的执行状态</span></span><br><span class="line">function command_status_check() &#123;</span><br><span class="line">    if [ $? -ne 0 ]; then</span><br><span class="line">        echo $1</span><br><span class="line">        exit</span><br><span class="line">    fi </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装nginx</span></span><br><span class="line">function install_nginx() &#123;</span><br><span class="line">    cd $&#123;TMP_DIR&#125;</span><br><span class="line">    yum install -y gcc gcc-c++ make openssl-devel pcre-devel wget</span><br><span class="line">    wget http://nginx.org/download/nginx-$&#123;NGINX_V&#125;.tar.gz</span><br><span class="line">    tar zxf $&#123;NGINX_V&#125;.tar.gz</span><br><span class="line">    cd $&#123;NGINX_V&#125;</span><br><span class="line">    useradd -r -s /sbin/nologin nginx</span><br><span class="line">    ./configure --prefix=$&#123;INSTALL_DIR&#125;/nginx \</span><br><span class="line">    --user=nginx \</span><br><span class="line">    --group=nginx \</span><br><span class="line">    --with-http_ssl_module \</span><br><span class="line">    --with-http_v2_module \</span><br><span class="line">    --with-http_realip_module \</span><br><span class="line">    --with-http_stub_status_module \</span><br><span class="line">    --with-http_gzip_static_module \</span><br><span class="line">    --with-pcre \</span><br><span class="line">    --with-stream \</span><br><span class="line">    --with-stream_ssl_module \</span><br><span class="line">    --with-stream_realip_module</span><br><span class="line">    command_status_check &quot;Nginx - 平台环境检查失败！&quot;</span><br><span class="line">    make -j 4</span><br><span class="line">    command_status_check &quot;Nginx - 编译失败！&quot;</span><br><span class="line">    make install</span><br><span class="line">    command_status_check &quot;Nginx - 安装失败！&quot;</span><br><span class="line">    chown -R nginx.nginx $&#123;INSTALL_DIR&#125;/nginx</span><br><span class="line">    mkdir -p $&#123;INSTALL_DIR&#125;/nginx/conf/vhost</span><br><span class="line">    alias cp=cp ; cp -rf $&#123;TMP_DIR&#125;/$&#123;NGINX_V&#125;/conf/nginx.conf $&#123;INSTALL_DIR&#125;/nginx/conf</span><br><span class="line">    rm -rf $&#123;INSTALL_DIR&#125;/nginx/html/*</span><br><span class="line">    echo &quot;ok&quot; &gt; $&#123;INSTALL_DIR&#125;/nginx/html/status.html</span><br><span class="line">    echo &#x27;&lt;?php echo &quot;ok&quot;?&gt;&#x27; &gt; $&#123;INSTALL_DIR&#125;/nginx/html/status.php</span><br><span class="line">    ln -s $&#123;INSTALL_DIR&#125;/nginx/sbin/nginx /usr/bin/</span><br><span class="line">    nginx -v</span><br><span class="line">    nginx</span><br><span class="line">    command_status_check &quot;Nginx - 启动失败！&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装PHP</span></span><br><span class="line">function install_php() &#123;</span><br><span class="line">    cd $&#123;TMP_DIR&#125;</span><br><span class="line">    yum install -y gcc gcc-c++ make gd-devel libxml2-devel \</span><br><span class="line">        libcurl-devel libjpeg-devel libpng-devel openssl-devel \</span><br><span class="line">        libmcrypt-devel libxslt-devel libtidy-devel</span><br><span class="line">    wget http://docs.php.net/distributions/php-$&#123;PHP_V&#125;.tar.gz</span><br><span class="line">    tar zxf php-$&#123;PHP_V&#125;.tar.gz</span><br><span class="line">    cd php-$&#123;PHP_V&#125;</span><br><span class="line">    ./configure --prefix=$&#123;INSTALL_DIR&#125;/php \</span><br><span class="line">    --with-config-file-path=$&#123;INSTALL_DIR&#125;/php/etc \</span><br><span class="line">    --enable-fpm --enable-opcache \</span><br><span class="line">    --with-mysql --with-mysqli --with-pdo-mysql \</span><br><span class="line">    --with-openssl --with-zlib --with-curl --with-gd \</span><br><span class="line">    --with-jpeg-dir --with-png-dir --with-freetype-dir \</span><br><span class="line">    --enable-mbstring --enable-hash</span><br><span class="line">    command_status_check &quot;PHP - 平台环境检查失败！&quot;</span><br><span class="line">    make -j 4 </span><br><span class="line">    command_status_check &quot;PHP - 编译失败！&quot;</span><br><span class="line">    make install</span><br><span class="line">    command_status_check &quot;PHP - 安装失败！&quot;</span><br><span class="line">    cp php.ini-production $&#123;INSTALL_DIR&#125;/php/etc/php.ini</span><br><span class="line">    cp sapi/fpm/php-fpm.conf $&#123;INSTALL_DIR&#125;/php/etc/php-fpm.conf</span><br><span class="line">    cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="line">    chmod +x /etc/init.d/php-fpm</span><br><span class="line">    /etc/init.d/php-fpm start</span><br><span class="line">    command_status_check &quot;PHP - 启动失败！&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装MySQL</span></span><br><span class="line">function install_mysql() &#123;</span><br><span class="line">    . /etc/init.d/functions</span><br><span class="line">    mkdir /application</span><br><span class="line">    wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz &amp;&gt; /dev/null&amp;&amp; action &quot;安装成功&quot; || &#123; action &quot;安装所需包失败，请检测包或网络配置&quot; false;exit;&#125;</span><br><span class="line">    tar xzvf mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz &amp;&gt; /dev/null</span><br><span class="line">    mv mysql-5.6.40-linux-glibc2.12-x86_64 /application/mysql-5.6.40</span><br><span class="line">    ln -s /application/mysql-5.6.40 /application/mysql</span><br><span class="line">    cd /application/mysql/support-files</span><br><span class="line">    \cp my-default.cnf /etc/my.cnf &amp;&gt;/dev/null</span><br><span class="line">    cp mysql.server /etc/init.d/mysqld &amp;&gt;/dev/null</span><br><span class="line">    cd /application/mysql/scripts</span><br><span class="line"></span><br><span class="line">    if id mysql &amp;&gt; /dev/null;then</span><br><span class="line">       action &quot;mysql 用户已经存在&quot; false</span><br><span class="line">    else</span><br><span class="line">       useradd mysql -s /sbin/nologin -M</span><br><span class="line">       action &quot;mysql 用户创建成功&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    yum -y install autoconf &amp;&gt; /dev/null</span><br><span class="line">    /application/mysql/scripts/mysql_install_db --user=mysql --basedir=/application/mysql --data=/application/mysql/data &amp;&gt;/dev/null &amp;&amp; action &quot;初始化成功&quot; || &#123; action &quot;初始化失败，请检测初始化配置&quot; false;exit;&#125;</span><br><span class="line">    echo &#x27;export PATH=&quot;/application/mysql/bin:$PATH&quot;&#x27; &gt; /etc/profile.d/mysql.sh</span><br><span class="line">    source /etc/profile &amp;&amp; action &quot;环境变量添加成功&quot; || &#123; action &quot;环境变量添加失败&quot; false;exit;&#125;</span><br><span class="line">    sed -i &#x27;s#/usr/local#/application#g&#x27; /etc/init.d/mysqld /application/mysql/bin/mysqld_safe</span><br><span class="line">    cat &gt; /usr/lib/systemd/system/mysqld.service &lt;&lt;EOF</span><br><span class="line">        [Unit]</span><br><span class="line">        Description=MySQL Server</span><br><span class="line">        Documentation=man:mysqld(8)</span><br><span class="line">        Documentation=https://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">        After=network.target</span><br><span class="line">        After=syslog.target</span><br><span class="line">        [Install]</span><br><span class="line">        WantedBy=multi-user.target</span><br><span class="line">        [Service]</span><br><span class="line">        User=mysql</span><br><span class="line">        Group=mysql</span><br><span class="line">        ExecStart=/application/mysql/bin/mysqld --defaults-file=/etc/my.cnf</span><br><span class="line">        LimitNOFILE = 5000</span><br><span class="line">EOF</span><br><span class="line">    cat &gt;&gt; /etc/my.cnf &lt;&lt;EOF</span><br><span class="line">        basedir = /application/mysql/</span><br><span class="line">        datadir = /application/mysql/data</span><br><span class="line">EOF</span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    /etc/init.d/mysqld start  &amp;&gt; /dev/null &amp;&amp; action &quot;mysql 服务启动成功&quot; || &#123; action &quot;mysql 服务启动失败&quot; false;exit; &#125;</span><br><span class="line">    systemctl enable mysqld &amp;&amp; systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">    /application/mysql/bin/mysqladmin -uroot password &#x27;123456&#x27; &amp;&amp; action &quot;mysql 密码设置成功&quot; || &#123; action &quot;mysql 密码设置失败&quot; false;exit; &#125;</span><br><span class="line">    /application/mysql/bin/mysql -uroot -p123456</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">交互菜单</span></span><br><span class="line">read -p &quot;请输入编号：&quot; number</span><br><span class="line">case $&#123;number&#125; in</span><br><span class="line">    1)</span><br><span class="line">        install_nginx;;</span><br><span class="line">    2)</span><br><span class="line">        install_php;;</span><br><span class="line">    3)</span><br><span class="line">        install_mysql;;</span><br><span class="line">    4)</span><br><span class="line">        install_nginx</span><br><span class="line">        install_php</span><br><span class="line">        ;;</span><br><span class="line">    9)</span><br><span class="line">        exit;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<h4 id="11-MySQL主从是否正常"><a href="#11-MySQL主从是否正常" class="headerlink" title="11.MySQL主从是否正常"></a>11.MySQL主从是否正常</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span>  </span><br><span class="line">HOST=localhost</span><br><span class="line">USER=root</span><br><span class="line">PASSWD=123456</span><br><span class="line">IO_SQL_STATUS=$(mysql -h$HOST -u$USER -p$PASSWD -e &#x27;show slave status\G&#x27; 2&gt;/dev/null |awk &#x27;/Slave_.*_Running:/&#123;print $1$2&#125;&#x27;)</span><br><span class="line">for i in $&#123;IO_SQL_STATUS&#125;; do</span><br><span class="line">    THREAD_STATUS_NAME=$&#123;i%:*&#125;</span><br><span class="line">    THREAD_STATUS=$&#123;i#*:&#125;</span><br><span class="line">    if [ &quot;$&#123;THREAD_STATUS&#125;&quot; != &quot;Yes&quot; ]; then</span><br><span class="line">        echo &quot;Error: MySQL Master-Slave $&#123;THREAD_STATUS_NAME&#125; status is $&#123;THREAD_STATUS&#125;!&quot; |mail -s &quot;Master-Slave Staus&quot; 邮箱</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="12-MySql数据库备份"><a href="#12-MySql数据库备份" class="headerlink" title="12.MySql数据库备份"></a>12.MySql数据库备份</h4></li>
<li>分库备份<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -pxxx -B A &gt; A.sql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">DATE=$(date +%F_%H-%M-%S)</span><br><span class="line">HOST=localhost</span><br><span class="line">USER=backup</span><br><span class="line">PASS=123456</span><br><span class="line">BACKUP_DIR=/data/db_backup</span><br><span class="line">DB_LIST=$(mysql -h$&#123;HOST&#125; -u$&#123;USER&#125; -p$&#123;PASS&#125; -s -e &quot;show databases;&quot; 2&gt;/dev/null |egrep -v &quot;Database|information_schema|mysql|performance_schema|sys&quot;)</span><br><span class="line"> </span><br><span class="line">for DB in $&#123;DB_LIST&#125;; do</span><br><span class="line">    BACKUP_NAME=$&#123;BACKUP_DIR&#125;/$&#123;DB&#125;_$&#123;DATE&#125;.sql</span><br><span class="line">    if ! mysqldump -h$&#123;HOST&#125; -u$&#123;USER&#125; -p$&#123;PASS&#125; -B $&#123;DB&#125; &gt; $&#123;BACKUP_NAME&#125; 2&gt;/dev/null; then</span><br><span class="line">        echo &quot;$BACKUP_NAME 备份失败!&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>分表备份<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -pxxx -A t &gt; t.sql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">DATE=$(date +%F_%H-%M-%S)</span><br><span class="line">HOST=localhost</span><br><span class="line">USER=backup</span><br><span class="line">PASS=123456</span><br><span class="line">BACKUP_DIR=/data/db_backup</span><br><span class="line">DB_LIST=$(mysql -h$&#123;HOST&#125; -u$&#123;USER&#125; -p$&#123;PASS&#125; -s -e &quot;show databases;&quot; 2&gt;/dev/null |egrep -v &quot;Database|information_schema|mysql|performance_schema|sys&quot;)</span><br><span class="line"> </span><br><span class="line">for DB in $&#123;DB_LIST&#125;; do</span><br><span class="line">    BACKUP_DB_DIR=$&#123;BACKUP_DIR&#125;/$&#123;DB&#125;_$&#123;DATE&#125;</span><br><span class="line">    [ ! -d $&#123;BACKUP_DB_DIR&#125; ] &amp;&amp; mkdir -p $&#123;BACKUP_DB_DIR&#125; &amp;&gt;/dev/null</span><br><span class="line">    TABLE_LIST=$(mysql -h$&#123;HOST&#125; -u$&#123;USER&#125; -p$&#123;PASS&#125; -s -e &quot;use $&#123;DB&#125;;show tables;&quot; 2&gt;/dev/null)</span><br><span class="line">    for TABLE in $&#123;TABLE_LIST&#125;; do</span><br><span class="line">        BACKUP_NAME=$&#123;BACKUP_DB_DIR&#125;/$&#123;TABLE&#125;.sql </span><br><span class="line">        if ! mysqldump -h$&#123;HOST&#125; -u$&#123;USER&#125; -p$&#123;PASS&#125; $&#123;DB&#125; $&#123;TABLE&#125; &gt; $&#123;BACKUP_NAME&#125; 2&gt;/dev/null; then</span><br><span class="line">            echo &quot;$BACKUP_NAME 备份失败!&quot;</span><br><span class="line">        fi</span><br><span class="line">    done</span><br></pre></td></tr></table></figure>
<h4 id="13-Nginx访问日志分析"><a href="#13-Nginx访问日志分析" class="headerlink" title="13.Nginx访问日志分析"></a>13.Nginx访问日志分析</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">LOG_FILE=$1</span><br><span class="line">echo &quot;统计访问最多的10个IP&quot;</span><br><span class="line">awk &#x27;&#123;a[$1]++&#125;END&#123;print &quot;UV:&quot;,length(a);for(v in a)print v,a[v]&#125;&#x27; $&#123;LOG_FILE&#125; |sort -k2 -nr |head -10</span><br><span class="line">echo &quot;----------------------&quot;</span><br><span class="line">echo &quot;统计时间段访问最多的IP&quot;</span><br><span class="line">awk &#x27;$4&gt;=&quot;[01/Dec/2021:14:25:54&quot; &amp;&amp; $4&lt;=&quot;[27/Nov/2021:17:25:34&quot;&#123;a[$1]++&#125;END&#123;for(v in a)print v,a[v]&#125;&#x27; $&#123;LOG_FILE&#125; |sort -k2 -nr|head -10</span><br><span class="line">echo &quot;----------------------&quot;</span><br><span class="line">echo &quot;统计访问最多的10个页面&quot;</span><br><span class="line">awk &#x27;&#123;a[$7]++&#125;END&#123;print &quot;PV:&quot;,length(a);for(v in a)&#123;if(a[v]&gt;10)print v,a[v]&#125;&#125;&#x27; $&#123;LOG_FILE&#125; |sort -k2 -nr</span><br><span class="line">echo &quot;----------------------&quot;</span><br><span class="line">echo &quot;统计访问页面状态码数量&quot;</span><br><span class="line">awk &#x27;&#123;a[$7&quot; &quot;$9]++&#125;END&#123;for(v in a)&#123;if(a[v]&gt;5)print v,a[v]&#125;&#125;&#x27; $&#123;LOG_FILE&#125; |sort -k3 -nr</span><br></pre></td></tr></table></figure>
<h4 id="14-Nginx访问日志自动按天（周、月）切割"><a href="#14-Nginx访问日志自动按天（周、月）切割" class="headerlink" title="14.Nginx访问日志自动按天（周、月）切割"></a>14.Nginx访问日志自动按天（周、月）切割</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx日志目录</span></span><br><span class="line">LOG_DIR=/www/server/nginx/logs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取到上一天的时间</span></span><br><span class="line">YESTERDAY_TIME=$(date -d &quot;yesterday&quot; +%F)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">归档日志取时间</span></span><br><span class="line">LOG_MONTH_DIR=$&#123;LOG_DIR&#125;/$(date +&quot;%Y-%m&quot;)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">归档日志的名称</span></span><br><span class="line">LOG_FILE_LIST=&quot;access.log&quot;</span><br><span class="line"> </span><br><span class="line">for LOG_FILE in $&#123;LOG_FILE_LIST&#125;; do</span><br><span class="line">    [ ! -d $&#123;LOG_MONTH_DIR&#125; ] &amp;&amp; mkdir -p $&#123;LOG_MONTH_DIR&#125;</span><br><span class="line">    mv $&#123;LOG_DIR&#125;/$&#123;LOG_FILE&#125; $&#123;LOG_MONTH_DIR&#125;/$&#123;LOG_FILE&#125;_$&#123;YESTERDAY_TIME&#125;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">kill -USR1 $(cat $&#123;LOG_DIR&#125;/nginx.pid)</span><br></pre></td></tr></table></figure>
<h4 id="15-一键编译安装Redis脚本"><a href="#15-一键编译安装Redis脚本" class="headerlink" title="15.一键编译安装Redis脚本"></a>15.一键编译安装Redis脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">VERSION=redis-5.0.9</span><br><span class="line">DIR1=/apps/redis</span><br><span class="line">PASSWORD=centos</span><br><span class="line">install() &#123;</span><br><span class="line">    yum -y install make wget gcc tcl &amp;&gt; /dev/null || &#123; action &quot;安装所需包失败，请检测包或网络配置&quot; false;exit;&#125;</span><br><span class="line">    wget http://download.redis.io/releases/$&#123;VERSION&#125;.tar.gz &amp;&gt; /dev/null || &#123;</span><br><span class="line">    action &quot;Redis 源码下载失败&quot; false; exit; &#125;</span><br><span class="line">    tar xf $VERSION.tar.gz</span><br><span class="line">    cd $VERSION/</span><br><span class="line">    make -j 2 &amp;&gt; /dev/null &amp;&amp; make PREFIX=$&#123;DIR1&#125; install &amp;&gt; /dev/null &amp;&amp; action &quot;Redis 编译安装成功&quot; || &#123; action &quot;Redis 编译安装失败&quot; false;exit; &#125;</span><br><span class="line">    ln -s $&#123;DIR1&#125;/bin/* /usr/bin/</span><br><span class="line">    mkdir -p $&#123;DIR1&#125;/&#123;etc,data,log,run&#125;</span><br><span class="line">    cd</span><br><span class="line">    cp $&#123;VERSION&#125;/redis.conf $&#123;DIR1&#125;/etc</span><br><span class="line">    sed -i -e &quot;s/bind 127.0.0.1/bind 0.0.0.0/&quot; -e &quot;/# requirepass/a requirepass $&#123;PASSWORD&#125;&quot; -e &quot;/^dir .*/c dir $&#123;DIR1&#125;/data/&quot; -e &quot;/logfile .*/c logfile $&#123;DIR1&#125;/log/redis_6379.log&quot; -e &quot;/^pidfile .*/c pidfile $&#123;DIR1&#125;/run/redis_6379.pid&quot; $&#123;DIR1&#125;/etc/redis.conf</span><br><span class="line">    if id redis &amp;&gt; /dev/null;then</span><br><span class="line">        action &quot;redis 用户已经存在&quot; false</span><br><span class="line">    else</span><br><span class="line">        useradd -r -s /sbin/nologin redis</span><br><span class="line">        action &quot;redis 用户创建成功&quot;</span><br><span class="line">    fi</span><br><span class="line">    chown -R redis.redis $&#123;DIR1&#125;</span><br><span class="line">    cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOF</span><br><span class="line">        net.core.somaxconn = 1024</span><br><span class="line">        vm.overcommit_memory = 1</span><br><span class="line">    EOF</span><br><span class="line">    sysctl -p</span><br><span class="line">    echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">    echo &quot;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&quot; &gt;&gt; /etc/rc.d/rc.local</span><br><span class="line">    chmod +x /etc/rc.d/rc.local /etc/rc.d/rc.local</span><br><span class="line">    cat &gt; /lib/systemd/system/redis.service &lt;&lt;EOF</span><br><span class="line">        [Unit]</span><br><span class="line">        Description=Redis persistent key-value database</span><br><span class="line">        After=network.target</span><br><span class="line">        [Service]</span><br><span class="line">        ExecStart=$&#123;DIR1&#125;/bin/redis-server $&#123;DIR1&#125;/etc/redis.conf --supervised</span><br><span class="line">        systemd</span><br><span class="line">        ExecStop=/bin/kill -s QUIT \$MAINPID</span><br><span class="line">        Type=notify</span><br><span class="line">        User=redis</span><br><span class="line">        Group=redis</span><br><span class="line">        RuntimeDirectory=redis</span><br><span class="line">        RuntimeDirectoryMode=0755</span><br><span class="line">        [Install]</span><br><span class="line">        WantedBy=multi-user.target</span><br><span class="line">    EOF</span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl enable --now redis &amp;&gt; /dev/null &amp;&amp; action &quot;redis 服务启动成功&quot; || &#123; action &quot;redis 服务启动失败&quot; false;exit; &#125;</span><br><span class="line">&#125;</span><br><span class="line">install</span><br></pre></td></tr></table></figure>
<h4 id="16-自动发布Java"><a href="#16-自动发布Java" class="headerlink" title="16.自动发布Java"></a>16.自动发布Java</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">DATE=$(date +%F_%T)</span><br><span class="line">TOMCAT_NAME=$1</span><br><span class="line">TOMCAT_DIR=/usr/local/$TOMCAT_NAME</span><br><span class="line">ROOT=$TOMCAT_DIR/webapps/ROOT</span><br><span class="line">BACKUP_DIR=/data/backup</span><br><span class="line">WORK_DIR=/tmp</span><br><span class="line">PROJECT_NAME=tomcat-java-demo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取代码</span></span><br><span class="line">cd $&#123;WORK_DIR&#125;</span><br><span class="line">if [ ! -d $&#123;PROJECT_NAME&#125; ]; then</span><br><span class="line">   git clone https://github.com/lizhenliang/tomcat-java-demo</span><br><span class="line">   cd $&#123;PROJECT_NAME&#125;</span><br><span class="line">else</span><br><span class="line">   cd $&#123;PROJECT_NAME&#125;</span><br><span class="line">   git pull</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建</span></span><br><span class="line">mvn clean package -Dmaven.test.skip=true</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">   echo &quot;maven build failure!&quot;</span><br><span class="line">   exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署</span></span><br><span class="line">TOMCAT_PID=$(ps -ef |grep &quot;$&#123;TOMCAT_NAME&#125;&quot; |egrep -v &quot;grep|$$&quot; |awk &#x27;NR==1&#123;print $2&#125;&#x27;)</span><br><span class="line">[ -n &quot;$&#123;TOMCAT_PID&#125;&quot; ] &amp;&amp; kill -9 $&#123;TOMCAT_PID&#125;</span><br><span class="line">[ -d $&#123;ROOT&#125; ] &amp;&amp; mv $&#123;ROOT&#125; $&#123;BACKUP_DIR&#125;/$&#123;&#123;TOMCAT_NAME&#125;&#125;_ROOT$&#123;DATE&#125;</span><br><span class="line">unzip $&#123;WORK_DIR&#125;/$&#123;PROJECT_NAME&#125;/target/*.war -d $&#123;ROOT&#125;</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;TOMCAT_DIR&#125;/bin/startup.sh</span></span><br></pre></td></tr></table></figure>
<h4 id="17-自动发布PHP项目"><a href="#17-自动发布PHP项目" class="headerlink" title="17.自动发布PHP项目"></a>17.自动发布PHP项目</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">DATE=$(date +%F_%T)</span><br><span class="line">WWWROOT=/usr/local/nginx/html/$1</span><br><span class="line">BACKUP_DIR=/data/backup</span><br><span class="line">WORK_DIR=/tmp</span><br><span class="line">PROJECT_NAME=php-demo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取代码</span></span><br><span class="line">cd $&#123;WORK_DIR&#125;</span><br><span class="line">if [ ! -d $&#123;PROJECT_NAME&#125; ]; then</span><br><span class="line">   git clone https://github.com/lizhenliang/php-demo</span><br><span class="line">   cd $&#123;PROJECT_NAME&#125;</span><br><span class="line">else</span><br><span class="line">   cd $&#123;PROJECT_NAME&#125;</span><br><span class="line">   git pull</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署</span></span><br><span class="line">if [ ! -d $&#123;WWWROOT&#125; ]; then</span><br><span class="line">   mkdir -p $&#123;WWWROOT&#125;</span><br><span class="line">   rsync -avz --exclude=.git $&#123;WORK_DIR&#125;/$&#123;PROJECT_NAME&#125;/* $&#123;WWWROOT&#125;</span><br><span class="line">else</span><br><span class="line">   rsync -avz --exclude=.git $&#123;WORK_DIR&#125;/$&#123;PROJECT_NAME&#125;/* $&#123;WWWROOT&#125;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h4 id="18-自动屏蔽攻击IP"><a href="#18-自动屏蔽攻击IP" class="headerlink" title="18.自动屏蔽攻击IP"></a>18.自动屏蔽攻击IP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">DATE=$(date +%d/%b/%Y:%H:%M)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx日志</span></span><br><span class="line">LOG_FILE=/usr/local/nginx/logs/demo2.access.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分析ip的访问情况</span></span><br><span class="line">ABNORMAL_IP=$(tail -n5000 $LOG_FILE |grep $DATE |awk &#x27;&#123;a[$1]++&#125;END&#123;for(i in a)if(a[i]&gt;10)print i&#125;&#x27;)</span><br><span class="line">for IP in $ABNORMAL_IP; do</span><br><span class="line">    if [ $(iptables -vnL |grep -c &quot;$IP&quot;) -eq 0 ]; then</span><br><span class="line">        iptables -I INPUT -s $IP -j DROP</span><br><span class="line">        echo &quot;$(date +&#x27;%F_%T&#x27;) $IP&quot; &gt;&gt; /tmp/drop_ip.log</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="19-目录入侵检测与告警"><a href="#19-目录入侵检测与告警" class="headerlink" title="19.目录入侵检测与告警"></a>19.目录入侵检测与告警</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">MON_DIR=/opt</span><br><span class="line">inotifywait -mqr --format %f -e create $MON_DIR |\</span><br><span class="line">while read files; do</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">同步文件</span></span><br><span class="line">   rsync -avz /opt /tmp/opt</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检测文件是否被修改</span></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date +&#x27;%F %T&#x27;)</span> create <span class="variable">$files</span>&quot;</span> | mail -s <span class="string">&quot;dir monitor&quot;</span> xxx@163.com</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://xczf.shop">betty bear</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xczf.shop/2021/06/01/Shell/">http://xczf.shop/2021/06/01/Shell/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xczf.shop" target="_blank">betty bear</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a></div><div class="post_share"><div class="social-share" data-image="/image/23.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/15/%E6%8C%87%E9%92%88/"><img class="prev-cover" src="/image/7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">指针(懵)</div></div></a></div><div class="next-post pull-right"><a href="/2021/04/15/KVM/"><img class="next-cover" src="/image/31.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">KVM</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/04/15/KVM/" title="KVM"><img class="cover" src="/image/31.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-15</div><div class="title">KVM</div></div></a></div><div><a href="/2021/04/01/Docker/" title="Docker"><img class="cover" src="/image/13.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-01</div><div class="title">Docker</div></div></a></div><div><a href="/2023/07/15/OpenStack/" title="Openstack"><img class="cover" src="/image/25.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-15</div><div class="title">Openstack</div></div></a></div><div><a href="/2021/01/31/linux%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B/" title="Linux网络IO模型"><img class="cover" src="/image/6.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-31</div><div class="title">Linux网络IO模型</div></div></a></div><div><a href="/2020/09/15/linux%E5%9F%BA%E7%A1%80/" title="Linux基础"><img class="cover" src="/image/4.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-15</div><div class="title">Linux基础</div></div></a></div><div><a href="/2020/04/15/PXE/" title="PXE无人值守安装系统"><img class="cover" src="/image/28.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-15</div><div class="title">PXE无人值守安装系统</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">betty bear</div><div class="author-info__description">最在意的，或许得不到了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ccmmdd"><i class="fab fa-github"></i><span>不要点我呀！</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ccmmdd" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3025346417@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">你也不想这件事被发现吧！~~~///(^v^)\\\~~~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%96%87%E6%9C%AC%E2%80%93grep"><span class="toc-number">2.</span> <span class="toc-text">过滤文本–grep</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9"><span class="toc-number">2.1.</span> <span class="toc-text">命令选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC%E2%80%93sed"><span class="toc-number">3.</span> <span class="toc-text">处理文本–sed</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E8%A1%8C%E4%B8%BA%E5%8D%95%E4%BD%8D%E7%9A%84%E6%96%B0%E5%A2%9E-x2F-%E5%88%A0%E9%99%A4"><span class="toc-number">3.1.</span> <span class="toc-text">以行为单位的新增&#x2F;删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E8%A1%8C%E4%B8%BA%E5%8D%95%E4%BD%8D%E7%9A%84%E6%9B%BF%E6%8D%A2%E4%B8%8E%E6%98%BE%E7%A4%BA"><span class="toc-number">3.2.</span> <span class="toc-text">以行为单位的替换与显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%90%9C%E5%AF%BB%E5%B9%B6%E6%98%BE%E7%A4%BA"><span class="toc-number">3.3.</span> <span class="toc-text">数据的搜寻并显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%90%9C%E5%AF%BB%E5%B9%B6%E5%88%A0%E9%99%A4"><span class="toc-number">3.4.</span> <span class="toc-text">数据的搜寻并删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%90%9C%E5%AF%BB%E5%B9%B6%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.5.</span> <span class="toc-text">数据的搜寻并执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%90%9C%E5%AF%BB%E5%B9%B6%E6%9B%BF%E6%8D%A2"><span class="toc-number">3.6.</span> <span class="toc-text">数据的搜寻并替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%82%B9%E7%BC%96%E8%BE%91"><span class="toc-number">3.7.</span> <span class="toc-text">多点编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-number">3.8.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E6%89%BE%E2%80%93awk"><span class="toc-number">4.</span> <span class="toc-text">数据查找–awk</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Btest-txt%E6%96%87%E4%BB%B6%EF%BC%88100%E8%A1%8C%EF%BC%89%E5%86%85%E7%AC%AC20%E5%88%B0%E7%AC%AC30%E8%A1%8C%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">4.0.1.</span> <span class="toc-text">查看test.txt文件（100行）内第20到第30行的内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%83%B3%E5%BE%97%E5%88%B0%E5%86%85%E5%AE%B9"><span class="toc-number">4.0.2.</span> <span class="toc-text">过滤想得到内容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BEGIN-%E5%92%8C-END-%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">BEGIN 和 END 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1-x2F-etc-x2F-passwd%E7%9A%84%E8%B4%A6%E6%88%B7%E4%BA%BA%E6%95%B0"><span class="toc-number">4.1.1.</span> <span class="toc-text">统计&#x2F;etc&#x2F;passwd的账户人数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%8D%A0%E7%94%A8%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0"><span class="toc-number">4.1.2.</span> <span class="toc-text">统计某个文件夹下的文件占用的字节数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.2.</span> <span class="toc-text">awk运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">4.3.</span> <span class="toc-text">awk 内置变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2"><span class="toc-number">4.4.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell"><span class="toc-number">5.</span> <span class="toc-text">Shell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%84%9A%E6%9C%AC"><span class="toc-number">5.1.</span> <span class="toc-text">调试脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">5.3.</span> <span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F"><span class="toc-number">5.3.1.</span> <span class="toc-text">使用变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%A7%8D%E7%B1%BB"><span class="toc-number">5.3.2.</span> <span class="toc-text">变量种类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">5.4.</span> <span class="toc-text">文件描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">5.5.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97"><span class="toc-number">5.6.</span> <span class="toc-text">算数运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">5.7.</span> <span class="toc-text">条件测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%B5%8B%E8%AF%95"><span class="toc-number">5.7.1.</span> <span class="toc-text">数值测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B5%8B%E8%AF%95"><span class="toc-number">5.7.2.</span> <span class="toc-text">字符串测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">5.7.3.</span> <span class="toc-text">文件测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92-read"><span class="toc-number">5.8.</span> <span class="toc-text">用户交互 read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.9.</span> <span class="toc-text">循环语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">5.10.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell%E6%A1%88%E4%BE%8B"><span class="toc-number">5.11.</span> <span class="toc-text">shell案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0-%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86%E6%88%90%E5%8A%9F%E6%97%B6%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">5.11.1.</span> <span class="toc-text">0.用户登陆成功时输出系统的相关信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">5.11.2.</span> <span class="toc-text">1.服务器系统的配置初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8F%91%E9%80%81%E5%91%8A%E8%AD%A6%E9%82%AE%E4%BB%B6"><span class="toc-number">5.11.3.</span> <span class="toc-text">2.发送告警邮件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA100%E7%94%A8%E6%88%B7%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">5.11.4.</span> <span class="toc-text">3.批量创建100用户并设置密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%A9%E7%94%A8%E7%8E%87"><span class="toc-number">5.11.5.</span> <span class="toc-text">4.查看服务器利用率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%89%BE%E5%87%BA%E5%8D%A0%E7%94%A8CPU-x2F-%E5%86%85%E5%AD%98%E8%BF%87%E9%AB%98%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.11.6.</span> <span class="toc-text">5.找出占用CPU&#x2F;内存过高的进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E5%AE%9E%E6%97%B6%E6%B5%81%E9%87%8F"><span class="toc-number">5.11.7.</span> <span class="toc-text">6.查看网卡实时流量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E8%BF%9C%E7%A8%8B%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A3%81%E7%9B%98%E5%8D%A0%E7%94%A8%E7%8E%87"><span class="toc-number">5.11.8.</span> <span class="toc-text">7.远程查看服务器磁盘占用率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E7%BD%91%E7%AB%99%E6%98%AF%E5%90%A6%E5%BC%82%E5%B8%B8"><span class="toc-number">5.11.9.</span> <span class="toc-text">8.网站是否异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E4%B8%BB%E6%9C%BA%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E8%84%9A%E6%9C%AC"><span class="toc-number">5.11.10.</span> <span class="toc-text">9.主机远程执行命令脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2LNMP"><span class="toc-number">5.11.11.</span> <span class="toc-text">10.一键部署LNMP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-MySQL%E4%B8%BB%E4%BB%8E%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">5.11.12.</span> <span class="toc-text">11.MySQL主从是否正常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-MySql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD"><span class="toc-number">5.11.13.</span> <span class="toc-text">12.MySql数据库备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-Nginx%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">5.11.14.</span> <span class="toc-text">13.Nginx访问日志分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-Nginx%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E8%87%AA%E5%8A%A8%E6%8C%89%E5%A4%A9%EF%BC%88%E5%91%A8%E3%80%81%E6%9C%88%EF%BC%89%E5%88%87%E5%89%B2"><span class="toc-number">5.11.15.</span> <span class="toc-text">14.Nginx访问日志自动按天（周、月）切割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Redis%E8%84%9A%E6%9C%AC"><span class="toc-number">5.11.16.</span> <span class="toc-text">15.一键编译安装Redis脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83Java"><span class="toc-number">5.11.17.</span> <span class="toc-text">16.自动发布Java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17-%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83PHP%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.11.18.</span> <span class="toc-text">17.自动发布PHP项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BD%E6%94%BB%E5%87%BBIP"><span class="toc-number">5.11.19.</span> <span class="toc-text">18.自动屏蔽攻击IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19-%E7%9B%AE%E5%BD%95%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%91%8A%E8%AD%A6"><span class="toc-number">5.11.20.</span> <span class="toc-text">19.目录入侵检测与告警</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/10/01/DevOps/" title="devops"><img src="/image/16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="devops"/></a><div class="content"><a class="title" href="/2023/10/01/DevOps/" title="devops">devops</a><time datetime="2023-10-01T11:00:41.000Z" title="发表于 2023-10-01 19:00:41">2023-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/01/memcache/" title="memcache"><img src="/image/27.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="memcache"/></a><div class="content"><a class="title" href="/2023/09/01/memcache/" title="memcache">memcache</a><time datetime="2023-09-01T11:00:41.000Z" title="发表于 2023-09-01 19:00:41">2023-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/01/python-PyQt/" title="Python-PyQt"><img src="/image/33.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-PyQt"/></a><div class="content"><a class="title" href="/2023/08/01/python-PyQt/" title="Python-PyQt">Python-PyQt</a><time datetime="2023-08-01T11:00:41.000Z" title="发表于 2023-08-01 19:00:41">2023-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/15/OpenStack/" title="Openstack"><img src="/image/25.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Openstack"/></a><div class="content"><a class="title" href="/2023/07/15/OpenStack/" title="Openstack">Openstack</a><time datetime="2023-07-15T11:00:41.000Z" title="发表于 2023-07-15 19:00:41">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/01/python-flask/" title="Python-Flask"><img src="/image/35.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-Flask"/></a><div class="content"><a class="title" href="/2023/05/01/python-flask/" title="Python-Flask">Python-Flask</a><time datetime="2023-05-01T11:00:41.000Z" title="发表于 2023-05-01 19:00:41">2023-05-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/23.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By betty bear</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">啊，对对对!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://xczf.shop/2021/06/01/Shell/'
    this.page.identifier = '2021/06/01/Shell/'
    this.page.title = 'Shell'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer src="/live2d-widget/autoload.js"></script><div class="aplayer no-destroy" data-id="8828254214" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>