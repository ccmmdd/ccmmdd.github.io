<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>python 爬虫 （施工中） | betty bear</title><meta name="keywords" content="request"><meta name="author" content="betty bear,3025346417@qq.com"><meta name="copyright" content="betty bear"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一.基础部分1.爬虫概念什么是爬虫网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。只要是浏览器(客户端)能做的事情，爬虫都能够做 获取爬虫其它公司开发的通用爬虫：八爪鱼，火车头开发人员自己编写（目的性很强，定向爬虫） 爬虫的分类通用爬虫 ：通常指搜索引擎的爬虫聚焦爬虫 ：针对特定网站的爬虫 2.流程   向起始url">
<meta property="og:type" content="article">
<meta property="og:title" content="python 爬虫 （施工中）">
<meta property="og:url" content="http://xczf.shop/2021/07/15/python-%E7%88%AC%E8%99%AB/index.html">
<meta property="og:site_name" content="betty bear">
<meta property="og:description" content="一.基础部分1.爬虫概念什么是爬虫网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。只要是浏览器(客户端)能做的事情，爬虫都能够做 获取爬虫其它公司开发的通用爬虫：八爪鱼，火车头开发人员自己编写（目的性很强，定向爬虫） 爬虫的分类通用爬虫 ：通常指搜索引擎的爬虫聚焦爬虫 ：针对特定网站的爬虫 2.流程   向起始url">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xczf.shop/image/22.jpg">
<meta property="article:published_time" content="2021-07-15T11:00:41.000Z">
<meta property="article:modified_time" content="2023-12-19T09:24:58.366Z">
<meta property="article:author" content="betty bear">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xczf.shop/image/22.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xczf.shop/2021/07/15/python-%E7%88%AC%E8%99%AB/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":500,"languages":{"author":"作者: betty bear","link":"链接: ","source":"来源: betty bear","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'python 爬虫 （施工中）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-19 17:24:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="betty bear" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/22.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">betty bear</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 便签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">python 爬虫 （施工中）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-15T11:00:41.000Z" title="发表于 2021-07-15 19:00:41">2021-07-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-19T09:24:58.366Z" title="更新于 2023-12-19 17:24:58">2023-12-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/cate%EF%BC%9Agories/python/">python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="python 爬虫 （施工中）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一-基础部分"><a href="#一-基础部分" class="headerlink" title="一.基础部分"></a>一.基础部分</h2><h3 id="1-爬虫概念"><a href="#1-爬虫概念" class="headerlink" title="1.爬虫概念"></a>1.爬虫概念</h3><h4 id="什么是爬虫"><a href="#什么是爬虫" class="headerlink" title="什么是爬虫"></a>什么是爬虫</h4><p>网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。只要是浏览器(客户端)能做的事情，爬虫都能够做</p>
<h4 id="获取爬虫"><a href="#获取爬虫" class="headerlink" title="获取爬虫"></a>获取爬虫</h4><p>其它公司开发的通用爬虫：八爪鱼，火车头<br>开发人员自己编写（目的性很强，定向爬虫）</p>
<h4 id="爬虫的分类"><a href="#爬虫的分类" class="headerlink" title="爬虫的分类"></a>爬虫的分类</h4><p>通用爬虫 ：通常指搜索引擎的爬虫<br>聚焦爬虫 ：针对特定网站的爬虫</p>
<h3 id="2-流程"><a href="#2-流程" class="headerlink" title="2.流程"></a>2.流程</h3><hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/1.jpg" alt="1"></p>
<hr>
<p>向起始url发送请求，并获取响应-&gt;对响应进行提取-&gt;如果提取url，则继续发送请求获取响应-&gt;如果提取数据，则将数据进行保存<br><strong>提取url是最耗时、最复杂的地方</strong></p>
<h3 id="3-http-https协议"><a href="#3-http-https协议" class="headerlink" title="3.http,https协议"></a>3.http,https协议</h3><p>基础部分：<a target="_blank" rel="noopener" href="https://www.xczf.asia/2023/10/01/DevOps/#http-%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE">https://www.xczf.asia/2023/10/01/DevOps/#http-%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE</a><br>网络调试助手下载： <a target="_blank" rel="noopener" href="http://www.cmsoft.cn/download/cmsoft/netassist.zip">http://www.cmsoft.cn/download/cmsoft/netassist.zip</a><br>加上HTTP协议的内容,整体当做数据发送给TCP服务器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK <span class="comment"># 响应头</span></span><br><span class="line"></span><br><span class="line">hello world <span class="comment"># 响应体s</span></span><br></pre></td></tr></table></figure>
<ul>
<li>请求头：告诉http服务器当前http客户端信息<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:8081 # 主机和端口号</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive # 链接类型</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Google Chrome&quot;;v=&quot;119&quot;, &quot;Chromium&quot;;v=&quot;119&quot;, &quot;Not?A_Brand&quot;;v=&quot;24&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1 # 升级为HTTPS请求</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 # 浏览器名称</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>... # 传输文件类型</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br # 文件编解码格式</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en-CN;q=0.8,en;q=0.7,zh-HK;q=0.6</span><br><span class="line"># x-requested-with :XMLHttpRequest 表示该请求是Ajax异步请求</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>... # Cookie</span><br></pre></td></tr></table></figure></li>
<li>一个页面显示的过程<br>1.浏览器先向地址栏中的url发起请求，并获取相应<br>2.在返回的响应内容（html）中，会带有css、js、图片等url地址，以及ajax代码，浏览器按照响应内容中的顺序依次发送其他的请求，并获取相应的响应<br>3.浏览器每获取一个响应就对展示出的结果进行添加（加载），js，css等内容会修改页面的内容，js也可以重新发送请求，获取响应<br>4.渲染:从获取第一个响应并在浏览器中展示，直到最终获取全部响应，并在展示的结果中添加内容或修改<h3 id="4-robots协议"><a href="#4-robots协议" class="headerlink" title="4.robots协议"></a>4.robots协议</h3>在线生成robots：<a target="_blank" rel="noopener" href="https://tool.chinaz.com/robots">https://tool.chinaz.com/robots</a><br>Robots协议：网站通过Robots协议告诉搜索引擎哪些页面可以抓取，哪些页面不能抓取，但它仅仅是互联网中的一般约定<br>Robots.txt:存放于站点根目录下的纯文本文件，指定搜索引擎只抓取指定内容，禁止抓取的部分内容或全部内容</li>
<li>User-agent:只能有一条，用于描述搜索引擎名字</li>
<li>Disallow：描述不希望被访问到的URL<h3 id="5-爬虫相关插件"><a href="#5-爬虫相关插件" class="headerlink" title="5.爬虫相关插件"></a>5.爬虫相关插件</h3>XPath Helper：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/xpath-helper/hgimnogjllphhhkhlmebbmlgjoejdpjl?hl=zh-CN">https://chrome.google.com/webstore/detail/xpath-helper/hgimnogjllphhhkhlmebbmlgjoejdpjl?hl=zh-CN</a><br>Web Scraper：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/web-scraper-free-web-scra/jnhgnonknehpejjnehehllkliplmbmhn?hl=zh-CN">https://chrome.google.com/webstore/detail/web-scraper-free-web-scra/jnhgnonknehpejjnehehllkliplmbmhn?hl=zh-CN</a><br>Toggle JavaScript：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/toggle-javascript/cidlcjdalomndpeagkjpnefhljffbnlo?hl=zh-CN">https://chrome.google.com/webstore/detail/toggle-javascript/cidlcjdalomndpeagkjpnefhljffbnlo?hl=zh-CN</a><br>User-Agent Switcher for Chrome：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg?hl=zh-CN">https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg?hl=zh-CN</a><br>EditThisCookie：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg?hl=zh-CN">https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg?hl=zh-CN</a><br>switchysharp：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/proxy-switchysharp/dpplabbmogkhghncfbfdeeokoefdjegm?hl=zh-CN">https://chrome.google.com/webstore/detail/proxy-switchysharp/dpplabbmogkhghncfbfdeeokoefdjegm?hl=zh-CN</a><br>JSON-handle：<a target="_blank" rel="noopener" href="https://chromewebstore.google.com/detail/json-handle/iahnhfdhidomcpggpaimmmahffihkfnj?hl=zh-CN">https://chromewebstore.google.com/detail/json-handle/iahnhfdhidomcpggpaimmmahffihkfnj?hl=zh-CN</a><h3 id="6-爬虫相关软件"><a href="#6-爬虫相关软件" class="headerlink" title="6.爬虫相关软件"></a>6.爬虫相关软件</h3><h4 id="POSTMAN"><a href="#POSTMAN" class="headerlink" title="POSTMAN"></a>POSTMAN</h4>下载：<a target="_blank" rel="noopener" href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a><br>POSTMAN教程：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/97ba64888894">https://www.jianshu.com/p/97ba64888894</a><h4 id="ApiPost"><a href="#ApiPost" class="headerlink" title="ApiPost"></a>ApiPost</h4>下载：<a target="_blank" rel="noopener" href="https://www.apipost.cn/download.html">https://www.apipost.cn/download.html</a><br>ApiPost教程<a target="_blank" rel="noopener" href="https://doc.apipost.cn/">https://doc.apipost.cn/</a><h3 id="7-requests模块"><a href="#7-requests模块" class="headerlink" title="7.requests模块"></a>7.requests模块</h3>作用：发送网络请求，返回响应数据<br>中文文档 ：<a target="_blank" rel="noopener" href="https://requests.readthedocs.io/zh_CN/latest">https://requests.readthedocs.io/zh_CN/latest</a><h4 id="安装requests模块"><a href="#安装requests模块" class="headerlink" title="安装requests模块"></a>安装requests模块</h4></li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install pip==20.2.4</span><br><span class="line">pip install requests</span><br></pre></td></tr></table></figure></li>
<li>模块管理<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt <span class="comment"># 查看已经安装的模块</span></span><br><span class="line">pip install -r requirements.txt <span class="comment"># 下载文件中所有模块</span></span><br></pre></td></tr></table></figure>
<h4 id="requests发送get"><a href="#requests发送get" class="headerlink" title="requests发送get"></a>requests发送get</h4>通过requests向url发送请求，获取数据<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">response = requests.get(url=url)</span><br><span class="line"><span class="comment"># 三种方法按顺序尝试，解决所有网页解码的问题</span></span><br><span class="line"><span class="comment"># str类型数据，默认解码得到的内容，一般都是正确的，text一般用于文本</span></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="comment"># str类型数据(utf-8)</span></span><br><span class="line"><span class="comment"># bytes类型数据，content用于媒体文件</span></span><br><span class="line"><span class="built_in">print</span>(response.content.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(response.encoding=utf-<span class="number">8</span>)</span><br></pre></td></tr></table></figure></li>
<li>reponse常用属性<br>response.text                        响应体 str类型<br>respones.content                 响应体 bytes类型<br>response.status_code          响应状态码<br>response.request.headers  响应对应的请求头<br>response.headers                 响应头<br>response.request.cookies    响应对应请求的cookie<br>response.cookies                  响应的cookie（经过了set-cookie动作）<br>response.url                           请求的URL<h5 id="案例：下载一张图片"><a href="#案例：下载一张图片" class="headerlink" title="案例：下载一张图片"></a>案例：下载一张图片</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;https://trademark.zbjimg.com/pattern-prod/2016/image_27/20577261.jpg&quot;</span></span><br><span class="line"><span class="comment"># 响应是图片，且是而二进制类型</span></span><br><span class="line">r = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二进制打开+写入打开文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/img/A.jpg&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f.write(r.content)</span><br></pre></td></tr></table></figure>
<h4 id="iter-content"><a href="#iter-content" class="headerlink" title="iter_content"></a>iter_content</h4>iter_content：想要知道下载的进度，可以通过类似迭代的方式下载部分资源</li>
<li>使用iter_content<br>在获取数据时，设置stream&#x3D;True**(如果设置了stream&#x3D;True，那么什么时候要获取这个数据内容，才会真正的开始下载。如果不设置stream&#x3D;True，那么在调用resquests.get时，就会耗费时间下载)**<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(url=url, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 取值</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.html&quot;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fd:</span><br><span class="line">	<span class="comment"># chunk_size每一条线程执行通过块大小</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">100</span>):</span><br><span class="line">        fd.write(chunk)</span><br></pre></td></tr></table></figure>
<h5 id="下载视频时显示进度"><a href="#下载视频时显示进度" class="headerlink" title="下载视频时显示进度"></a>下载视频时显示进度</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">video_url = <span class="string">&quot;https://f.video.weibocdn.com/o0/98KgDiAIlx08aa603yXu01041200PeG20E010.mp4?label=mp4_1080p&amp;template=1920x1080.25.0&amp;media_id=4967933810507867&amp;tp=8x8A3El:YTkl0eM8&amp;us=0&amp;ori=1&amp;bf=4&amp;ot=h&amp;ps=3lckmu&amp;uid=3ZoTIp&amp;ab=,8143-g0,8013-g0,3601-g27&amp;Expires=1700124023&amp;ssig=Ljd%2Fl28WYG&amp;KID=unistore,video&quot;</span></span><br><span class="line">r = requests.get(url=video_url, stream=True)</span><br><span class="line"><span class="comment"># 总长度</span></span><br><span class="line">reponse_body_lenth = int(r.headers.get(<span class="string">&quot;Content-Length&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;body的数据长度为:&quot;</span>, reponse_body_lenth)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取响应内容存储到文件</span></span><br><span class="line">with open(<span class="string">&quot;1.mp4&quot;</span>, <span class="string">&#x27;wb&#x27;</span>) as fd:</span><br><span class="line">    write_length = 0</span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=100):</span><br><span class="line">        write_length += fd.write(chunk)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;下载进度: %02.2f%%&quot;</span> % (100 * write_length / reponse_body_lenth))</span><br></pre></td></tr></table></figure>
<h4 id="发送带header请求"><a href="#发送带header请求" class="headerlink" title="发送带header请求"></a>发送带header请求</h4>有些URL，在请求时不同的浏览器版本得到的响应内容不同，所以此时我们就需要修改请求头或者添加请求头信息</li>
<li>r.headers  响应头</li>
<li>r.request.headers <strong>请求头</strong></li>
<li>给请求添加header操作<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line">r = requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure>
<h5 id="携带User-Agent请求"><a href="#携带User-Agent请求" class="headerlink" title="携带User-Agent请求"></a>携带User-Agent请求</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url, headers=headers)</span><br><span class="line"><span class="comment"># 打印请求头信息</span></span><br><span class="line"><span class="built_in">print</span>(r.request.headers)</span><br><span class="line"><span class="comment"># 响应内容</span></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<h4 id="带有URL-参数的请求"><a href="#带有URL-参数的请求" class="headerlink" title="带有URL 参数的请求"></a>带有URL 参数的请求</h4>搜索的时候经常发现url地址中会有一个 ?，问号后边的就是请求参数，又叫查询字符串<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kw = &#123;<span class="string">&#x27;wd&#x27;</span>:<span class="string">&#x27;python&#x27;</span>&#125; <span class="comment"># 请求参数的形式：字典</span></span><br><span class="line">r = requests.get(url, params=kw)</span><br></pre></td></tr></table></figure>
<h5 id="案例-baidu查询"><a href="#案例-baidu查询" class="headerlink" title="案例:baidu查询"></a>案例:baidu查询</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是目标url</span></span><br><span class="line"><span class="comment"># url = &#x27;https://www.baidu.com/s?wd=1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后有没有问号结果都一样</span></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com/s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求参数是一个字典 即wd=python</span></span><br><span class="line">kw = &#123;<span class="string">&#x27;wd&#x27;</span>: <span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url, headers=headers, params=kw)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求的URL：&quot;</span>, r.url)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;响应内容如下：&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.content)</span><br></pre></td></tr></table></figure>
<h4 id="发送POST请求"><a href="#发送POST请求" class="headerlink" title="发送POST请求"></a>发送POST请求</h4>POST，用来提交数据</li>
<li>发送POST请求的方式<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;keyword&quot;</span>: <span class="string">&quot;hello&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(<span class="string">&quot;目标URL&quot;</span>, data=data)</span><br></pre></td></tr></table></figure>
<h5 id="单词查询"><a href="#单词查询" class="headerlink" title="单词查询"></a>单词查询</h5></li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/2.jpg" alt="单词查询"></p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fanyi</span>(<span class="params">keyword</span>):</span><br><span class="line">    url = <span class="string">&quot;https://fanyi.baidu.com/sug&quot;</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># 要发送的请求体</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;kw&quot;</span>: keyword</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url=url, headers=headers, data=data)</span><br><span class="line">    <span class="comment"># 将字符串格式的字典（json字符串），转换为python字典</span></span><br><span class="line">    text_dict = json.loads(r.text)</span><br><span class="line">    k = text_dict.get(<span class="string">&quot;data&quot;</span>)[<span class="number">0</span>].get(<span class="string">&quot;k&quot;</span>)</span><br><span class="line">    v = text_dict.get(<span class="string">&quot;data&quot;</span>)[<span class="number">0</span>].get(<span class="string">&quot;v&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(k)</span><br><span class="line">    <span class="built_in">print</span>(v)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        keyword = <span class="built_in">input</span>(<span class="string">&#x27;请输入单词:&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> keyword == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fanyi(keyword)</span><br></pre></td></tr></table></figure>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/3.jpg" alt="boy"></p>
<hr>
<h5 id="任意贴吧网页源码爬取"><a href="#任意贴吧网页源码爬取" class="headerlink" title="任意贴吧网页源码爬取"></a>任意贴吧网页源码爬取</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TieBaSpider</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,tieba_name,n</span>):</span><br><span class="line">        self.tieba_name =tieba_name</span><br><span class="line">        self.n = n</span><br><span class="line">        self.url_temp = <span class="string">&quot;https://tieba.baidu.com/f?kw=&quot;</span> + tieba_name + <span class="string">&quot;=&amp;pn&#123;&#125;&quot;</span></span><br><span class="line">        self.headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_url_list</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;将每页的网址传入数组，每50pn代表一页&#x27;&#x27;&#x27;</span></span><br><span class="line">        url_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n):</span><br><span class="line">            url = self.url_temp.<span class="built_in">format</span>(i*<span class="number">50</span>)</span><br><span class="line">            url_list.append(url)</span><br><span class="line">        <span class="keyword">return</span> url_list</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_url</span>(<span class="params">self,url</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;发送请求，获取数据,并以bit返回&#x27;&#x27;&#x27;</span></span><br><span class="line">        r = requests.get(url,headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.content.decode()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_html_str</span>(<span class="params">self,html_str,page_num</span>):</span><br><span class="line">        txt_name = <span class="string">&quot;&#123;&#125;吧-第&#123;&#125;页.html&quot;</span>.<span class="built_in">format</span>(self.tieba_name,page_num)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(txt_name,<span class="string">&quot;w&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(html_str)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 1.造url_list列表</span></span><br><span class="line">        url_list = self.get_url_list()</span><br><span class="line">        <span class="comment"># 2.遍历url_list发送请求，获取响应</span></span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">            html_str = self.parse_url(url)</span><br><span class="line">            <span class="comment"># 3.保存</span></span><br><span class="line">            page_num = url_list.index(url) + <span class="number">1</span></span><br><span class="line">            self.save_html_str(html_str,page_num)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;save Done&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    tieba_name = <span class="built_in">input</span>(<span class="string">&quot;请输入贴吧名字:&quot;</span>)</span><br><span class="line">    page = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入爬取页数:&quot;</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tieba = TieBaSpider(tieba_name,page)</span><br><span class="line">        tieba.run()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误为：&quot;</span>+e)</span><br></pre></td></tr></table></figure>
<h4 id="requests处理cookie"><a href="#requests处理cookie" class="headerlink" title="requests处理cookie"></a>requests处理cookie</h4><p>cookie和session详解：<a target="_blank" rel="noopener" href="https://blog.csdn.net/swadian2008/article/details/104267034">https://blog.csdn.net/swadian2008/article/details/104267034</a><br>为什么要有cookie：http是上网最常用的协议，但它是无状态的，所以浏览器再次请求并不知到第一次请求的情况，所以第一次请求后服务器会给浏览器一个值，下次访问有即认为不是新用户<br>什么是session：session是保存在服务端的，服务端要给每个用户保存一个sessionId，而浏览器只需要保存自己的seeionId，这样就给服务器增加了负担。因为每个用户只需要存自己的sessionId，而服务器需要存所有用户的sessionId。</p>
<h5 id="发送请求时添加cookie"><a href="#发送请求时添加cookie" class="headerlink" title="发送请求时添加cookie"></a>发送请求时添加cookie</h5><ul>
<li>cookie字符串添加headers中<br><strong>cookie有过期时间 ，所以直接复制浏览器中的cookie可能意味着下一次运行程序时需要替换代码中的cookie，对应的我们也可以通过一个程序专门来获取cookie供其他程序使用；当然也有很多网站的cookie过期时间很长，这种情况下，直接复制cookie来使用更加简单</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PPA_CI=6282ee9fda2dc5bbd68bdc44ace090f7; Hm_lvt_12d0a9d48890160be2aeca33f7eb2fdb=1700049682,1700111290,1700228785,1700277765; Hm_lpvt_12d0a9d48890160be2aeca33f7eb2fdb=1700277770&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure></li>
<li>cookies参数接收字典形式的cookie<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookies = &#123;<span class="string">&quot;cookie的name&quot;</span>: <span class="string">&quot;cookie的value&quot;</span>&#125;</span><br><span class="line">requests.get(url, headers=headers, cookies=cookie_dict)</span><br></pre></td></tr></table></figure></li>
<li>将字符串cookie转换为字典<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookies_dict = &#123;temp[:temp.find(<span class="string">&quot;=&quot;</span>)]: temp[temp.find(<span class="string">&quot;=&quot;</span>)+<span class="number">1</span>:] <span class="keyword">for</span> temp <span class="keyword">in</span> cookies_str.split(<span class="string">&quot;; &quot;</span>)&#125;</span><br></pre></td></tr></table></figure>
<h5 id="获取响应时提取cookie"><a href="#获取响应时提取cookie" class="headerlink" title="获取响应时提取cookie"></a>获取响应时提取cookie</h5></li>
<li>直接从响应头中get<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(r.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>))</span><br></pre></td></tr></table></figure></li>
<li>response.cookies<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookies = requests.utils.dict_from_cookiejar(r.cookies)</span><br></pre></td></tr></table></figure>
<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4>通过各种方法将各种网络请求重新定个方向转到其它位置<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&quot;http://www.360buy.com&quot;</span>, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(r.url) <span class="comment"># 返回了https://www.jd.com/，即重定向</span></span><br></pre></td></tr></table></figure>
<h5 id="取消自动重定向"><a href="#取消自动重定向" class="headerlink" title="取消自动重定向"></a>取消自动重定向</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.get(url, allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&quot;http://www.baidu.com&quot;</span>, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(r.status_code) <span class="comment"># 302</span></span><br><span class="line"><span class="built_in">print</span>(r.url) <span class="comment"># http://www.baidu.com </span></span><br><span class="line"><span class="built_in">print</span>(r.headers.get(<span class="string">&quot;Location&quot;</span>)) <span class="comment"># https://www.baidu.com/</span></span><br></pre></td></tr></table></figure>
<h5 id="获取历史请求（即获取重定向的所有记录）"><a href="#获取历史请求（即获取重定向的所有记录）" class="headerlink" title="获取历史请求（即获取重定向的所有记录）"></a>获取历史请求（即获取重定向的所有记录）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&quot;http://www.360buy.com&quot;</span>, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;历史请求过程信息：&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.history)</span><br><span class="line"><span class="keyword">for</span> one_info <span class="keyword">in</span> r.history:</span><br><span class="line">    <span class="built_in">print</span>(one_info.status_code, one_info.url, one_info.headers.get(<span class="string">&quot;Location&quot;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="SSL证书错误"><a href="#SSL证书错误" class="headerlink" title="SSL证书错误"></a>SSL证书错误</h4></li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/4.jpg" alt="SSL证书错误"></p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 即有报错ssl.CertificateError ...</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://12306.cn/mormhweb/&quot;</span></span><br><span class="line"><span class="comment"># verify=False即可解决问题</span></span><br><span class="line">r = requests.get(url, verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<h4 id="请求超时"><a href="#请求超时" class="headerlink" title="请求超时"></a>请求超时</h4><p>一个请求很久没有结果，就会让整个项目的效率变得非常低，这个时候我们就需要对请求进行强制要求，让他必须在特定的时间内返回结果，否则就报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.google.com&quot;</span></span><br><span class="line">r = requests.get(url, timeout=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="retrying模块"><a href="#retrying模块" class="headerlink" title="retrying模块"></a>retrying模块</h4><p>retrying模块的地址：<a target="_blank" rel="noopener" href="https://pypi.org/project/retrying/">https://pypi.org/project/retrying/</a></p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install retrying</span><br></pre></td></tr></table></figure>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>通过装饰器的方式使用，让<strong>被装饰的函数反复执行retry中可以传入参数stop_max_attempt_number,让函数报错后继续重新执行，达到最大执行次数的上限，如果每次都报错，整个函数报错，如果中间有一个成功，程序继续往后执行</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"></span><br><span class="line">num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(<span class="params">stop_max_attempt_number=<span class="number">2</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;num=&quot;</span>, num)</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">100</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;i&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        test()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ret:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;产生异常...&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有异常&quot;</span>)</span><br><span class="line"><span class="comment"># num = 1</span></span><br><span class="line"><span class="comment"># num = 2</span></span><br><span class="line"><span class="comment"># 产生异常...</span></span><br></pre></td></tr></table></figure>
<h5 id="retrying和requests的简单封装"><a href="#retrying和requests的简单封装" class="headerlink" title="retrying和requests的简单封装"></a>retrying和requests的简单封装</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"></span><br><span class="line">num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(<span class="params">stop_max_attempt_number=<span class="number">3</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_url_test</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第%d次尝试&quot;</span> % num)</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># 超时的时候会报错并重试</span></span><br><span class="line">    r = requests.get(url, headers=headers, timeout=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 状态码不是200，也会报错并重试</span></span><br><span class="line">    <span class="keyword">assert</span> r.status_code == <span class="number">200</span>  <span class="comment"># 断言:如果assert 后面的条件为True则呈现继续运行，否则抛出异常</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_url</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="comment"># 进行异常捕获</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = parse_url_test(url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;产生异常：&quot;</span>, e)</span><br><span class="line">        <span class="comment"># 报错返回None</span></span><br><span class="line">        r = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;https://chinasoftinc.com/owa&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----开始----&quot;</span>)</span><br><span class="line">    r = parse_url(url=url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----结束----&quot;</span>, <span class="string">&quot;响应内容为：&quot;</span>, r)</span><br></pre></td></tr></table></figure>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/5.jpg" alt="retrying"></p>
<hr>
<h4 id="发送json数据"><a href="#发送json数据" class="headerlink" title="发送json数据"></a>发送json数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.post(url, json=&#123;<span class="string">&quot;kw&quot;</span>: <span class="string">&quot;python&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="登录查询"><a href="#登录查询" class="headerlink" title="登录查询"></a>登录查询</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 薪经咨询登录URL</span></span><br><span class="line">url = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"><span class="comment"># 配置要登录的用户名</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;mobile&quot;</span>: <span class="string">&quot;xxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;xxxxxxx&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 进行登录</span></span><br><span class="line">r = requests.post(url=url, headers=headers, json=payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求头是：&quot;</span>, r.request.headers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求体是：&quot;</span>, r.request.body)</span><br><span class="line"><span class="comment"># 响应的cookie</span></span><br><span class="line"><span class="built_in">print</span>(requests.utils.dict_from_cookiejar(r.cookies))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;响应体为：&quot;</span>, r.json())</span><br><span class="line"><span class="comment"># print(json.loads(r.text))</span></span><br></pre></td></tr></table></figure>
<h4 id="Session会话"><a href="#Session会话" class="headerlink" title="Session会话"></a>Session会话</h4><p>爬取某些页面的时候，服务器往往会需要cookie，而想要得到cookie 就需要先访问某个URL进行登录，服务器接收到请求之后验证用户名以及密码在登录成功的情况下会返回一个响应，这个响应的header中一般会有一个set-cookie的信息，它对应的值就是要设置的cookie信息。<br>虽然可以通过requests.utils.dict_from_cookiejar(r.cookies)提取到这个响应信息中设置的新cookie，但在下一个请求中再携带这个数据的过程较为麻烦。</p>
<ul>
<li>Session的作用<br>保存cookie，下一次请求会自动带上前一次的cookie<br>实现和服务端的长连接，加快请求速度</li>
<li>使用方法<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session对象在请求了一个网站后，对方服务器设置在本地的cookie会保存在session对象中，下一次再使用session对象请求对方服务器的时候，会自动带上前一次的cookie</span></span><br><span class="line"><span class="comment"># 1. 创建一个session实例对象</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"><span class="comment"># 2. 使用上一步创建的对象发起请求</span></span><br><span class="line">r = s.get(url1, headers)</span><br><span class="line">r = s.get(url2, headers)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"><span class="comment"># 发送第一个请求</span></span><br><span class="line">r = s.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第一次请求的请求头为:&quot;</span>, r.request.headers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;响应头：&quot;</span>, r.headers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;设置的cookie为:&quot;</span>, requests.utils.dict_from_cookiejar(r.cookies))</span><br><span class="line"><span class="comment"># 发送第二个请求（）</span></span><br><span class="line">r = s.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第二次请求的请求头为:&quot;</span>, r.request.headers)</span><br></pre></td></tr></table></figure>
<h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4>爬某个网站的时候，如果对方进行了封锁例如将我们电脑的公网ip封锁了，那么也就意味着只要是这个ip发送的所有请求这个网站都不会进行响应；此时我们就可以使用代理，绕过它的封锁从而实现继续爬取数据<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># http代理</span></span><br><span class="line">ip = <span class="string">&quot;125.88.82.26&quot;</span></span><br><span class="line">port = <span class="number">4777</span></span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://%s:%d&quot;</span> % (ip, port),</span><br><span class="line">    <span class="string">&quot;https&quot;</span>: <span class="string">&quot;http://%s:%d&quot;</span> % (ip, port)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求头</span></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># URL为通过百度搜索ip，响应内容中包括ip查询信息</span></span><br><span class="line">url = <span class="string">&quot;https://www.baidu.com/s?wd=nginx&quot;</span></span><br><span class="line"></span><br><span class="line">r = requests.get(url=url, headers=headers, proxies=proxies, timeout=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./百度查询nginx.html&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(r.text)</span><br></pre></td></tr></table></figure>
<h3 id="8-数据提取"><a href="#8-数据提取" class="headerlink" title="8.数据提取"></a>8.数据提取</h3>爬虫爬取的数据中有很多不同类型的数据</li>
<li>结构化数据：json，xml等，直接转化为python类型</li>
<li>非结构化数据：HTML，需要正则表达式、xpath、BS4<h4 id="结构数据提取-JSON"><a href="#结构数据提取-JSON" class="headerlink" title="结构数据提取-JSON"></a>结构数据提取-JSON</h4></li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/6.jpg" alt="json模块使用"></p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># json.dumps实现python类型转化为json字符串,indent实现换行和空格,ensure_ascii=False实现让中文写入的时候保持为中文</span></span><br><span class="line">json_str = json.dumps(mydict, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># json.loads实现json字符串转化为python的数据类型</span></span><br><span class="line">my_dict = json.loads(json_str)</span><br><span class="line">==============================================</span><br><span class="line"><span class="comment"># 解码,默认为utf-8</span></span><br><span class="line"><span class="comment"># son_str = r.text 浏览器自己header中定义的编码形式</span></span><br><span class="line">json_str = r.content.decode()</span><br><span class="line"><span class="comment"># 把json格式字符串转换成python对象</span></span><br><span class="line">json_dict = json.loads(json_str)</span><br><span class="line"><span class="built_in">print</span>(json_dict)</span><br><span class="line"><span class="comment"># 还可以使用json() print(r.json())</span></span><br></pre></td></tr></table></figure>
<h5 id="案例：FM排行榜信息"><a href="#案例：FM排行榜信息" class="headerlink" title="案例：FM排行榜信息"></a>案例：FM排行榜信息</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://webapi.qingting.fm/api/mobile/rank&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url=url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(r.status_code)</span><br><span class="line"><span class="built_in">print</span>(r.json())</span><br></pre></td></tr></table></figure>
<h4 id="非结构数据提取-正则表达式"><a href="#非结构数据提取-正则表达式" class="headerlink" title="非结构数据提取-正则表达式"></a>非结构数据提取-正则表达式</h4><p>正则表达式：<a target="_blank" rel="noopener" href="https://www.xczf.asia/2021/06/01/Shell/">https://www.xczf.asia/2021/06/01/Shell/</a></p>
<h5 id="re模块方法"><a href="#re模块方法" class="headerlink" title="re模块方法"></a>re模块方法</h5><ul>
<li>pattern.match（从头找一个）</li>
<li>pattern.search（找一个）</li>
<li>pattern.findall（找所有）</li>
<li>pattern.sub（替换）</li>
<li>re.compile（编译）<br><strong>中文的 unicode 编码范围 主要在 [u4e00-u9fa5]，这里说主要是因为这个范围并不完整，比如没有包括全角（中文）标点，不过，在大部分情况下，应该是够用的</strong><h5 id="爬取36kr首页新闻"><a href="#爬取36kr首页新闻" class="headerlink" title="爬取36kr首页新闻"></a>爬取36kr首页新闻</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://36kr.com&quot;</span></span><br><span class="line"><span class="comment"># 被反爬就headers里加入cookie</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 得到响应的内容</span></span><br><span class="line">html = r.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 通过正则表达式提取需要的数据</span></span><br><span class="line">item_list = re.findall(<span class="string">r&#x27;&lt;a class=&quot;item-info clearfloat&quot; href=&quot;([^&quot;]*).*?ellipsis-2&quot;&gt;(.*?)&lt;/span&gt;.*?&lt;/a&gt;&#x27;</span>, html)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;提取到的新闻个数:&quot;</span>, <span class="built_in">len</span>(item_list))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> temp <span class="keyword">in</span> item_list:</span><br><span class="line">    <span class="built_in">print</span>(url + temp[<span class="number">0</span>], temp[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<h4 id="XPath"><a href="#XPath" class="headerlink" title="XPath"></a>XPath</h4>Chrome浏览器插件： XPath Helper<br>官方文档：<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/xpath/index.asp">http://www.w3school.com.cn/xpath/index.asp</a><br>XPath (XML Path Language) XML路径语言，主要在xml文档中查找需要的信息，现在也适用于HTML文档的搜索<h5 id="XPath语法"><a href="#XPath语法" class="headerlink" title="XPath语法"></a>XPath语法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nodename<span class="comment"># 选中该元素</span></span><br><span class="line">/	    <span class="comment"># 从根节点选取、或者是元素和元素间的过渡</span></span><br><span class="line">//	    <span class="comment"># 从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置</span></span><br><span class="line">.	    <span class="comment"># 选取当前节点</span></span><br><span class="line">..	    <span class="comment"># 选取当前节点的父节点</span></span><br><span class="line"><span class="meta">@	    </span><span class="comment"># 选取属性</span></span><br><span class="line">*       <span class="comment"># 所有元素</span></span><br><span class="line">text()	<span class="comment"># 选取文本</span></span><br></pre></td></tr></table></figure></li>
<li>实例<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">bookstore	        <span class="comment"># 选择bookstore元素</span></span><br><span class="line">/bookstore	        <span class="comment"># 选取根元素bookstore</span></span><br><span class="line">bookstore/book	    <span class="comment"># 选取属于bookstore 的子元素的所有book元素</span></span><br><span class="line">//book	            <span class="comment"># 选取所有 book 子元素，而不管它们在文档中的位置</span></span><br><span class="line">bookstore//book	    <span class="comment"># 选择属于 bookstore 元素的后代的所有book元素</span></span><br><span class="line">//book/title/@lang	<span class="comment"># 选择所有的book下面的title中的lang属性的值</span></span><br><span class="line">//book/title/text()	<span class="comment"># 选择所有的book下面的title的文本</span></span><br><span class="line">//title[@lang=<span class="string">&quot;eng&quot;</span>]	<span class="comment"># 选择lang属性值为eng的所有title元素</span></span><br><span class="line">/bookstore/book[<span class="number">1</span>]	<span class="comment"># 选取属于 bookstore 子元素的第1个 book 元素</span></span><br><span class="line">/bookstore/book[last()]	<span class="comment"># 选取属于 bookstore 子元素的最后1个 book 元素</span></span><br><span class="line">/bookstore/book[last()-<span class="number">1</span>]	<span class="comment"># 选取属于 bookstore 子元素的倒数第2个 book 元素</span></span><br><span class="line">/bookstore/book[position()&gt;<span class="number">1</span>]	<span class="comment"># 选择bookstore下面的book元素，从第2个开始选择</span></span><br><span class="line">/bookstore/book[position()&gt;<span class="number">1</span>][postion()&lt;<span class="number">5</span>]	<span class="comment"># 选择bookstore下面的book元素，从第2个开始取到第4个元素</span></span><br><span class="line">//book/title[text()=<span class="string">&#x27;Harry Potter&#x27;</span>]	<span class="comment"># 选择所有book下的title元素，仅仅选择文本为Harry Potter的title元素</span></span><br></pre></td></tr></table></figure>
<h5 id="连习：爬取豆瓣电影top250"><a href="#连习：爬取豆瓣电影top250" class="headerlink" title="连习：爬取豆瓣电影top250"></a>连习：爬取豆瓣电影top250</h5>网址：<a target="_blank" rel="noopener" href="https://movie.douban.com/top250">https://movie.douban.com/top250</a></li>
<li>选择所有电影标题</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/7.jpg" alt="电影标题"></p>
<hr>
<ul>
<li>电影信息的href</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/8.jpg" alt="href"></p>
<hr>
<ul>
<li>电影的评分</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/9.jpg" alt="href"></p>
<hr>
<h4 id="非结构化数据：lxml模块使用XPath"><a href="#非结构化数据：lxml模块使用XPath" class="headerlink" title="非结构化数据：lxml模块使用XPath"></a>非结构化数据：lxml模块使用XPath</h4><h5 id="lxml模块安装"><a href="#lxml模块安装" class="headerlink" title="lxml模块安装"></a>lxml模块安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install lxml</span><br></pre></td></tr></table></figure>
<h5 id="lxml的使用"><a href="#lxml的使用" class="headerlink" title="lxml的使用"></a>lxml的使用</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">&#x27;&#x27;&#x27;...&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 利用etree.HTML，将字符串转化为Element对象, Element对象具有XPath的方法</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># 将Element对象，转化为字符串</span></span><br><span class="line">handled_html_str = etree.tostring(html).decode()</span><br></pre></td></tr></table></figure>
<h5 id="XPath语法提取数据"><a href="#XPath语法提取数据" class="headerlink" title="XPath语法提取数据"></a>XPath语法提取数据</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">href_list = html.xpath(<span class="string">&quot;//li[@class=&#x27;item-1&#x27;]/a/@href&quot;</span>)</span><br><span class="line">title_list = html.xpath(<span class="string">&quot;//li[@class=&#x27;item-1&#x27;]/a/text()&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="XPath分次提取"><a href="#XPath分次提取" class="headerlink" title="XPath分次提取"></a>XPath分次提取</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;&#x27;&#x27;...&#x27;&#x27;&#x27;</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">li_list = html.xpath(<span class="string">&quot;//li[@class=&#x27;item-1&#x27;]&quot;</span>)</span><br><span class="line"><span class="comment"># 在每一组中继续进行数据的提取</span></span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">    item = <span class="built_in">dict</span>()</span><br><span class="line">    item[<span class="string">&quot;href&quot;</span>] = li.xpath(<span class="string">&quot;./a/@href&quot;</span>)[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">len</span>(li.xpath(<span class="string">&quot;./a/@href&quot;</span>)) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    item[<span class="string">&quot;title&quot;</span>] = li.xpath(<span class="string">&quot;./a/text()&quot;</span>)[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">len</span>(li.xpath(<span class="string">&quot;./a/text()&quot;</span>)) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>
<h5 id="提取豆瓣电影评论"><a href="#提取豆瓣电影评论" class="headerlink" title="提取豆瓣电影评论"></a>提取豆瓣电影评论</h5><p>URL:<a target="_blank" rel="noopener" href="https://movie.douban.com/subject/35738375/comments">https://movie.douban.com/subject/35738375/comments</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">流程分析：</span></span><br><span class="line"><span class="string">1. 通过requests发送请求获取贴吧返回的内容</span></span><br><span class="line"><span class="string">2. 将返回的内容通过etree.HTML转换为Element对象</span></span><br><span class="line"><span class="string">3. 对Element对象使用XPath提取数据</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/subject/35738375/comments&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将返回的内容通过etree.HTML转换为Element对象</span></span><br><span class="line">html = etree.HTML(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 对Element对象使用XPath提取数据</span></span><br><span class="line">comment_list = html.xpath(<span class="string">&#x27;//span[@class=&quot;short&quot;]/text()&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;提取到的个数：&quot;</span>, <span class="built_in">len</span>(comment_list))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> comment <span class="keyword">in</span> comment_list:</span><br><span class="line">    <span class="built_in">print</span>(comment)</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<h4 id="jsonpath模块"><a href="#jsonpath模块" class="headerlink" title="jsonpath模块"></a>jsonpath模块</h4><p>JsonPath是一种可以快速解析json数据的方式<br>官网：<a target="_blank" rel="noopener" href="https://goessner.net/articles/JsonPath/">https://goessner.net/articles/JsonPath/</a></p>
<ul>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jsonpath</span><br></pre></td></tr></table></figure></li>
<li>常用语法</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/10.jpg" alt="语法"></p>
<hr>
<ul>
<li>案例</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/11.jpg" alt="案例"></p>
<hr>
<h4 id="非结构数据提取–BS4"><a href="#非结构数据提取–BS4" class="headerlink" title="非结构数据提取–BS4"></a>非结构数据提取–BS4</h4><p>BeautifulSoup4简称BS4 和 使用lxml模块 一样，Beautiful Soup 也是一个HTML&#x2F;XML的解析器，主要的功能也是如何解析和提取 HTML&#x2F;XML 数据<br>Beautiful Soup是基于HTML DOM的，会载入整个文档，解析整个DOM树，因此时间和内存开销都会大很多，所以性能要低于lxml模块</p>
<ul>
<li>官方文档：<a target="_blank" rel="noopener" href="http://beautifulsoup.readthedocs.io/zh_CN/v4.4.0">http://beautifulsoup.readthedocs.io/zh_CN/v4.4.0</a></li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install beautifulsoup4</span><br></pre></td></tr></table></figure></li>
<li>基本使用<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">&quot;&quot;&quot;...&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Beautiful Soup 对象</span></span><br><span class="line">soup = BeautifulSoup(html, features=<span class="string">&quot;lxml&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(soup.prettify())</span><br></pre></td></tr></table></figure>
<h5 id="find-all"><a href="#find-all" class="headerlink" title="find_all"></a>find_all</h5></li>
<li>name参数（可以搜索标签）</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/12.jpg" alt="name参数"></p>
<hr>
<ul>
<li>keyword 参数（可以搜索属性）</li>
<li>string参数（可以搜索内容）</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/13.jpg" alt="string参数"></p>
<hr>
<h5 id="select"><a href="#select" class="headerlink" title="select"></a>select</h5><p>方法是 soup.select()，返回类型是 list</p>
<ul>
<li>通过标签选择器查找<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;title&#x27;</span>))</span><br></pre></td></tr></table></figure></li>
<li>通过类选择器查找<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;.sister&#x27;</span>))</span><br></pre></td></tr></table></figure></li>
<li>通过 id 选择器查找 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;#link1&#x27;</span>))</span><br></pre></td></tr></table></figure></li>
<li>层级选择器查找<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;p #link1&#x27;</span>))</span><br></pre></td></tr></table></figure></li>
<li>通过属性选择器查找<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;a[class=&quot;sister&quot;]&#x27;</span>))</span><br></pre></td></tr></table></figure></li>
<li>获取文本内容get_text()<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;title&#x27;</span>)[<span class="number">0</span>].get_text())</span><br></pre></td></tr></table></figure></li>
<li>获取属性 get(‘属性的名字’)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(soup.select(<span class="string">&#x27;title&#x27;</span>)[<span class="number">0</span>].get(<span class="string">&#x27;href&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h5 id="爬取新闻标题"><a href="#爬取新闻标题" class="headerlink" title="爬取新闻标题"></a>爬取新闻标题</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 通过requests发送请求，得到搜狗微信页面内容</span></span><br><span class="line">url = <span class="string">&quot;https://weixin.sogou.com/&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(url=url, headers=headers)</span><br><span class="line">r.encoding = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line"><span class="comment"># 2. 通过BeautifulSoup调用select获取指定的标签</span></span><br><span class="line">soup = BeautifulSoup(r.text, features=<span class="string">&quot;lxml&quot;</span>)</span><br><span class="line">tag = soup.select(<span class="string">&#x27;ul[class=&quot;news-list&quot;]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = tag[<span class="number">0</span>].select(<span class="string">&quot;h3&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> temp_tag <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    <span class="built_in">print</span>(temp_tag.select(<span class="string">&quot;a&quot;</span>)[<span class="number">0</span>].get_text(), temp_tag.select(<span class="string">&quot;a&quot;</span>)[<span class="number">0</span>].get(<span class="string">&quot;href&quot;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h4>逗号分隔值（Comma-Separated Values，CSV，有时也称为字符分隔值，因为分隔字符也可以不是逗号），其文件以纯文本形式存储表格数据（数字和文本）。纯文本意味着该文件是一个字符序列，不含必须像二进制数字那样被解读的数据。CSV文件由任意数目的记录组成，记录间以某种换行符分隔；每条记录由字段组成，字段间的分隔符是其它字符或字符串，最常见的是逗号或制表符。<h5 id="Python对CSV文件操作"><a href="#Python对CSV文件操作" class="headerlink" title="Python对CSV文件操作"></a>Python对CSV文件操作</h5></li>
<li>写入数据到CSV文件<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">headers = [<span class="string">&#x27;班级&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;性别&#x27;</span>, <span class="string">&#x27;手机号&#x27;</span>, <span class="string">&#x27;QQ&#x27;</span>]</span><br><span class="line">rows = [</span><br><span class="line">    [<span class="string">&quot;18级Python&quot;</span>, <span class="string">&#x27;小z&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;13146060xx1&#x27;</span>, <span class="string">&#x27;123456xx1&#x27;</span>],</span><br><span class="line">    [<span class="string">&quot;18级Python&quot;</span>, <span class="string">&#x27;小q&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;13146060xx2&#x27;</span>, <span class="string">&#x27;123456xx2&#x27;</span>],</span><br><span class="line">    [<span class="string">&quot;19级Python&quot;</span>, <span class="string">&#x27;小s&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;13146060xx3&#x27;</span>, <span class="string">&#x27;123456xx3&#x27;</span>],</span><br><span class="line">    [<span class="string">&quot;19级Python&quot;</span>, <span class="string">&#x27;小l&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;13146060xx4&#x27;</span>, <span class="string">&#x27;123456xx4&#x27;</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.writer(f)</span><br><span class="line">    <span class="comment"># 写入一行（我们用第一行当做表头）</span></span><br><span class="line">    f_csv.writerow(headers)</span><br><span class="line">    <span class="comment"># 写入多行行（当做数据）</span></span><br><span class="line">    f_csv.writerows(rows)</span><br></pre></td></tr></table></figure></li>
<li>写入字典数据到CSV<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">headers = [<span class="string">&#x27;班级&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;性别&#x27;</span>, <span class="string">&#x27;手机号&#x27;</span>, <span class="string">&#x27;QQ&#x27;</span>]</span><br><span class="line">rows = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;class_name&quot;</span>: <span class="string">&quot;18Python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;gender&quot;</span>: <span class="string">&#x27;男&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>: <span class="string">&#x27;13146060xx1&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;qq&quot;</span>: <span class="string">&#x27;123456xx1&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;class_name&quot;</span>: <span class="string">&quot;18Python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;gender&quot;</span>: <span class="string">&#x27;男&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>: <span class="string">&#x27;13146060xx2&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;qq&quot;</span>: <span class="string">&#x27;123456xx2&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;class_name&quot;</span>: <span class="string">&quot;19Python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&#x27;小赵&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;gender&quot;</span>: <span class="string">&#x27;女&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>: <span class="string">&#x27;13146060xx3&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;qq&quot;</span>: <span class="string">&#x27;123456xx3&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;class_name&quot;</span>: <span class="string">&quot;19Python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;gender&quot;</span>: <span class="string">&#x27;女&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>: <span class="string">&#x27;13146060xx4&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;qq&quot;</span>: <span class="string">&#x27;123456xx4&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test2.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.DictWriter(f, [<span class="string">&#x27;class_name&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;qq&#x27;</span>])</span><br><span class="line">    <span class="comment"># 写入一行（我们用第一行当做表头）</span></span><br><span class="line">    f_csv.writeheader()</span><br><span class="line">    <span class="comment"># 写入多行行（当做数据）</span></span><br><span class="line">    f_csv.writerows(rows)</span><br></pre></td></tr></table></figure></li>
<li>读取CSV文件<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(row), row)</span><br></pre></td></tr></table></figure></li>
<li>读取CSV文件封装为字典<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test2.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.DictReader(f)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="built_in">print</span>(row.get(<span class="string">&quot;class_name&quot;</span>), row.get(<span class="string">&quot;name&quot;</span>), row.get(<span class="string">&quot;gender&quot;</span>), row.get(<span class="string">&quot;phone&quot;</span>), row.get(<span class="string">&quot;qq&quot;</span>), )</span><br></pre></td></tr></table></figure>
<h2 id="二-MongoDB"><a href="#二-MongoDB" class="headerlink" title="二.MongoDB"></a>二.MongoDB</h2><h3 id="1-安装和基础使用"><a href="#1-安装和基础使用" class="headerlink" title="1.安装和基础使用"></a>1.安装和基础使用</h3><a target="_blank" rel="noopener" href="https://www.xczf.asia/2022/07/01/MongoDB/">https://www.xczf.asia/2022/07/01/MongoDB/</a><h3 id="2-MongoDB和Python交互"><a href="#2-MongoDB和Python交互" class="headerlink" title="2.MongoDB和Python交互"></a>2.MongoDB和Python交互</h3></li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymongo</span><br></pre></td></tr></table></figure>
<h4 id="使用pymongo"><a href="#使用pymongo" class="headerlink" title="使用pymongo"></a>使用pymongo</h4></li>
<li>导入pymongo并选择要操作的集合<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line">client = MongoClient(host, port)</span><br><span class="line">collection = client[db名][集合名]</span><br></pre></td></tr></table></figure></li>
<li>添加数据<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 插入一条数据</span></span><br><span class="line">collection.insert(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test10&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">34</span>&#125;)</span><br><span class="line"><span class="comment"># 插入多条数据</span></span><br><span class="line">collection.insert([&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test10&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">34</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test11&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">35</span>&#125;])</span><br><span class="line"><span class="comment"># 插入一条数据</span></span><br><span class="line">ret = collection.insert_one(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test10&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">33</span>&#125;)</span><br><span class="line"><span class="comment"># # 插入多条数据</span></span><br><span class="line">item_list = [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test1000%d&quot;</span> % i&#125; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"><span class="comment"># insert_many接收一个列表，列表中为所有需要插入的字典</span></span><br><span class="line">t = collection.insert_many(item_list)</span><br></pre></td></tr></table></figure></li>
<li>查找数据<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># find_one查找并且返回一个结果,接收一个字典形式的条件</span><br><span class="line">t = collection.find_one(&#123;&quot;name&quot;: &quot;test05&quot;&#125;)</span><br><span class="line">print(type(t),t)</span><br><span class="line"># 根据查询条件返回所有满足条件的结果</span><br><span class="line"># find返回所有满足条件的结果，如果条件为空，则返回数据库的所有</span><br><span class="line">t = collection.find()</span><br><span class="line"># 结果是一个Cursor游标对象，是一个可迭代对象，可以类似读文件的指针，</span><br><span class="line">for i in t:</span><br><span class="line">    print(i)</span><br><span class="line">print(&quot;-&quot; * 30)</span><br><span class="line">for i in t:  # 此时t中没有内容</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure></li>
<li>更新数据<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># update_one更新一条数据</span></span><br><span class="line">collection.update_one(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test05&quot;</span>&#125;, &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;new_test05&quot;</span>&#125;&#125;)</span><br><span class="line"><span class="comment"># update_one更新全部数据</span></span><br><span class="line">collection.update_many(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test05&quot;</span>&#125;, &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;new_test05&quot;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
<li>删除数据<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># delete_one删除一条数据</span></span><br><span class="line">collection.delete_one(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test10&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># delete_may删除所有满足条件的数据</span></span><br><span class="line">collection.delete_many(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test10&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="练习：插入文档"><a href="#练习：插入文档" class="headerlink" title="练习：插入文档"></a>练习：插入文档</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用Python操作MongoDB向集合t3中插入1000个文档</span><br><span class="line">文档的属性包括 _id、name</span><br><span class="line">_id的值为0、1、2、3、. . 999</span><br><span class="line">name的值为py0、py1 . . . </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MGINfo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        client = MongoClient(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>)</span><br><span class="line">        self.collection = client[<span class="string">&quot;test&quot;</span>][<span class="string">&quot;t3&quot;</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self</span>):</span><br><span class="line">        info_list = [&#123;<span class="string">&quot;_id&quot;</span>: x, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;py%s&quot;</span> % x&#125; <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>)]</span><br><span class="line">        <span class="comment"># 插入数据</span></span><br><span class="line">        ret = self.collection.insert_many(info_list)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_100</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 查询_id为100的整数倍的文档</span></span><br><span class="line">        ret = self.collection.find(&#123;<span class="string">&quot;$where&quot;</span>: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            function() &#123;</span></span><br><span class="line"><span class="string">                return this._id &gt; 0 &amp;&amp; this._id % 100 == 0;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>&#125;)</span><br><span class="line">        <span class="built_in">print</span>(ret)</span><br><span class="line">        <span class="built_in">print</span>(ret.count())</span><br><span class="line">        <span class="keyword">for</span> temp <span class="keyword">in</span> ret:</span><br><span class="line">            <span class="built_in">print</span>(temp)</span><br><span class="line"><span class="comment"># 创建对象</span></span><br><span class="line">mongo_info = MGINfo()</span><br><span class="line"><span class="comment"># 查询数据</span></span><br><span class="line">mongo_info.find_100()</span><br></pre></td></tr></table></figure>
<h2 id="三-异步"><a href="#三-异步" class="headerlink" title="三.异步"></a>三.异步</h2>Python3.4版本引入asyncio是到标准库<br>Python3.5又加入了async&#x2F;await特性<br>Python由于<strong>GIL（全局解释器锁）的存在，不能发挥多线程多核的优势</strong>。然而在IO密集型的网络编程里，异步处理比同步处理能提升成百上千倍的效率，弥补了python性能方面的短板<h3 id="1-GIL（全局解释器锁）"><a href="#1-GIL（全局解释器锁）" class="headerlink" title="1.GIL（全局解释器锁）"></a>1.GIL（全局解释器锁）</h3>全局解释器锁（Global Interpreter Lock，GIL）规定<strong>全局范围内任意时候一个进程里只能同时执行一个线程</strong>。每一个线程在执行时，都会锁住GIL，以阻止别的线程执行；执行一段时间后，会释放GIL，以允许别的线程开始利用资源，如果遇到阻塞情况，也会提前释放锁。<br>程序是单线程，该GIL锁并不会对程序造成什么影响。但如果在计算密集型的多线程代码中，GIL就是一个性能瓶颈，使<strong>Python多线程成为伪并行多线程</strong>。</li>
<li>优点<br>线程是非独立的，所以同一进程里线程是数据共享，当各个线程访问数据资源时会出现“竞争”状态，即数据可能会同时被多个线程占用，造成数据混乱，这就是线程的不安全。所以引进了互斥锁，确保某段关键代码、共享数据只能由一个线程从头到尾完整地执行。</li>
<li>缺点<br>单个进程下，开启多个线程，无法实现并行，只能实现并发，牺牲执行效率。<br>由于GIL锁的限制，所以多线程不适合计算密集型任务，更适合IO密集型任务<br>常见IO密集型任务：网络IO（抓取网页数据）、磁盘操作（读写文件）、键盘输入<h4 id="GIL解决限制"><a href="#GIL解决限制" class="headerlink" title="GIL解决限制"></a>GIL解决限制</h4></li>
<li>多进程编程<br>使用多个进程而不是线程。每个 Python 进程都有自己的 Python 解释器和内存空间。Python 有一个多进程multiprocessing 模块</li>
<li>cython函数<br>cython通常用于处理计算密集型的任务，以加快python程序总体运行速度，在cython函数中，可以指定一部分代码避免GIL, 另一部分使用GIL</li>
<li>替代Python解释器<br>Python有多个解释器实现。CPython，Jython，IronPython和PyPy，分别用C，Java，C#和Python编写，是最受欢迎的。GIL 只存在于 CPython 的原始 Python 实现中。如果您的程序及其库可用于其他实现之一<h3 id="2-异步、同步"><a href="#2-异步、同步" class="headerlink" title="2.异步、同步"></a>2.异步、同步</h3></li>
<li>同步<br>是指完成事务的逻辑，先执行第一个事务，如果阻塞了，会一直等待，直到这个事务完成，再执行第二个事务，顺序执行。。。</li>
<li>异步<br>是和同步相对的，异步是指在处理调用这个事务的之后，不会等待这个事务的处理结果，直接处理第二个事务去了，通过状态、通知、回调来通知调用者处理结果。<br><strong>异步只适用于 I&#x2F;O 操作相关的代码，不适用于非 I&#x2F;O操作</strong><h3 id="3-asyncio-Python-3-7-或更高版本"><a href="#3-asyncio-Python-3-7-或更高版本" class="headerlink" title="3.asyncio Python 3.7 或更高版本"></a>3.asyncio Python 3.7 或更高版本</h3>官方文档：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#">https://docs.python.org/zh-cn/3/library/asyncio-task.html#</a><br>asyncio 是”多任务合作”模式（cooperative multitasking），允许异步任务交出执行权给其他任务，等到其他任务完成，再收回执行权继续往下执行。由于代码的执行权在多个任务之间交换，所以看上去好像多个任务同时运行，其实底层只有一个线程，多个任务分享运行时间。<br>asyncio 模块在单线程上启动一个事件循环（event loop），时刻监听新进入循环的事件，加以处理，并不断重复这个过程，直到异步任务结束。</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/14.jpg" alt="asyncio"></p>
<hr>
<h4 id="同步与异步的不同"><a href="#同步与异步的不同" class="headerlink" title="同步与异步的不同"></a>同步与异步的不同</h4><ul>
<li>同步 间隔约是3s<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        hello()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Time:%s&#x27;</span> % time.time())</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br><span class="line"><span class="comment"># Time:1700985223.8032222</span></span><br><span class="line"><span class="comment"># Time:1700985224.8173962</span></span><br><span class="line"><span class="comment"># Time:1700985225.8218596</span></span><br></pre></td></tr></table></figure></li>
<li>异步 间隔约是1s<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Time:%s&#x27;</span> % time.time())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        loop.run_until_complete(hello())</span><br><span class="line">        </span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br><span class="line"><span class="comment"># Time:1700985297.4709234</span></span><br><span class="line"><span class="comment"># Time:1700985297.4709234</span></span><br><span class="line"><span class="comment"># Time:1700985297.4709234</span></span><br></pre></td></tr></table></figure>
<h4 id="定义异步方法"><a href="#定义异步方法" class="headerlink" title="定义异步方法"></a>定义异步方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;这是一个异步函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我是test&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="启动协程"><a href="#启动协程" class="headerlink" title="启动协程"></a>启动协程</h4><h5 id="asyncio-run（Python3-7新）"><a href="#asyncio-run（Python3-7新）" class="headerlink" title="asyncio.run（Python3.7新）"></a>asyncio.run（Python3.7新）</h5>通过asyncio.run可以调用异步函数<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test4</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;这是一个异步函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我是test4&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"><span class="comment"># 调用异步函数</span></span><br><span class="line"><span class="built_in">print</span>(asyncio.run(test4()))</span><br></pre></td></tr></table></figure>
<h5 id="事件循环（Python3-6）"><a href="#事件循环（Python3-6）" class="headerlink" title="事件循环（Python3.6）"></a>事件循环（Python3.6）</h5>run_until_complete可以获取协程的返回值，如果没有给定返回值，则像函数一样，默认返回None<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test1</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;这是一个异步函数(可以认为就是一个协程)&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;我是test1&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 创建一个事件循环</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    <span class="comment"># 创建协程（此时test1这个协程中的任务代码并没有真正的开始执行）</span></span><br><span class="line">    t1 = test1()</span><br><span class="line">    <span class="comment"># 进入事件循环</span></span><br><span class="line">    <span class="built_in">print</span>(loop.run_until_complete(t1))</span><br><span class="line">    <span class="comment"># 关闭事件循环</span></span><br><span class="line">    loop.close()</span><br></pre></td></tr></table></figure>
<h4 id="并发执行任务"><a href="#并发执行任务" class="headerlink" title="并发执行任务"></a>并发执行任务</h4>并发执行任务，使用asyncio.gather,创建多个协程，当某个协程出现了IO（就是耗时操作），就或asyncio自动切换到其他的协程中执行，从而实现并<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test1</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;---test1---1&#x27;</span>)</span><br><span class="line">        <span class="comment"># await表示调用协程，sleep 0并不会真的sleep（因为时间为0），却可以把控制权交出去了。</span></span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;---test1---2&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test2</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;---test2---1&#x27;</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;---test2---2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;test1与test2交替运行，此时就实现了并发）&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># asyncio.gather用来并发运行任务，在这里表示协同的执行test1和test2个协程</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(test1(), test2())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h4 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h4>Task可以包装协程，可以跟踪协程何时完成。Task是Future（这个类较为底层，我们直接用它的子类Task即可）的子类，每个Task都有一个结果，在它完成之后可以获取这个结果。<br>因为<strong>协程是没有状态</strong>，我们通过使用create_task方法可以将协程包装成有状态的任务。还可以在任务运行的过程中取消任务<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test1-开始时间：&quot;</span>, time.time())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;----我是test1----&quot;</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test1-结束时间：&quot;</span>, time.time())</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test2-开始时间：&quot;</span>, time.time())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;----我是test2----&quot;</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test2-结束时间：&quot;</span>, time.time())</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	<span class="comment"># 任务运行的过程中取消任务</span></span><br><span class="line">    task1 = asyncio.create_task(test1())</span><br><span class="line">    task2 = asyncio.create_task(test2())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;task1结束了吗? &quot;</span>, task1.done())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;task2结束了吗? &quot;</span>, task2.done())</span><br><span class="line">    tasks = [task1, task2]</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;task1结束了吗? &quot;</span>, task1.done())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;task2结束了吗? &quot;</span>, task2.done())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    asyncio.run(main())</span><br><span class="line">    stop_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;总耗时：&quot;</span>, stop_time - start_time)</span><br></pre></td></tr></table></figure>
<h5 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h5>当特定的事件或条件发生的时候，调用者使用函数返回值作为调用回调函数对事件进行处理<br>Python高阶函数：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/littlefivebolg/articles/9094942.html">https://www.cnblogs.com/littlefivebolg/articles/9094942.html</a><br>partial函数：把一个函数的某些参数给固定住，返回一个新的函数。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">callback_after_done</span>(<span class="params">task_obj, num1, num2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    这个函数会在当test任务完成后被自动调用</span></span><br><span class="line"><span class="string">    会自动将完成后的Task对象当做参数进行传递</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---callback_after_done-1-&quot;</span>, task_obj)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---callback_after_done-2-&quot;</span>, task_obj.done())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---callback_after_done-3-&quot;</span>, num1, num2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----test----&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    task = asyncio.create_task(test())</span><br><span class="line">    task.add_done_callback(functools.partial(callback_after_done, num1=<span class="number">100</span>, num2=<span class="number">200</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果有多个任务，可以用下面的方式</span></span><br><span class="line">    <span class="comment"># tasks = [task]</span></span><br><span class="line">    <span class="comment"># await asyncio.wait(tasks)</span></span><br><span class="line">    <span class="comment"># 如果只有1个任务，就可以直接用下面的方式</span></span><br><span class="line">    <span class="keyword">await</span> task</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test1执行完毕了吗? &quot;</span>, task.done())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test1的返回值是:&quot;</span>, task.result())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h3 id="4-aiohttp"><a href="#4-aiohttp" class="headerlink" title="4.aiohttp"></a>4.aiohttp</h3>aiohttp是一个异步的网络库，可以实现HTTP客户端，也可以实现HTTP服务器<br><strong>requests是同步的库，如果想异步的话需要引入aiohttp</strong><br>官方文档：<a target="_blank" rel="noopener" href="https://docs.aiohttp.org/en/stable/client.html#aiohttp-client">https://docs.aiohttp.org/en/stable/client.html#aiohttp-client</a></li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install aiohttp</span><br></pre></td></tr></table></figure></li>
<li>使用<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">from aiohttp import ClientSession</span><br><span class="line"></span><br><span class="line">tasks = []</span><br><span class="line">url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line"></span><br><span class="line">async def get_baidu(url):</span><br><span class="line">    async with ClientSession() as session:</span><br><span class="line">        async with session.get(url) as response:</span><br><span class="line">            response = await response.text()</span><br><span class="line">            <span class="built_in">print</span>(response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(get_baidu(url))</span><br></pre></td></tr></table></figure>
<h4 id="并发案例"><a href="#并发案例" class="headerlink" title="并发案例"></a>并发案例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">import aiohttp</span><br><span class="line"></span><br><span class="line">def download_completed_callback(task_obj):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;下载的HTML为:&quot;</span>, task_obj.result())</span><br><span class="line"></span><br><span class="line">async def baidu_spider():</span><br><span class="line">    url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">    async with aiohttp.ClientSession() as session:</span><br><span class="line">        async with session.get(url) as r:</span><br><span class="line">            <span class="built_in">return</span> await r.text()</span><br><span class="line"></span><br><span class="line">async def sogou_spider():</span><br><span class="line">    url = <span class="string">&quot;https://www.sogou.com&quot;</span></span><br><span class="line">    async with aiohttp.ClientSession() as session:</span><br><span class="line">        async with session.get(url) as r:</span><br><span class="line">            <span class="built_in">return</span> await r.text()</span><br><span class="line"></span><br><span class="line">async def jingdong_spider():</span><br><span class="line">    url = <span class="string">&quot;https://www.jd.com&quot;</span></span><br><span class="line">    async with aiohttp.ClientSession() as session:</span><br><span class="line">        async with session.get(url) as r:</span><br><span class="line">            <span class="built_in">return</span> await r.text()</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    <span class="comment"># 创建多个Task，且添加回调函数</span></span><br><span class="line">    task_baidu = asyncio.create_task(baidu_spider())</span><br><span class="line">    task_baidu.add_done_callback(download_completed_callback)</span><br><span class="line">    task_sogou = asyncio.create_task(sogou_spider())</span><br><span class="line">    task_sogou.add_done_callback(download_completed_callback)</span><br><span class="line">    task_jingdong = asyncio.create_task(jingdong_spider())</span><br><span class="line">    task_jingdong.add_done_callback(download_completed_callback)</span><br><span class="line">    tasks = [task_baidu, task_sogou, task_jingdong]</span><br><span class="line">    <span class="comment"># 等待下载</span></span><br><span class="line">    await asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h2 id="五-反爬"><a href="#五-反爬" class="headerlink" title="五.反爬"></a>五.反爬</h2><h4 id="网站如何识别爬虫"><a href="#网站如何识别爬虫" class="headerlink" title="网站如何识别爬虫"></a>网站如何识别爬虫</h4></li>
<li>通过请求信息识别<ul>
<li>Headers<ul>
<li>UA</li>
<li>Referer</li>
</ul>
</li>
<li>Cookie<ul>
<li>登录</li>
<li>验证码</li>
</ul>
</li>
<li>特定请求参数token，sign等加密参数</li>
</ul>
</li>
<li>基于用户行为识别<ul>
<li>单位时间客户端的请求频率<ul>
<li>IP</li>
<li>UA</li>
<li>Cookie</li>
</ul>
</li>
<li>鼠标键盘的使用轨迹</li>
</ul>
</li>
<li>频繁更换反爬措施<h3 id="1-Selenium"><a href="#1-Selenium" class="headerlink" title="1.Selenium"></a>1.Selenium</h3>中文网址：<a target="_blank" rel="noopener" href="http://www.selenium.org.cn/">http://www.selenium.org.cn/</a><br>网址：<a target="_blank" rel="noopener" href="https://selenium-python.readthedocs.io/">https://selenium-python.readthedocs.io/</a><br>很多网站页面的数据是由JavaScript生成的，而不是原始HTML代码，而且还有很多ajax获取的数据，甚至有些数据是加密的，导致，当我们使用普通的requests来处理时，需要分析很多的js代码，此时非常困难，所以我们就用Selenium来解决<h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4></li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium</span><br></pre></td></tr></table></figure></li>
<li>驱动<br>ChromeDriver：<a target="_blank" rel="noopener" href="http://npm.taobao.org/mirrors/chromedriver/">http://npm.taobao.org/mirrors/chromedriver/</a><br>GeckoDriver：<a target="_blank" rel="noopener" href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a><br>PhantomJS（基于Webkit的“无界面”(headless)浏览器，很多服务器都对这个无界面的浏览器进行了屏蔽）：<a target="_blank" rel="noopener" href="http://phantomjs.org/download.html">http://phantomjs.org/download.html</a><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4></li>
<li>加载网页<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="comment"># 获取要操作的浏览器驱动对象（直白点说，这个对象可以控制浏览器）</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment"># 加载指定的页面</span></span><br><span class="line">browser.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line"><span class="comment"># 截屏</span></span><br><span class="line">browser.save_screenshot(<span class="string">&quot;百度首页.png&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li>定位和操作<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line"><span class="comment"># 获取指定的元素</span></span><br><span class="line">browser.find_element_by_id(<span class="string">&quot;kw&quot;</span>).send_keys(<span class="string">&quot;长城&quot;</span>)</span><br><span class="line"><span class="comment"># 延时，以便看清楚要进行的操作</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 点击 &quot;百度一下&quot;</span></span><br><span class="line">browser.find_element_by_id(<span class="string">&quot;su&quot;</span>).click()</span><br></pre></td></tr></table></figure></li>
<li>请求信息<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line"><span class="comment"># 查看访问的页面的源代码</span></span><br><span class="line"><span class="built_in">print</span>(browser.page_source)</span><br><span class="line"><span class="comment"># 查看cookie</span></span><br><span class="line"><span class="built_in">print</span>(browser.get_cookies())</span><br><span class="line"><span class="comment"># 查看经过处理之后，本页面最后显示的url，如果有302的话，那么就是302之后的url</span></span><br><span class="line"><span class="built_in">print</span>(browser.current_url)</span><br></pre></td></tr></table></figure></li>
<li>打开新页面<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.get(<span class="string">&quot;https://jd.com&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></li>
<li>打开新标签页<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;http://login.taobao.com&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 打开搜狗</span></span><br><span class="line">js = <span class="string">&quot;window.open(&#x27;http://www.sogou.com&#x27;)&quot;</span></span><br><span class="line">browser.execute_script(js)</span><br></pre></td></tr></table></figure></li>
<li>切换标签页<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;http://login.taobao.com&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">js = <span class="string">&quot;window.open(&#x27;http://www.sogou.com&#x27;)&quot;</span></span><br><span class="line">browser.execute_script(js)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 切换到第1个标签页</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">0</span>])</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">1</span>])</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 关闭第2个标签页</span></span><br><span class="line">browser.close()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 切换到第1个标签页</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># 关闭第1个标签页</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></li>
<li>退出<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭当前页面（当浏览器只有1个页面时，此操作会让浏览器退出）</span></span><br><span class="line">browser.close()</span><br><span class="line"><span class="comment"># 让浏览器退出(如果用selenium打开了很多的)</span></span><br><span class="line">browser.quit()</span><br></pre></td></tr></table></figure>
<h4 id="元素定位"><a href="#元素定位" class="headerlink" title="元素定位"></a>元素定位</h4></li>
<li>单个节点（返回是一个对象）<br>find_element_by_id<br>find_element_by_name<br>find_element_by_xpath<br>find_element_by_link_text<br>find_element_by_partial_link_text<br>find_element_by_tag_name<br>find_element_by_class_name<br>find_element_by_css_selector</li>
<li>多个节点（返回是一个列表）<br>find_elements_by_id<br>find_elements_by_name<br>find_elements_by_xpath<br>find_elements_by_link_text<br>find_elements_by_partial_link_text<br>find_elements_by_tag_name<br>find_elements_by_class_name<br>find_elements_by_css_selector<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取单节点</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&#x27;http://news.baidu.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定位搜索框</span></span><br><span class="line">ret = browser.find_element_by_id(<span class="string">&#x27;ww&#x27;</span>)</span><br><span class="line"><span class="comment"># ret = browser.find_element_by_css_selector(&#x27;#ww&#x27;)  # 查询id为ww</span></span><br><span class="line"><span class="comment"># ret = browser.find_element_by_css_selector(&#x27;.word&#x27;)  # 查询class为word</span></span><br><span class="line"><span class="comment"># ret = browser.find_element_by_xpath(&quot;//input[@class=&#x27;word&#x27;]&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(ret)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.quit()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取多节点</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>)</span><br><span class="line"><span class="comment"># 定位25个电影信息</span></span><br><span class="line">ret = browser.find_elements_by_css_selector(<span class="string">&#x27;.item&#x27;</span>)  <span class="comment"># 查询class为item</span></span><br><span class="line"><span class="built_in">print</span>(ret)</span><br><span class="line">ret = browser.find_elements_by_xpath(<span class="string">&quot;//*[@class=&#x27;item&#x27;]&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(ret)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.quit()</span><br></pre></td></tr></table></figure>
<h4 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h4></li>
<li>提取标签内容、属性值<br>获取文本：element.text<br>获取属性值：element.get_attribute(“href”)</li>
<li>处理cookie<br>browser.get_cookies()能够获取所有的cookie<br>删除一条cookie：browser.delete_cookie(“CookieName”)<br>删除所有的cookie：browser.delete_all_cookies()<br>添加cookie：browser.add_cookie()<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">cookie_list = browser.get_cookies()</span><br><span class="line"><span class="built_in">print</span>(cookie_list)</span><br><span class="line"><span class="comment"># 整理为requests等需要的字典方式，因为浏览器在发送新请求时 携带的cookie只有name、value</span></span><br><span class="line"><span class="comment"># 所以此时提取的也只有name、value，其他的不需要</span></span><br><span class="line">cookie_dict = &#123;x[<span class="string">&quot;name&quot;</span>]: x[<span class="string">&quot;value&quot;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> cookie_list&#125;</span><br><span class="line"><span class="built_in">print</span>(cookie_dict)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></li>
<li>页面前进和后退<br>后退：browser.back()<br>前进：browser.forward()<h3 id="2-字体反爬"><a href="#2-字体反爬" class="headerlink" title="2.字体反爬"></a>2.字体反爬</h3>通过在网站中使用特殊字体来替换文本内容，使得爬虫无法正确解析其中的内容。字体反爬的原理是<strong>将网站中的文本内容转换为特殊的字体格式，然后通过CSS样式来控制字体的显示方式</strong>	<h4 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h4>Base64是网络上最常见的用于传输8Bit字节码的编码方式之一，Base64就是一种基于64个可打印字符来表示二进制数据的方法<br>在线编码解码：<a target="_blank" rel="noopener" href="https://base64.us/">https://base64.us/</a><h4 id="字体反爬过程"><a href="#字体反爬过程" class="headerlink" title="字体反爬过程"></a>字体反爬过程</h4>URL：<a target="_blank" rel="noopener" href="https://sz.58.com/chuzu/">https://sz.58.com/chuzu/</a></li>
<li>1.查看字体样式</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/15.jpg" alt="字体样式"></p>
<hr>
<ul>
<li>2.style标签中数据</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/16.jpg" alt="Base64"></p>
<hr>
<ul>
<li><ol start="3">
<li>将base64编码文件导出为ttf文件<br>百度字体编辑器：<a target="_blank" rel="noopener" href="http://fontstore.baidu.com/static/editor/#">http://fontstore.baidu.com/static/editor/#</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">base64</span></span><br><span class="line"></span><br><span class="line">ret = base64.b64decode(<span class="string">&quot;xxxxxxxxxxx&quot;</span>)</span><br><span class="line">with open(<span class="string">&quot;字体.ttf&quot;</span>, <span class="string">&quot;wb&quot;</span>) as f:</span><br><span class="line">    f.write(ret)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>4.将ttf转换为xml文件<br>安装fontTools模块<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install fontTools</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fontTools.ttLib <span class="keyword">import</span> TTFont</span><br><span class="line"></span><br><span class="line">font = TTFont(<span class="string">&quot;./字体.ttf&quot;</span>)</span><br><span class="line">font.saveXML(<span class="string">&quot;字体.xml&quot;</span>)</span><br></pre></td></tr></table></figure>
<strong>xml文件中cmap对应的数据提取出来，然后将数值-1，即可得到真正的数字</strong></li>
<li>5.解析出数字对应关系表<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> fontTools.ttLib <span class="keyword">import</span> TTFont</span><br><span class="line"></span><br><span class="line">font = TTFont(<span class="string">&quot;./字体.ttf&quot;</span>)</span><br><span class="line">cmap = font.get(<span class="string">&quot;cmap&quot;</span>).getBestCmap()</span><br><span class="line"></span><br><span class="line">ttf_dict = <span class="built_in">dict</span>()</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> cmap.items():</span><br><span class="line">    new_dict_k = <span class="built_in">hex</span>(k)</span><br><span class="line">    new_dict_v = <span class="built_in">int</span>(re.search(<span class="string">r&quot;\d+&quot;</span>, v).group(<span class="number">0</span>))</span><br><span class="line">    ttf_dict[new_dict_k] = new_dict_v</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;解析后：&quot;</span>, ttf_dict)</span><br></pre></td></tr></table></figure>
<h4 id="案例：实习僧"><a href="#案例：实习僧" class="headerlink" title="案例：实习僧"></a>案例：实习僧</h4>URL：<a target="_blank" rel="noopener" href="https://www.shixiseng.com/interns?keyword=java&amp;page=1&amp;city=%E5%85%A8%E5%9B%BD&amp;type=intern">https://www.shixiseng.com/interns?keyword=java&amp;page=1&amp;city=%E5%85%A8%E5%9B%BD&amp;type=intern</a></li>
<li>获取文件</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/17.jpg" alt="字体样式"></p>
<hr>
<p>复制上述的地址，在浏览器中打开，此时会下载一个文件名字叫做file<br>编辑工具：FontCreator <a target="_blank" rel="noopener" href="http://www.downza.cn/hudsnjkl/257455?module=soft&amp;id=257455&amp;token=dae25a7ec6e3d448176efd7c33b481ae&amp;isxzq=0">http://www.downza.cn/hudsnjkl/257455?module=soft&amp;id=257455&amp;token=dae25a7ec6e3d448176efd7c33b481ae&amp;isxzq=0</a><br>在线工具：<a target="_blank" rel="noopener" href="https://font.qqe2.com/">https://font.qqe2.com/</a></p>
<ul>
<li>破解字体<br>实习憎返回的HTML页面中有一个连接，这个链接下载的文件名字叫做file，实际就是一个ttf文件，将这个文件转换为xml分析得知，在cmap中code对应的就是HTML中的特殊字符例如&amp;#xf5bb，name对应的是unicode码的值，这个unicode码就是想要的真正的数据<br>在线unicode转换工具：<br><a target="_blank" rel="noopener" href="https://www.bejson.com/convert/unicode_chinese/">https://www.bejson.com/convert/unicode_chinese/</a></li>
<li>代码的实现<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fontTools.ttLib <span class="keyword">import</span> TTFont</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 第1步：获取html，且存为html文件以便后面研究使用</span></span><br><span class="line"><span class="string"># 第2步：下载html配套的ttf文件</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 第3步：提取ttf中的数据</span></span><br><span class="line">font = TTFont(<span class="string">&quot;.\file.ttf&quot;</span>)</span><br><span class="line">cmap = font.get(<span class="string">&quot;cmap&quot;</span>).getBestCmap()</span><br><span class="line">ttf_dict = <span class="built_in">dict</span>()</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> cmap.items():</span><br><span class="line">    <span class="comment"># print(k, v)  # 原样数据</span></span><br><span class="line">    <span class="comment"># print(hex(k), v)  # 转换为十六进制</span></span><br><span class="line">    <span class="keyword">if</span> v[<span class="number">3</span>:]:</span><br><span class="line">        <span class="comment"># 1. 转换为真正的字</span></span><br><span class="line">        content = <span class="string">&quot;\\u00&quot;</span> + v[<span class="number">3</span>:] <span class="keyword">if</span> <span class="built_in">len</span>(v[<span class="number">3</span>:]) == <span class="number">2</span> <span class="keyword">else</span> <span class="string">&quot;\\u&quot;</span> + v[<span class="number">3</span>:]</span><br><span class="line">        real_content = content.encode(<span class="string">&#x27;utf-8&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">        <span class="comment"># 2. 替换k</span></span><br><span class="line">        k_hex = <span class="built_in">hex</span>(k)</span><br><span class="line">        real_k = k_hex.replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&amp;#x&quot;</span>)</span><br><span class="line">        <span class="comment"># 3. 封装为字典</span></span><br><span class="line">        ttf_dict[real_k] = real_content</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;解析后：&quot;</span>, ttf_dict)</span><br></pre></td></tr></table></figure>
<h3 id="3-js逆向"><a href="#3-js逆向" class="headerlink" title="3.js逆向"></a>3.js逆向</h3><h4 id="案例：百度翻译-sign值提取"><a href="#案例：百度翻译-sign值提取" class="headerlink" title="案例：百度翻译-sign值提取"></a>案例：百度翻译-sign值提取</h4></li>
<li>URL: <a target="_blank" rel="noopener" href="https://fanyi.baidu.com/">https://fanyi.baidu.com</a><h5 id="破解sign"><a href="#破解sign" class="headerlink" title="破解sign"></a>破解sign</h5></li>
<li>寻找哪里发送翻译请求</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/18.jpg" alt="翻译请求"><br><img src="/image/%E7%88%AC%E8%99%AB/19.jpg" alt="翻译请求"></p>
<hr>
<h5 id="sign计算"><a href="#sign计算" class="headerlink" title="sign计算"></a>sign计算</h5><ul>
<li>sign具体位置，在sign处断点</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/20.jpg" alt="位置"><br><img src="/image/%E7%88%AC%E8%99%AB/21.jpg" alt="位置"></p>
<hr>
<h5 id="python执行js"><a href="#python执行js" class="headerlink" title="python执行js"></a>python执行js</h5><ul>
<li>PyExecJS模块安装，需要JDK<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install PyExecJS -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure></li>
<li>将获取的js存入test.js文件</li>
<li>执行js代码<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.js&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    js_content = f.read()</span><br><span class="line">    <span class="comment"># python执行js代码</span></span><br><span class="line">    context = execjs.<span class="built_in">compile</span>(js_content)</span><br><span class="line">    <span class="comment"># --------------注意--------------</span></span><br><span class="line">    <span class="comment"># context指向了要执行的js文件，如果想要调用某个函数，可以用下面的call方法</span></span><br><span class="line">    <span class="comment"># 第1个参数，为需要调用的函数名字</span></span><br><span class="line">    <span class="comment"># 第2个参数，为给函数e传递的参数（是否传递要看调用的函数是否需要实参）</span></span><br><span class="line">    ret = context.call(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;l love python&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br></pre></td></tr></table></figure>
执行会报错依次添加变量r，函数n，函数名e的修改</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/22.jpg" alt="js"></p>
<hr>
<ul>
<li>对比sign值是否一样</li>
<li>变量r（45298.283587）变化<br>requests获取<a target="_blank" rel="noopener" href="https://fanyi.baidu.com/">https://fanyi.baidu.com</a><br>从响应的页面中提取这个随机数<br>将这个随机数放到js代码中执行<br>即可得出sign值<h5 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sign</span>(<span class="params">text=<span class="string">&quot;你好&quot;</span></span>):</span><br><span class="line">    url = <span class="string">&quot;https://fanyi.baidu.com&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 整理请求头</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;xxxagent&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;xxxcookies&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取请求</span></span><br><span class="line">    r = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line">    sign_i = re.findall(<span class="string">&quot;;window.gtk = (.*?);&quot;</span>, r.content.decode())[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(sign_i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.js&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        js_content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># js中添加一行gtk</span></span><br><span class="line">    js_content = js_content.replace(<span class="string">&#x27;&quot;320305.131321201&quot;&#x27;</span>, sign_i)</span><br><span class="line">    <span class="comment"># print(js_content)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行js</span></span><br><span class="line">    context = execjs.<span class="built_in">compile</span>(js_content)</span><br><span class="line">    sign = context.call(<span class="string">&quot;e&quot;</span>, text)</span><br><span class="line">    <span class="built_in">print</span>(sign)</span><br><span class="line">    <span class="keyword">return</span> sign</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">baidu_translate</span>(<span class="params">text, sign</span>):</span><br><span class="line">    url = <span class="string">&quot;https://fanyi.baidu.com/v2transapi?from=en&amp;to=zh&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;xxxagent&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;xxxcookies&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: text,</span><br><span class="line">        <span class="string">&quot;from&quot;</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">        <span class="string">&quot;to&quot;</span>: <span class="string">&quot;zh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: <span class="string">&quot;xxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sign&quot;</span>: sign</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url=url, data=data, headers=headers)</span><br><span class="line">    <span class="comment"># print(&quot;响应\n\n&quot;, response.content.decode())</span></span><br><span class="line">    ret = json.loads(response.content.decode())</span><br><span class="line">    translate_ret = ret[<span class="string">&quot;trans_result&quot;</span>][<span class="string">&quot;data&quot;</span>][<span class="number">0</span>][<span class="string">&quot;dst&quot;</span>]</span><br><span class="line">    <span class="built_in">print</span>(translate_ret)</span><br><span class="line">    <span class="keyword">return</span> translate_ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1. 输入要翻译的英文</span></span><br><span class="line">    text = <span class="built_in">input</span>(<span class="string">&quot;请输入要翻译的英文:&quot;</span>)</span><br><span class="line">    <span class="comment"># 2. 计算出sign</span></span><br><span class="line">    sign = get_sign(text)</span><br><span class="line">    <span class="comment"># 3. 发送翻译请求</span></span><br><span class="line">    ret = baidu_translate(text, sign)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;英文:&quot;</span>, text, <span class="string">&quot;翻译为应为：&quot;</span>, ret)</span><br></pre></td></tr></table></figure>
<h4 id="案例：百度招聘"><a href="#案例：百度招聘" class="headerlink" title="案例：百度招聘"></a>案例：百度招聘</h4>URL：<a target="_blank" rel="noopener" href="http://zhaopin.baidu.com/">http://zhaopin.baidu.com/</a><h5 id="破解token"><a href="#破解token" class="headerlink" title="破解token"></a>破解token</h5></li>
<li>全局搜索token</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/23.jpg" alt="token"></p>
<hr>
<ul>
<li>监控token值，逆序得到token</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/24.jpg" alt="token"></p>
<hr>
<ul>
<li>全局搜索nekot</li>
</ul>
<hr>
<p><img src="/image/%E7%88%AC%E8%99%AB/25.jpg" alt="nekot"></p>
<hr>
<p>结论：toekn逆向的正确位置<a target="_blank" rel="noopener" href="https://zhaopin.baidu.com/quanzhi?query=%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%88&amp;city=%E5%8C%97%E4%BA%AC">https://zhaopin.baidu.com/quanzhi?query=%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%88&amp;city=%E5%8C%97%E4%BA%AC</a></p>
<h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_token_from_js</span>():</span><br><span class="line">    url = <span class="string">&quot;https://zhaopin.baidu.com/quanzhi?query=%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%88&amp;city=%E5%8C%97%E4%BA%AC&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 整理请求头</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;BAIDUID=6E6EFE4CD5BD1B6F422266E7F427E755:FG=1; BIDUPSID=6E6EFE4CD5BD1B6F422266E7F427E755; PSTM=1701613649; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BAIDUID_BFESS=6E6EFE4CD5BD1B6F422266E7F427E755:FG=1; delPer=0; PSINO=3; BA_HECTOR=ag0hag0k2g8hakag84al25061imqovf1q; ZFY=rUl0ALzpWAhozG4oRl29YfpOqZXrmMqhec17vTya0og:C; Hm_lvt_e3eec7019ba4d61b236c8afa00fd2ca4=1701679831; Hm_lpvt_e3eec7019ba4d61b236c8afa00fd2ca4=1701680362; SECKEY_ABVK=fTAvVB/daOUPIm3i+5BH+tf5QcWsHgRNPqGPSuaRrGE%3D; BMAP_SECKEY=bYnVpXylyf-LggsfIF5yWoCWkAP8uRjdfPFDFMW6wqvPYmREXdTRLhGdH8I-pVvwGal6ej85cyMNJQzOrxEPn_O0Mf6P9ufvfcsbkuOVsx665iLWOADFZ5M6AodHFQ6ca0s4c8zMnhPU49iwCdaFTaVIzFRSq5HNyKCWl8ftNz-z5ehlneLtBCCkKSQuX3Oh; ab_sr=1.0.1_MDI0NTc3YjdkZmM5Nzk2YzUxM2Y4MThlN2YxNGY4Njc1MDM0NWUwNDRmMmQ3MzgzZDYyNTJmZGUxNGJlYjNjYWNmODNlNzk2ZTc5YjVlYmU4MGJkYWZjMDJiNGY1ODhjOTRkZTExMDNjNDkzOTJiZTNhOWE2MDE1NDI2NWMyOGNlZjM5MzQwYzNmZDQyZWVkNGJlNDQxMTA4NThiMzhkYg==&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 获取请求</span></span><br><span class="line">    r = requests.get(url, headers=headers)</span><br><span class="line">    <span class="comment"># 提取nekot</span></span><br><span class="line">    html = r.content.decode()</span><br><span class="line">    token = re.search(<span class="string">r&#x27;data\[&quot;nekot&quot;\] = &quot;(.*?)&quot;;&#x27;</span>, html).group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(token)</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_token</span>():</span><br><span class="line">    token = get_token_from_js()</span><br><span class="line">    <span class="keyword">return</span> token[::-<span class="number">1</span>]  <span class="comment"># 逆序字符串</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_position</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="comment"># 根据需求修改</span></span><br><span class="line">    url = <span class="string">&quot;http://zhaopin.baidu.com/api/qzasync?query=python&amp;city=北京&amp;is_adq=1&amp;pcmod=1&amp;token=%s&amp;pn=20&amp;rn=20&quot;</span> % token</span><br><span class="line">    <span class="comment"># 整理请求头</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;BAIDUID=6E6EFE4CD5BD1B6F422266E7F427E755:FG=1; BIDUPSID=6E6EFE4CD5BD1B6F422266E7F427E755; PSTM=1701613649; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; delPer=0; PSINO=3; BA_HECTOR=ag0hag0k2g8hakag84al25061imqovf1q; Hm_lvt_e3eec7019ba4d61b236c8afa00fd2ca4=1701679831; Hm_lpvt_e3eec7019ba4d61b236c8afa00fd2ca4=1701680756; SECKEY_ABVK=fTAvVB/daOUPIm3i+5BH+qdHwDqK49JpCMFZ+VtvaQ0%3D; BMAP_SECKEY=bYnVpXylyf-LggsfIF5yWnXYeTY3sTFDvqzN2561Yt_16QyRs009ZWunvFqzLDxtiJlBH7oojvUUD9_oIWitPjF1gp54piC89IFUMDGlwGNLIgmX1vyaFZcOtVFz3TcKF_lL29FEtGAbjCanHiik6vQOUNNaDfIz79Oo1ookfMtuyXFtAmIlTaP7ldh0JauK&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 获取请求</span></span><br><span class="line">    r = requests.get(url, headers=headers)</span><br><span class="line">    <span class="comment"># 返回获取到的数据</span></span><br><span class="line">    <span class="keyword">return</span> json.loads(r.content.decode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_info</span>(<span class="params">position_dict</span>):</span><br><span class="line">    position_list = position_dict.get(<span class="string">&quot;data&quot;</span>).get(<span class="string">&quot;disp_data&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> position <span class="keyword">in</span> position_list:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;--------------------------&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;岗位名：&quot;</span>, position.get(<span class="string">&quot;@name&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;薪资：&quot;</span>, position.get(<span class="string">&quot;salary&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公司：&quot;</span>, position.get(<span class="string">&quot;company&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. 获取token</span></span><br><span class="line">    token = get_token()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;提取的token为:&quot;</span>, token)</span><br><span class="line">    <span class="comment"># 2. 发送请求获取职位信息</span></span><br><span class="line">    position_dict = get_position(token)</span><br><span class="line">    <span class="comment"># print(&quot;获取的岗位信息是：&quot;, position_dict)</span></span><br><span class="line">    <span class="comment"># 3. 提取数据</span></span><br><span class="line">    get_info(position_dict)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="4-验证码"><a href="#4-验证码" class="headerlink" title="4.验证码"></a>4.验证码</h3><h4 id="验证码类型"><a href="#验证码类型" class="headerlink" title="验证码类型"></a>验证码类型</h4><p>字符验证码<br>计算型验证码<br>滑动验证码<br>点击验证码<br>视觉验证码</p>
<h4 id="图片验证码平台"><a href="#图片验证码平台" class="headerlink" title="图片验证码平台"></a>图片验证码平台</h4><p>超级鹰 ：<a target="_blank" rel="noopener" href="https://www.chaojiying.com/">https://www.chaojiying.com/</a></p>
<h4 id="案例：打开蜗牛答题网站并获取cookies"><a href="#案例：打开蜗牛答题网站并获取cookies" class="headerlink" title="案例：打开蜗牛答题网站并获取cookies"></a>案例：打开蜗牛答题网站并获取cookies</h4><ul>
<li>用到了PIL模块<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Pillow -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">sys.path.append(os.getcwd() + <span class="string">&quot;/chaojiying_demo&quot;</span>)</span><br><span class="line"><span class="keyword">from</span> chaojiying <span class="keyword">import</span> Chaojiying_Client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用selenium打开谷歌浏览器</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment"># 设置窗口的大小</span></span><br><span class="line">driver.set_window_size(<span class="number">1200</span>, <span class="number">800</span>)</span><br><span class="line"><span class="comment"># 打开一个带有普通验证码的登录页面</span></span><br><span class="line">driver.get(<span class="string">&quot;http://www.woniudati.com/LogonUser.aspx&quot;</span>)</span><br><span class="line"><span class="comment"># 下面解析页面数据</span></span><br><span class="line"><span class="comment"># 输入用户名</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&quot;//input[@id=&#x27;ctl00_ctl00_ContentPlaceHolder1_Body_U_LoginName&#x27;]&quot;</span>).send_keys(<span class="string">&quot;你的用户名&quot;</span>)</span><br><span class="line"><span class="comment"># 输入密码</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&quot;//input[@id=&#x27;ctl00_ctl00_ContentPlaceHolder1_Body_U_Password&#x27;]&quot;</span>).send_keys(<span class="string">&quot;你的命名&quot;</span>)</span><br><span class="line"><span class="comment"># 下面截屏整个页面然后单独提取出验证码的部分截屏图片</span></span><br><span class="line"><span class="comment"># 截屏</span></span><br><span class="line">driver.get_screenshot_as_file(<span class="string">&#x27;screenshort.png&#x27;</span>)</span><br><span class="line"><span class="comment"># 提取验证码位置</span></span><br><span class="line">img_element = driver.find_element_by_xpath(<span class="string">&quot;//img[@id=&#x27;code&#x27;]&quot;</span>)</span><br><span class="line"><span class="comment"># 定位位置</span></span><br><span class="line">left = <span class="built_in">int</span>(img_element.location[<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">top = <span class="built_in">int</span>(img_element.location[<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">right = <span class="built_in">int</span>(img_element.location[<span class="string">&#x27;x&#x27;</span>] + img_element.size[<span class="string">&#x27;width&#x27;</span>])</span><br><span class="line">bottom = <span class="built_in">int</span>(img_element.location[<span class="string">&#x27;y&#x27;</span>] + img_element.size[<span class="string">&#x27;height&#x27;</span>])</span><br><span class="line"><span class="comment"># 通过Image处理图像</span></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;screenshort.png&#x27;</span>)</span><br><span class="line">im = im.crop((left, top, right, bottom))</span><br><span class="line"><span class="comment"># 保存得到的验证码图片</span></span><br><span class="line">im.save(<span class="string">&#x27;code.png&#x27;</span>)</span><br><span class="line"><span class="comment"># 下面使用打码平台识别出图片验证码然后自动输入</span></span><br><span class="line"><span class="comment"># 使用云打码识别</span></span><br><span class="line">chaojiying = Chaojiying_Client(<span class="string">&#x27;你的用户名&#x27;</span>, <span class="string">&#x27;你的密码&#x27;</span>, <span class="string">&#x27;你的id&#x27;</span>)  <span class="comment"># 用户中心&gt;&gt;软件ID 生成一个替换 96001</span></span><br><span class="line">im = <span class="built_in">open</span>(<span class="string">&#x27;code.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()  <span class="comment"># 本地图片文件路径 来替换 a.jpg 有时WIN系统须要//</span></span><br><span class="line">ret = chaojiying.PostPic(im, <span class="number">1902</span>)  <span class="comment"># 1902 验证码类型  官方网站&gt;&gt;价格体系 3.4+版 print 后要加()</span></span><br><span class="line"><span class="built_in">print</span>(ret)</span><br><span class="line"><span class="comment"># 输入验证码</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&quot;//input[@id=&#x27;ctl00_ctl00_ContentPlaceHolder1_Body_VerifyCodeControl_verifycode&#x27;]&quot;</span>).send_keys(ret.get(<span class="string">&quot;pic_str&quot;</span>))</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 点击登录</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&quot;//a[@class=&#x27;buttom2&#x27;]&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 提取出登录之后的cookie</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;提取到的cookie是:&quot;</span>, driver.get_cookies())</span><br><span class="line"><span class="comment"># 退出谷歌浏览器</span></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h3 id="5-Pyppeteer"><a href="#5-Pyppeteer" class="headerlink" title="5.Pyppeteer"></a>5.Pyppeteer</h3>官方网址：<a target="_blank" rel="noopener" href="https://miyakogi.github.io/pyppeteer/">https://miyakogi.github.io/pyppeteer/</a><br>Pyppeteer源码网址：<a target="_blank" rel="noopener" href="https://github.com/miyakogi/pyppeteer">https://github.com/miyakogi/pyppeteer</a></li>
<li>两大特点：chromium浏览器和asyncio框架<h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4>chromium浏览器，只需要一条pyppeteer-install命令就会自动下载对应的最新版本chromium浏览器到pyppeteer的默认位置。如果不运行pyppeteer-install命令，在第一次使用pyppeteer的时候也会自动下载并安装chromium浏览器，效果是一样的。总的来说，pyppeteer比起selenium省去了driver配置的环节。<br>浏览器安装失败：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41688659/article/details/133769663">https://blog.csdn.net/qq_41688659/article/details/133769663</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyppeteer -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><h5 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    browser = <span class="keyword">await</span> launch()</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> page.screenshot(&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;百度.png&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>
<h5 id="打开界面"><a href="#打开界面" class="headerlink" title="打开界面"></a>打开界面</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    browser = <span class="keyword">await</span> launch(&#123;<span class="string">&quot;headless&quot;</span>:<span class="literal">False</span>&#125;)</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>
<h5 id="取消上方自动测试软件控制"><a href="#取消上方自动测试软件控制" class="headerlink" title="取消上方自动测试软件控制"></a>取消上方自动测试软件控制</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要设置显示内容的宽度、高度</span></span><br><span class="line">width, height = <span class="number">1366</span>, <span class="number">768</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="literal">False</span>,args=[<span class="string">&#x27;--disable-infobars&#x27;</span>,<span class="string">f&#x27;--window-size=<span class="subst">&#123;width&#125;</span>,<span class="subst">&#123;height&#125;</span>&#x27;</span>])</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="comment"># 爬取网站</span></span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class="line">    <span class="comment"># 设置大小</span></span><br><span class="line">    <span class="keyword">await</span> page.setViewport(&#123;<span class="string">&#x27;width&#x27;</span>: width, <span class="string">&#x27;height&#x27;</span>: height&#125;)</span><br><span class="line">    <span class="comment"># 一些网站主要通过 window.navigator.webdriver 来对 webdriver 进行检测，所以我们只需要使用 JavaScript 将它设置为 false 即可</span></span><br><span class="line">    <span class="keyword">await</span> page.evaluate(<span class="string">&#x27;&#x27;&#x27;() =&gt;&#123; Object.defineProperties(navigator,&#123; webdriver:&#123; get: () =&gt; false &#125; &#125;) &#125;&#x27;&#x27;&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>
<h2 id="六-抓包工具"><a href="#六-抓包工具" class="headerlink" title="六.抓包工具"></a>六.抓包工具</h2><h3 id="Charles"><a href="#Charles" class="headerlink" title="Charles"></a>Charles</h3>下载地址：<a target="_blank" rel="noopener" href="https://www.charlesproxy.com/download/">https://www.charlesproxy.com/download/</a><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Registered Name:     https://zhile.io</span><br><span class="line">License Key:         48891cf209c6d32bf4</span><br></pre></td></tr></table></figure></li>
<li>设置<br><img src="/image/%E7%88%AC%E8%99%AB/26.jpg" alt="Windows Proxy"><br><img src="/image/%E7%88%AC%E8%99%AB/27.jpg" alt="SSL"><h3 id="Fiddler"><a href="#Fiddler" class="headerlink" title="Fiddler"></a>Fiddler</h3>官方网址：<a target="_blank" rel="noopener" href="https://www.telerik.com/fiddler">https://www.telerik.com/fiddler</a><h2 id="七-Scrapy"><a href="#七-Scrapy" class="headerlink" title="七.Scrapy"></a>七.Scrapy</h2>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架，我们只需要实现少量的代码，就能够快速的抓取。<br>V2.3 中文版：<a target="_blank" rel="noopener" href="https://www.osgeo.cn/scrapy/intro/install.html">https://www.osgeo.cn/scrapy/intro/install.html</a><br>最新版（英文）：<a target="_blank" rel="noopener" href="https://docs.scrapy.org/en/latest/index.html">https://docs.scrapy.org/en/latest/index.html</a></li>
<li>异步和非阻塞<br>异步：调用在发出之后，这个调用就直接返回，不管有无结果；异步是过程。<br>非阻塞：关注的是程序在等待调用结果（消息，返回值）时的状态，指在不能立刻得到结果之前，该调用不会阻塞当前线程。<br><img src="/image/%E7%88%AC%E8%99%AB/28.jpg" alt="SSL"><h3 id="1-Scrapy的工作流程"><a href="#1-Scrapy的工作流程" class="headerlink" title="1.Scrapy的工作流程"></a>1.Scrapy的工作流程</h3><img src="/image/%E7%88%AC%E8%99%AB/29.jpg" alt="普通爬虫"><br><img src="/image/%E7%88%AC%E8%99%AB/30.jpg" alt="Scrapy"><br>1.爬虫中起始的url构造成request对象–&gt;爬虫中间件–&gt;引擎–&gt;调度器<br>2.调度器把request–&gt;引擎–&gt;下载中间件—&gt;下载器<br>3.下载器发送请求，获取response响应—-&gt;下载中间件—-&gt;引擎—&gt;爬虫中间件—&gt;爬虫<br>4.爬虫提取url地址，组装成request对象—-&gt;爬虫中间件—&gt;引擎—&gt;调度器，重复步骤2<br>5.爬虫提取数据—&gt;引擎—&gt;管道处理和保存数据<h3 id="2-安装Scrapy"><a href="#2-安装Scrapy" class="headerlink" title="2.安装Scrapy"></a>2.安装Scrapy</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy</span><br></pre></td></tr></table></figure>
<h3 id="3-使用流程"><a href="#3-使用流程" class="headerlink" title="3.使用流程"></a>3.使用流程</h3>创建一个Scrapy项目:scrapy startproject 项目名字<br>进入到刚刚创建的mySpider文件夹: cd 项目名字<br>生成一个爬虫:scrapy genspider 爬虫名 允许爬取的域名<br>运行爬虫:scrapy crawl 爬虫名<br>提取数据:完善spider，使用xpath等方法<br>保存数据:pipeline中保存数据<h3 id="4-提取爬到的数据"><a href="#4-提取爬到的数据" class="headerlink" title="4.提取爬到的数据"></a>4.提取爬到的数据</h3><h4 id="parse函数"><a href="#parse函数" class="headerlink" title="parse函数"></a>parse函数</h4><img src="/image/%E7%88%AC%E8%99%AB/31.jpg" alt="parse"><h4 id="response常用属性"><a href="#response常用属性" class="headerlink" title="response常用属性"></a>response常用属性</h4>response.url：当前响应的url地址<br>response.request.url：当前响应对应的请求的url地址<br>response.headers：响应头<br>response.request.headers：当前响应的请求头<br>response.body：响应体，也就是html代码，byte类型<br>response.status：响应状态码<h4 id="爬取蜻蜓FM排行榜"><a href="#爬取蜻蜓FM排行榜" class="headerlink" title="爬取蜻蜓FM排行榜"></a>爬取蜻蜓FM排行榜</h4></li>
<li>创建爬虫<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider qingting qingting.fm</span><br></pre></td></tr></table></figure></li>
<li>代码<br><img src="/image/%E7%88%AC%E8%99%AB/32.jpg" alt="FM"><br><strong>response.xpath方法的返回结果是一个类似list的类型，其中包含的是selector对象，操作和列表一样，但是有一些额外的方法<br>额外方法extract()：返回一个包含有字符串的列表<br>额外方法extract_first()：返回列表中的第一个字符串，列表为空没有返回None</strong><br><img src="/image/%E7%88%AC%E8%99%AB/33.jpg" alt="FM"><h3 id="5-管道"><a href="#5-管道" class="headerlink" title="5.管道"></a>5.管道</h3>目的：对parse函数中提取到的数据进一步处理的操作，例如保存到csv、MongoDB等</li>
<li>用yield返回数据<br><strong>为什么要使用yield</strong><br>让整个函数变成一个生成器<br>遍历这个函数的返回值的时候，挨个把数据读到内存，不会造成内存的瞬间占用过高<br>Scrapy是异步爬取，所以通过yield能够将运行权限教给其他的协程任务去执行，这样整个程序运行效果会更高<br><img src="/image/%E7%88%AC%E8%99%AB/34.jpg" alt="yield"></li>
<li>pipelines.py文件 用于对文件进行处理</li>
<li>在settings.py设置开启管道<br><img src="/image/%E7%88%AC%E8%99%AB/35.jpg" alt="开启管道"><h3 id="6-多次数据的下载"><a href="#6-多次数据的下载" class="headerlink" title="6.多次数据的下载"></a>6.多次数据的下载</h3></li>
<li>在parse中生成新的request请求对象<br><img src="/image/%E7%88%AC%E8%99%AB/36.jpg" alt="新的request"></li>
<li>保存img图片<br>parse_img函数中yield图片<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse_img</span>(<span class="params">self, response, img_name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-----parse_img函数-1--&gt;&quot;</span>, response)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-----parse_img函数-2--&gt;&quot;</span>, response.url)</span><br><span class="line">    <span class="comment"># print(&quot;-----parse_img函数-3--&gt;&quot;, response.body)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-----parse_img函数-4--&gt;&quot;</span>, img_name)  <span class="comment"># 这是在parse函数中创建Request请求时设定的给新URL回调函数的参数</span></span><br><span class="line">    <span class="keyword">yield</span> &#123;</span><br><span class="line">        <span class="string">&quot;img_name&quot;</span>: img_name + <span class="string">&quot;.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;img_byte&quot;</span>: response.body</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
管道中保存图片<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itemadapter <span class="keyword">import</span> ItemAdapter</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FmPipeline</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="comment"># 将图片保存</span></span><br><span class="line">        img_name = item.get(<span class="string">&quot;img_name&quot;</span>)</span><br><span class="line">        img_byte = item.get(<span class="string">&quot;img_byte&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> img_name:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(img_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(img_byte)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;保存图片%s完成....ok&quot;</span> % img_name)</span><br></pre></td></tr></table></figure>
设置日志的最低级别<br><img src="/image/%E7%88%AC%E8%99%AB/37.jpg" alt="级别"><h3 id="7-中间件"><a href="#7-中间件" class="headerlink" title="7.中间件"></a>7.中间件</h3><strong>两种中间件都在middlewares.py一个文件中</strong></li>
<li>分类<br>下载中间件，爬虫中间件</li>
<li>作用<br>预处理request和response对象<br><strong>process_request(self, request, spider)</strong><br>当每个request通过下载中间件时，该方法被调用<br>返回None值：没有return也是返回None，该request对象传递给下载器，或通过引擎传递给其他权重低的process_request方法<br>返回Response对象：不再请求，把response返回给引擎<br>返回Request对象：把request对象通过引擎交给调度器，此时将不通过其他权重低的process_request方法<br><strong>process_response(self, request, response, spider)</strong><br>当下载器完成http请求，传递响应给引擎的时候调用<br>返回Resposne：通过引擎交给爬虫处理或交给权重更低的其他下载中间件的process_response方法<br>返回Request对象：通过引擎交给调取器继续请求，此时将不通过其他权重低的process_request方法<br><strong>在settings.py中配置开启中间件，权重值越小越优先执行</strong><h4 id="案例：爬取豆瓣TOP250"><a href="#案例：爬取豆瓣TOP250" class="headerlink" title="案例：爬取豆瓣TOP250"></a>案例：爬取豆瓣TOP250</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Top250Spider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&quot;top250&quot;</span></span><br><span class="line">    allowed_domains = [<span class="string">&quot;douban.com&quot;</span>,<span class="string">&quot;doubanio.com&quot;</span>] <span class="comment"># 无doubanio.com则会报错</span></span><br><span class="line">    start_urls = [<span class="string">&quot;https://movie.douban.com/top250?start=0&amp;filter=&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 对start_urls中的URL对应响应进行处理</span></span><br><span class="line">        li_list = response.xpath(<span class="string">&quot;.//ol[@class=&#x27;grid_view&#x27;]/li&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> li_temp <span class="keyword">in</span> li_list:</span><br><span class="line">            img_src = li_temp.xpath(<span class="string">&quot;.//img/@src&quot;</span>).extract_first()</span><br><span class="line">            title = li_temp.xpath(<span class="string">&quot;.//span[@class=&#x27;title&#x27;][1]/text()&quot;</span>).extract_first()</span><br><span class="line">            rating_num = li_temp.xpath(<span class="string">&quot;.//span[@class=&#x27;rating_num&#x27;]/text()&quot;</span>).extract_first()</span><br><span class="line">            people_num = li_temp.xpath(<span class="string">&quot;.//div[@class=&#x27;star&#x27;]/span[4]/text()&quot;</span>).extract_first()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------&gt;&quot;</span>,img_src,title,rating_num,people_num)</span><br><span class="line">            <span class="comment"># 生成信息，传递给管道，让其保存</span></span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">                <span class="string">&quot;img_src&quot;</span>: img_src,</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: title,</span><br><span class="line">                <span class="string">&quot;rating_num&quot;</span>: rating_num,</span><br><span class="line">                <span class="string">&quot;people_num&quot;</span>: people_num</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 生成新的request对象实现下载图片</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=img_src,callback=self.parse_img,cb_kwargs=&#123;<span class="string">&quot;img_name&quot;</span>: title&#125;)</span><br><span class="line">        <span class="comment"># 生成下一页地址URL</span></span><br><span class="line">        self.page += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.page &lt;= <span class="number">10</span>:</span><br><span class="line">            next_page_url = <span class="string">&quot;https://movie.douban.com/top250?start=%d&amp;filter=&quot;</span> % ((self.page-<span class="number">1</span>) * <span class="number">25</span>)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=next_page_url,callback=self.parse)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_img</span>(<span class="params">self,reponse,img_name</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-----------image-----------&quot;</span>)</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;img&quot;</span>,</span><br><span class="line">            <span class="string">&quot;img_name&quot;</span>: img_name + <span class="string">&quot;.jpg&quot;</span>,</span><br><span class="line">            <span class="string">&quot;img_bytes&quot;</span>: reponse.body</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>pipelines.py</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubanPipeline</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="comment"># 判断文件是否存在download文件夹，没有则创建</span></span><br><span class="line">        download_path = os.getcwd() + <span class="string">&#x27;/download&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(download_path):</span><br><span class="line">            os.mkdir(download_path)</span><br><span class="line">        msg_type = item.get(<span class="string">&quot;type&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> msg_type == <span class="string">&quot;info&quot;</span>:</span><br><span class="line">            <span class="comment"># 保存CSV文件</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(download_path + <span class="string">&quot;TOP250.csv&quot;</span>,<span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f_csv = csv.DictWriter(f,[<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;img_src&#x27;</span>,<span class="string">&#x27;rating_num&#x27;</span>,<span class="string">&#x27;people_num&#x27;</span>])</span><br><span class="line">                item.pop(<span class="string">&quot;type&quot;</span>)</span><br><span class="line">                f_csv.writerows([item])</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;保存信息到CSV。。。OK&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> msg_type == <span class="string">&quot;img&quot;</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(download_path + item.get(<span class="string">&quot;img_name&quot;</span>),<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(item.get(<span class="string">&quot;img_bytes&quot;</span>))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;保存图片OK&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure></li>
<li>middlewares.py<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求头类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserAgentMiddleware</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    USER_AGENTS_LIST = [</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5&quot;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;------下载中间件----&quot;</span>)</span><br><span class="line">        <span class="comment"># 随机挑选一个</span></span><br><span class="line">        user_agent = random.choice(self.USER_AGENTS_LIST)</span><br><span class="line">        request.headers[<span class="string">&#x27;User-Agent&#x27;</span>] = user_agent</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># 代理类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyMiddleware</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="comment"># proxies可以在settings.py中，也可以来源于代理ip的webapi</span></span><br><span class="line">        <span class="comment"># proxy = random.choice(proxies)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 免费的会失效，报 111 connection refused 信息！重找一个代理ip再试</span></span><br><span class="line">        request.meta[<span class="string">&#x27;proxy&#x27;</span>] = <span class="string">&#x27;https://1.71.188.37:3128&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># 可以不写return</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-----下载中间件-reponse----&quot;</span>, response.status)</span><br><span class="line">        <span class="keyword">if</span> response.status != <span class="number">200</span>:</span><br><span class="line">            request.dont_filter = <span class="literal">True</span>  <span class="comment"># 重新发送的请求对象能够再次进入队列</span></span><br><span class="line">            <span class="keyword">return</span> request</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></li>
<li>settings.py<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LOG_LEVEL = <span class="string">&quot;WARNING&quot;</span> <span class="comment"># 设置报错日志级别</span></span><br><span class="line">HTTPPERROR_ALLOWED_COODES = [<span class="number">403</span>] <span class="comment"># 允许403状态码</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span> <span class="comment"># 不遵循协议</span></span><br><span class="line">DOWNLOAD_DELAY = <span class="number">3</span> <span class="comment"># 第一次和第二次间隔3秒</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">&quot;douban.middlewares.UserAgentMiddleware&quot;</span>: <span class="number">400</span>, <span class="comment"># 数字越小权重越大，先执行</span></span><br><span class="line">    <span class="string">&quot;douban.middlewares.DoubanDownloaderMiddleware&quot;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="string">&quot;douban.pipelines.DoubanPipeline&quot;</span>: <span class="number">300</span>, <span class="comment"># 开启管道</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-管道的使用"><a href="#8-管道的使用" class="headerlink" title="8.管道的使用"></a>8.管道的使用</h3><h4 id="自定义管道（pipeline"><a href="#自定义管道（pipeline" class="headerlink" title="自定义管道（pipeline)"></a>自定义管道（pipeline)</h4></li>
<li>process_item(self,item,spider):<br>管道类中必须有的函数<br>实现对item数据的处理<br>一般情况下都会return item，如果没有return，那么相当于将None传递给权重低的process_item</li>
<li>open_spider(self, spider):<br>在爬虫开启的时候仅执行一次<br>在这里可以连接数据库、打开文件等</li>
<li>close_spider(self, spider):<br>在爬虫关闭的时候仅执行一次<br>在这里可以关闭数据库，关闭文件等</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://xczf.shop">betty bear</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xczf.shop/2021/07/15/python-%E7%88%AC%E8%99%AB/">http://xczf.shop/2021/07/15/python-%E7%88%AC%E8%99%AB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xczf.shop" target="_blank">betty bear</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post_share"><div class="social-share" data-image="/image/22.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/15/windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/"><img class="prev-cover" src="/image/5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">windows操作系统安装</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/15/%E5%87%BD%E6%95%B0/"><img class="next-cover" src="/image/8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C函数</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/08/01/Python-%E9%AB%98%E7%BA%A7/" title="Python-进阶"><img class="cover" src="/image/24.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-01</div><div class="title">Python-进阶</div></div></a></div><div><a href="/2020/07/15/PythonGUI-%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98/" title="Python--pygame 坦克大战"><img class="cover" src="/image/15.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-15</div><div class="title">Python--pygame 坦克大战</div></div></a></div><div><a href="/2022/06/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构(Python)"><img class="cover" src="/image/14.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-16</div><div class="title">数据结构(Python)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">betty bear</div><div class="author-info__description">最在意的，或许得不到了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/cate%EF%BC%9Agories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ccmmdd"><i class="fab fa-github"></i><span>不要点我呀！</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ccmmdd" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3025346417@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">你也不想这件事被发现吧！~~~///(^v^)\\\~~~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86"><span class="toc-number">1.</span> <span class="toc-text">一.基础部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%88%AC%E8%99%AB%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1.爬虫概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%88%AC%E8%99%AB"><span class="toc-number">1.1.1.</span> <span class="toc-text">什么是爬虫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%88%AC%E8%99%AB"><span class="toc-number">1.1.2.</span> <span class="toc-text">获取爬虫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.3.</span> <span class="toc-text">爬虫的分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2.流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-http-https%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.</span> <span class="toc-text">3.http,https协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-robots%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.</span> <span class="toc-text">4.robots协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%88%AC%E8%99%AB%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">5.爬虫相关插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%88%AC%E8%99%AB%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.6.</span> <span class="toc-text">6.爬虫相关软件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#POSTMAN"><span class="toc-number">1.6.1.</span> <span class="toc-text">POSTMAN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ApiPost"><span class="toc-number">1.6.2.</span> <span class="toc-text">ApiPost</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-requests%E6%A8%A1%E5%9D%97"><span class="toc-number">1.7.</span> <span class="toc-text">7.requests模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85requests%E6%A8%A1%E5%9D%97"><span class="toc-number">1.7.1.</span> <span class="toc-text">安装requests模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#requests%E5%8F%91%E9%80%81get"><span class="toc-number">1.7.2.</span> <span class="toc-text">requests发送get</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E4%B8%8B%E8%BD%BD%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">案例：下载一张图片</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iter-content"><span class="toc-number">1.7.3.</span> <span class="toc-text">iter_content</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E8%A7%86%E9%A2%91%E6%97%B6%E6%98%BE%E7%A4%BA%E8%BF%9B%E5%BA%A6"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">下载视频时显示进度</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E5%B8%A6header%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.4.</span> <span class="toc-text">发送带header请求</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%90%BA%E5%B8%A6User-Agent%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">携带User-Agent请求</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89URL-%E5%8F%82%E6%95%B0%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.5.</span> <span class="toc-text">带有URL 参数的请求</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-baidu%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">案例:baidu查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81POST%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.6.</span> <span class="toc-text">发送POST请求</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E8%AF%8D%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">单词查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E8%B4%B4%E5%90%A7%E7%BD%91%E9%A1%B5%E6%BA%90%E7%A0%81%E7%88%AC%E5%8F%96"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">任意贴吧网页源码爬取</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#requests%E5%A4%84%E7%90%86cookie"><span class="toc-number">1.7.7.</span> <span class="toc-text">requests处理cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E6%97%B6%E6%B7%BB%E5%8A%A0cookie"><span class="toc-number">1.7.7.1.</span> <span class="toc-text">发送请求时添加cookie</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E6%97%B6%E6%8F%90%E5%8F%96cookie"><span class="toc-number">1.7.7.2.</span> <span class="toc-text">获取响应时提取cookie</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.7.8.</span> <span class="toc-text">重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E8%87%AA%E5%8A%A8%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.7.8.1.</span> <span class="toc-text">取消自动重定向</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E8%AF%B7%E6%B1%82%EF%BC%88%E5%8D%B3%E8%8E%B7%E5%8F%96%E9%87%8D%E5%AE%9A%E5%90%91%E7%9A%84%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95%EF%BC%89"><span class="toc-number">1.7.8.2.</span> <span class="toc-text">获取历史请求（即获取重定向的所有记录）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSL%E8%AF%81%E4%B9%A6%E9%94%99%E8%AF%AF"><span class="toc-number">1.7.9.</span> <span class="toc-text">SSL证书错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6"><span class="toc-number">1.7.10.</span> <span class="toc-text">请求超时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#retrying%E6%A8%A1%E5%9D%97"><span class="toc-number">1.7.11.</span> <span class="toc-text">retrying模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.7.11.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.11.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#retrying%E5%92%8Crequests%E7%9A%84%E7%AE%80%E5%8D%95%E5%B0%81%E8%A3%85"><span class="toc-number">1.7.11.3.</span> <span class="toc-text">retrying和requests的简单封装</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81json%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.12.</span> <span class="toc-text">发送json数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.12.1.</span> <span class="toc-text">登录查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session%E4%BC%9A%E8%AF%9D"><span class="toc-number">1.7.13.</span> <span class="toc-text">Session会话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86"><span class="toc-number">1.7.14.</span> <span class="toc-text">代理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96"><span class="toc-number">1.8.</span> <span class="toc-text">8.数据提取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96-JSON"><span class="toc-number">1.8.1.</span> <span class="toc-text">结构数据提取-JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9AFM%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%BF%A1%E6%81%AF"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">案例：FM排行榜信息</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.8.2.</span> <span class="toc-text">非结构数据提取-正则表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#re%E6%A8%A1%E5%9D%97%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">re模块方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%AC%E5%8F%9636kr%E9%A6%96%E9%A1%B5%E6%96%B0%E9%97%BB"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">爬取36kr首页新闻</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XPath"><span class="toc-number">1.8.3.</span> <span class="toc-text">XPath</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XPath%E8%AF%AD%E6%B3%95"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">XPath语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E4%B9%A0%EF%BC%9A%E7%88%AC%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1top250"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">连习：爬取豆瓣电影top250</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%EF%BC%9Alxml%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8XPath"><span class="toc-number">1.8.4.</span> <span class="toc-text">非结构化数据：lxml模块使用XPath</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#lxml%E6%A8%A1%E5%9D%97%E5%AE%89%E8%A3%85"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">lxml模块安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lxml%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">lxml的使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XPath%E8%AF%AD%E6%B3%95%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.4.3.</span> <span class="toc-text">XPath语法提取数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XPath%E5%88%86%E6%AC%A1%E6%8F%90%E5%8F%96"><span class="toc-number">1.8.4.4.</span> <span class="toc-text">XPath分次提取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E8%AF%84%E8%AE%BA"><span class="toc-number">1.8.4.5.</span> <span class="toc-text">提取豆瓣电影评论</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jsonpath%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.5.</span> <span class="toc-text">jsonpath模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96%E2%80%93BS4"><span class="toc-number">1.8.6.</span> <span class="toc-text">非结构数据提取–BS4</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#find-all"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">find_all</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#select"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">select</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%AC%E5%8F%96%E6%96%B0%E9%97%BB%E6%A0%87%E9%A2%98"><span class="toc-number">1.8.6.3.</span> <span class="toc-text">爬取新闻标题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSV"><span class="toc-number">1.8.7.</span> <span class="toc-text">CSV</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Python%E5%AF%B9CSV%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.7.1.</span> <span class="toc-text">Python对CSV文件操作</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-MongoDB"><span class="toc-number">2.</span> <span class="toc-text">二.MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text">1.安装和基础使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-MongoDB%E5%92%8CPython%E4%BA%A4%E4%BA%92"><span class="toc-number">2.2.</span> <span class="toc-text">2.MongoDB和Python交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8pymongo"><span class="toc-number">2.2.1.</span> <span class="toc-text">使用pymongo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%EF%BC%9A%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3"><span class="toc-number">2.2.2.</span> <span class="toc-text">练习：插入文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E5%BC%82%E6%AD%A5"><span class="toc-number">3.</span> <span class="toc-text">三.异步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-GIL%EF%BC%88%E5%85%A8%E5%B1%80%E8%A7%A3%E9%87%8A%E5%99%A8%E9%94%81%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">1.GIL（全局解释器锁）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GIL%E8%A7%A3%E5%86%B3%E9%99%90%E5%88%B6"><span class="toc-number">3.1.1.</span> <span class="toc-text">GIL解决限制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BC%82%E6%AD%A5%E3%80%81%E5%90%8C%E6%AD%A5"><span class="toc-number">3.2.</span> <span class="toc-text">2.异步、同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-asyncio-Python-3-7-%E6%88%96%E6%9B%B4%E9%AB%98%E7%89%88%E6%9C%AC"><span class="toc-number">3.3.</span> <span class="toc-text">3.asyncio Python 3.7 或更高版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">3.3.1.</span> <span class="toc-text">同步与异步的不同</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%BC%82%E6%AD%A5%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.2.</span> <span class="toc-text">定义异步方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%8D%8F%E7%A8%8B"><span class="toc-number">3.3.3.</span> <span class="toc-text">启动协程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#asyncio-run%EF%BC%88Python3-7%E6%96%B0%EF%BC%89"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">asyncio.run（Python3.7新）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%88Python3-6%EF%BC%89"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">事件循环（Python3.6）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1"><span class="toc-number">3.3.4.</span> <span class="toc-text">并发执行任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Task"><span class="toc-number">3.3.5.</span> <span class="toc-text">Task</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">回调函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-aiohttp"><span class="toc-number">3.4.</span> <span class="toc-text">4.aiohttp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%A1%88%E4%BE%8B"><span class="toc-number">3.4.1.</span> <span class="toc-text">并发案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E5%8F%8D%E7%88%AC"><span class="toc-number">4.</span> <span class="toc-text">五.反爬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E5%A6%82%E4%BD%95%E8%AF%86%E5%88%AB%E7%88%AC%E8%99%AB"><span class="toc-number">4.0.1.</span> <span class="toc-text">网站如何识别爬虫</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Selenium"><span class="toc-number">4.1.</span> <span class="toc-text">1.Selenium</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.2.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D"><span class="toc-number">4.1.3.</span> <span class="toc-text">元素定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.4.</span> <span class="toc-text">其他方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC"><span class="toc-number">4.2.</span> <span class="toc-text">2.字体反爬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Base64"><span class="toc-number">4.2.1.</span> <span class="toc-text">Base64</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">字体反爬过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%AE%9E%E4%B9%A0%E5%83%A7"><span class="toc-number">4.2.3.</span> <span class="toc-text">案例：实习僧</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-js%E9%80%86%E5%90%91"><span class="toc-number">4.3.</span> <span class="toc-text">3.js逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%99%BE%E5%BA%A6%E7%BF%BB%E8%AF%91-sign%E5%80%BC%E6%8F%90%E5%8F%96"><span class="toc-number">4.3.1.</span> <span class="toc-text">案例：百度翻译-sign值提取</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3sign"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">破解sign</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sign%E8%AE%A1%E7%AE%97"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">sign计算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#python%E6%89%A7%E8%A1%8Cjs"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">python执行js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">4.3.1.4.</span> <span class="toc-text">完整代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%99%BE%E5%BA%A6%E6%8B%9B%E8%81%98"><span class="toc-number">4.3.2.</span> <span class="toc-text">案例：百度招聘</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3token"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">破解token</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">4.4.</span> <span class="toc-text">4.验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.4.1.</span> <span class="toc-text">验证码类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81%E5%B9%B3%E5%8F%B0"><span class="toc-number">4.4.2.</span> <span class="toc-text">图片验证码平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%89%93%E5%BC%80%E8%9C%97%E7%89%9B%E7%AD%94%E9%A2%98%E7%BD%91%E7%AB%99%E5%B9%B6%E8%8E%B7%E5%8F%96cookies"><span class="toc-number">4.4.3.</span> <span class="toc-text">案例：打开蜗牛答题网站并获取cookies</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Pyppeteer"><span class="toc-number">4.5.</span> <span class="toc-text">5.Pyppeteer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-number">4.5.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%AA%E5%9B%BE"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">截图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%95%8C%E9%9D%A2"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">打开界面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E4%B8%8A%E6%96%B9%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E8%BD%AF%E4%BB%B6%E6%8E%A7%E5%88%B6"><span class="toc-number">4.5.2.3.</span> <span class="toc-text">取消上方自动测试软件控制</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7"><span class="toc-number">5.</span> <span class="toc-text">六.抓包工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Charles"><span class="toc-number">5.1.</span> <span class="toc-text">Charles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fiddler"><span class="toc-number">5.2.</span> <span class="toc-text">Fiddler</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-Scrapy"><span class="toc-number">6.</span> <span class="toc-text">七.Scrapy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Scrapy%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">6.1.</span> <span class="toc-text">1.Scrapy的工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85Scrapy"><span class="toc-number">6.2.</span> <span class="toc-text">2.安装Scrapy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">6.3.</span> <span class="toc-text">3.使用流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%8F%90%E5%8F%96%E7%88%AC%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">6.4.</span> <span class="toc-text">4.提取爬到的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#parse%E5%87%BD%E6%95%B0"><span class="toc-number">6.4.1.</span> <span class="toc-text">parse函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#response%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">6.4.2.</span> <span class="toc-text">response常用属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%AC%E5%8F%96%E8%9C%BB%E8%9C%93FM%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="toc-number">6.4.3.</span> <span class="toc-text">爬取蜻蜓FM排行榜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%AE%A1%E9%81%93"><span class="toc-number">6.5.</span> <span class="toc-text">5.管道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%A4%9A%E6%AC%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%8B%E8%BD%BD"><span class="toc-number">6.6.</span> <span class="toc-text">6.多次数据的下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">6.7.</span> <span class="toc-text">7.中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%88%AC%E5%8F%96%E8%B1%86%E7%93%A3TOP250"><span class="toc-number">6.7.1.</span> <span class="toc-text">案例：爬取豆瓣TOP250</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E7%AE%A1%E9%81%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.8.</span> <span class="toc-text">8.管道的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AE%A1%E9%81%93%EF%BC%88pipeline"><span class="toc-number">6.8.1.</span> <span class="toc-text">自定义管道（pipeline)</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/10/01/DevOps/" title="devops"><img src="/image/16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="devops"/></a><div class="content"><a class="title" href="/2023/10/01/DevOps/" title="devops">devops</a><time datetime="2023-10-01T11:00:41.000Z" title="发表于 2023-10-01 19:00:41">2023-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/01/memcache/" title="memcache"><img src="/image/27.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="memcache"/></a><div class="content"><a class="title" href="/2023/09/01/memcache/" title="memcache">memcache</a><time datetime="2023-09-01T11:00:41.000Z" title="发表于 2023-09-01 19:00:41">2023-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/15/OpenStack/" title="Openstack"><img src="/image/25.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Openstack"/></a><div class="content"><a class="title" href="/2023/07/15/OpenStack/" title="Openstack">Openstack</a><time datetime="2023-07-15T11:00:41.000Z" title="发表于 2023-07-15 19:00:41">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/01/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" title="分布式存储"><img src="/image/26.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式存储"/></a><div class="content"><a class="title" href="/2022/11/01/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" title="分布式存储">分布式存储</a><time datetime="2022-11-01T11:00:41.000Z" title="发表于 2022-11-01 19:00:41">2022-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/01/V2ray/" title="nginx搭建v2ray服务"><img src="/image/21.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="nginx搭建v2ray服务"/></a><div class="content"><a class="title" href="/2022/10/01/V2ray/" title="nginx搭建v2ray服务">nginx搭建v2ray服务</a><time datetime="2022-10-01T11:00:41.000Z" title="发表于 2022-10-01 19:00:41">2022-10-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/22.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By betty bear</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">啊，对对对!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://xczf.shop/2021/07/15/python-%E7%88%AC%E8%99%AB/'
    this.page.identifier = '2021/07/15/python-爬虫/'
    this.page.title = 'python 爬虫 （施工中）'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer src="/live2d-widget/autoload.js"></script><div class="aplayer no-destroy" data-id="8828254214" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>